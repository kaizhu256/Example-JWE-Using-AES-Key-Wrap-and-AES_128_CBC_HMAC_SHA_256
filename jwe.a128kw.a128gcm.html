<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

<title>Examples of Protecting Content using JavaScript Object Signing and Encryption (JOSE)</title>

<style type="text/css" title="Xml2Rfc (sans serif)">
/*<![CDATA[*/
a {
text-decoration: none;
}
/* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
a.info {
/* This is the key. */
position: relative;
z-index: 24;
text-decoration: none;
}
a.info:hover {
z-index: 25;
color: #FFF; background-color: #900;
}
a.info span { display: none; }
a.info:hover span.info {
/* The span will display just on :hover state. */
display: block;
position: absolute;
font-size: smaller;
top: 2em; left: -5em; width: 15em;
padding: 2px; border: 1px solid #333;
color: #900; background-color: #EEE;
text-align: left;
}
a.smpl {
color: black;
}
a:hover {
text-decoration: underline;
}
a:active {
text-decoration: underline;
}
address {
margin-top: 1em;
margin-left: 2em;
font-style: normal;
}
body {
color: black;
font-family: verdana, helvetica, arial, sans-serif;
font-size: 10pt;
max-width: 55em;
}
cite {
font-style: normal;
}
dd {
margin-right: 2em;
}
dl {
margin-left: 2em;
}

ul.empty {
list-style-type: none;
}
ul.empty li {
margin-top: .5em;
}
dl p {
margin-left: 0em;
}
dt {
margin-top: .5em;
}
h1 {
font-size: 14pt;
line-height: 21pt;
page-break-after: avoid;
}
h1.np {
page-break-before: always;
}
h1 a {
color: #333333;
}
h2 {
font-size: 12pt;
line-height: 15pt;
page-break-after: avoid;
}
h3, h4, h5, h6 {
font-size: 10pt;
page-break-after: avoid;
}
h2 a, h3 a, h4 a, h5 a, h6 a {
color: black;
}
img {
margin-left: 3em;
}
li {
margin-left: 2em;
margin-right: 2em;
}
ol {
margin-left: 2em;
margin-right: 2em;
}
ol p {
margin-left: 0em;
}
p {
margin-left: 2em;
margin-right: 2em;
}
pre {
margin-left: 3em;
background-color: lightyellow;
padding: .25em;
}
pre.text2 {
border-style: dotted;
border-width: 1px;
background-color: #f0f0f0;
width: 69em;
}
pre.inline {
background-color: white;
padding: 0em;
}
pre.text {
border-style: dotted;
border-width: 1px;
background-color: #f8f8f8;
width: 69em;
}
pre.drawing {
border-style: solid;
border-width: 1px;
background-color: #f8f8f8;
padding: 2em;
}
table {
margin-left: 2em;
}
table.tt {
vertical-align: top;
}
table.full {
border-style: outset;
border-width: 1px;
}
table.headers {
border-style: outset;
border-width: 1px;
}
table.tt td {
vertical-align: top;
}
table.full td {
border-style: inset;
border-width: 1px;
}
table.tt th {
vertical-align: top;
}
table.full th {
border-style: inset;
border-width: 1px;
}
table.headers th {
border-style: none none inset none;
border-width: 1px;
}
table.left {
margin-right: auto;
}
table.right {
margin-left: auto;
}
table.center {
margin-left: auto;
margin-right: auto;
}
caption {
caption-side: bottom;
font-weight: bold;
font-size: 9pt;
margin-top: .5em;
}

table.header {
border-spacing: 1px;
width: 95%;
font-size: 10pt;
color: white;
}
td.top {
vertical-align: top;
}
td.topnowrap {
vertical-align: top;
white-space: nowrap;
}
table.header td {
background-color: gray;
width: 50%;
}
table.header a {
color: white;
}
td.reference {
vertical-align: top;
white-space: nowrap;
padding-right: 1em;
}
thead {
display:table-header-group;
}
ul.toc, ul.toc ul {
list-style: none;
margin-left: 1.5em;
margin-right: 0em;
padding-left: 0em;
}
ul.toc li {
line-height: 150%;
font-weight: bold;
font-size: 10pt;
margin-left: 0em;
margin-right: 0em;
}
ul.toc li li {
line-height: normal;
font-weight: normal;
font-size: 9pt;
margin-left: 0em;
margin-right: 0em;
}
li.excluded {
font-size: 0pt;
}
ul p {
margin-left: 0em;
}

.comment {
background-color: yellow;
}
.center {
text-align: center;
}
.error {
color: red;
font-style: italic;
font-weight: bold;
}
.figure {
font-weight: bold;
text-align: center;
font-size: 9pt;
}
.filename {
color: #333333;
font-weight: bold;
font-size: 12pt;
line-height: 21pt;
text-align: center;
}
.fn {
font-weight: bold;
}
.hidden {
display: none;
}
.left {
text-align: left;
}
.right {
text-align: right;
}
.title {
color: #990000;
font-size: 18pt;
line-height: 18pt;
font-weight: bold;
text-align: center;
margin-top: 36pt;
}
.vcardline {
display: block;
}
.warning {
font-size: 14pt;
background-color: yellow;
}

@media print {
.noprint {
display: none;
}

a {
color: black;
text-decoration: none;
}

table.header {
width: 90%;
}

td.header {
width: 50%;
color: black;
background-color: white;
vertical-align: top;
font-size: 12pt;
}

ul.toc a::after {
content: leader('.') target-counter(attr(href), page);
}

ul.ind li li a {
content: target-counter(attr(href), page);
}

.print2col {
column-count: 2;
-moz-column-count: 2;
column-fill: auto;
}
}

@page {
@top-left {
content: "Internet-Draft";
}
@top-right {
content: "December 2010";
}
@top-center {
content: "Abbreviated Title";
}
@bottom-left {
content: "Doe";
}
@bottom-center {
content: "Expires June 2011";
}
@bottom-right {
content: "[Page " counter(page) "]";
}
}

@page:first {
@top-left {
content: normal;
}
@top-right {
content: normal;
}
@top-center {
content: normal;
}
}
/*]]>*/
</style>

<link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Conventions Used in this Document"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 JSON Web Signature Examples"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 RSA v1.5 Signature"/>
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Input Factors"/>
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Signing Operation"/>
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Output Results"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 RSA-PSS Signature"/>
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Input Factors"/>
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Signing Operation"/>
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Output Results"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 ECDSA Signature"/>
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 Input Factors"/>
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 Signing Operation"/>
<link href="#rfc.section.3.3.3" rel="Chapter" title="3.3.3 Output Results"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 HMAC-SHA2 Integrity Protection"/>
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 Input Factors"/>
<link href="#rfc.section.3.4.2" rel="Chapter" title="3.4.2 Signing Operation"/>
<link href="#rfc.section.3.4.3" rel="Chapter" title="3.4.3 Output Results"/>
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Detached Signature"/>
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 Input Factors"/>
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 Signing Operation"/>
<link href="#rfc.section.3.5.3" rel="Chapter" title="3.5.3 Output Results"/>
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Protecting Specific Header Fields"/>
<link href="#rfc.section.3.6.1" rel="Chapter" title="3.6.1 Input Factors"/>
<link href="#rfc.section.3.6.2" rel="Chapter" title="3.6.2 Signing Operation"/>
<link href="#rfc.section.3.6.3" rel="Chapter" title="3.6.3 Output Results"/>
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Protecting Content Only"/>
<link href="#rfc.section.3.7.1" rel="Chapter" title="3.7.1 Input Factors"/>
<link href="#rfc.section.3.7.2" rel="Chapter" title="3.7.2 Signing Operation"/>
<link href="#rfc.section.3.7.3" rel="Chapter" title="3.7.3 Output Results"/>
<link href="#rfc.section.3.8" rel="Chapter" title="3.8 Multiple Signatures"/>
<link href="#rfc.section.3.8.1" rel="Chapter" title="3.8.1 Input Factors"/>
<link href="#rfc.section.3.8.2" rel="Chapter" title="3.8.2 First Signing Operation"/>
<link href="#rfc.section.3.8.3" rel="Chapter" title="3.8.3 Second Signing Operation"/>
<link href="#rfc.section.3.8.4" rel="Chapter" title="3.8.4 Third Signing Operation"/>
<link href="#rfc.section.3.8.5" rel="Chapter" title="3.8.5 Output Results"/>
<link href="#rfc.section.4" rel="Chapter" title="4 JSON Web Encryption Examples"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Key Encryption using RSA v1.5 and AES-HMAC-SHA2"/>
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Input Factors"/>
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Generated Factors"/>
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Encrypting the Key"/>
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 Encrypting the Content"/>
<link href="#rfc.section.4.1.5" rel="Chapter" title="4.1.5 Output Results"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Key Encryption using RSA-OAEP with A256GCM"/>
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Input Factors"/>
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Generated Factors"/>
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Encrypting the Key"/>
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Encrypting the Content"/>
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 Output Results"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Key Wrap using PBES2-AES-KeyWrap with AES-CBC-HMAC-SHA2"/>
<link href="#rfc.section.4.3.1" rel="Chapter" title="4.3.1 Input Factors"/>
<link href="#rfc.section.4.3.2" rel="Chapter" title="4.3.2 Generated Factors"/>
<link href="#rfc.section.4.3.3" rel="Chapter" title="4.3.3 Encrypting the Key"/>
<link href="#rfc.section.4.3.4" rel="Chapter" title="4.3.4 Encrypting the Content"/>
<link href="#rfc.section.4.3.5" rel="Chapter" title="4.3.5 Output Results"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Key Agreement with Key Wrapping using ECDH-ES and AES-KeyWrap with AES-GCM"/>
<link href="#rfc.section.4.4.1" rel="Chapter" title="4.4.1 Input Factors"/>
<link href="#rfc.section.4.4.2" rel="Chapter" title="4.4.2 Generated Factors"/>
<link href="#rfc.section.4.4.3" rel="Chapter" title="4.4.3 Encrypting the Key"/>
<link href="#rfc.section.4.4.4" rel="Chapter" title="4.4.4 Encrypting the Content"/>
<link href="#rfc.section.4.4.5" rel="Chapter" title="4.4.5 Output Results"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Key Agreement using ECDH-ES with AES-CBC-HMAC-SHA2"/>
<link href="#rfc.section.4.5.1" rel="Chapter" title="4.5.1 Input Factors"/>
<link href="#rfc.section.4.5.2" rel="Chapter" title="4.5.2 Generated Factors"/>
<link href="#rfc.section.4.5.3" rel="Chapter" title="4.5.3 Key Agreement"/>
<link href="#rfc.section.4.5.4" rel="Chapter" title="4.5.4 Encrypting the Content"/>
<link href="#rfc.section.4.5.5" rel="Chapter" title="4.5.5 Output Results"/>
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Direct Encryption using AES-GCM"/>
<link href="#rfc.section.4.6.1" rel="Chapter" title="4.6.1 Input Factors"/>
<link href="#rfc.section.4.6.2" rel="Chapter" title="4.6.2 Generated Factors"/>
<link href="#rfc.section.4.6.3" rel="Chapter" title="4.6.3 Encrypting the Content"/>
<link href="#rfc.section.4.6.4" rel="Chapter" title="4.6.4 Output Results"/>
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Key Wrap using AES-GCM KeyWrap with AES-CBC-HMAC-SHA2"/>
<link href="#rfc.section.4.7.1" rel="Chapter" title="4.7.1 Input Factors"/>
<link href="#rfc.section.4.7.2" rel="Chapter" title="4.7.2 Generated Factors"/>
<link href="#rfc.section.4.7.3" rel="Chapter" title="4.7.3 Encrypting the Key"/>
<link href="#rfc.section.4.7.4" rel="Chapter" title="4.7.4 Encrypting the Content"/>
<link href="#rfc.section.4.7.5" rel="Chapter" title="4.7.5 Output Results"/>
<link href="#rfc.section.4.8" rel="Chapter" title="4.8 Key Wrap using AES-KeyWrap with AES-GCM"/>
<link href="#rfc.section.4.8.1" rel="Chapter" title="4.8.1 Input Factors"/>
<link href="#rfc.section.4.8.2" rel="Chapter" title="4.8.2 Generated Factors"/>
<link href="#rfc.section.4.8.3" rel="Chapter" title="4.8.3 Encrypting the Key"/>
<link href="#rfc.section.4.8.4" rel="Chapter" title="4.8.4 Encrypting the Content"/>
<link href="#rfc.section.4.8.5" rel="Chapter" title="4.8.5 Output Results"/>
<link href="#rfc.section.4.9" rel="Chapter" title="4.9 Compressed Content"/>
<link href="#rfc.section.4.9.1" rel="Chapter" title="4.9.1 Input Factors"/>
<link href="#rfc.section.4.9.2" rel="Chapter" title="4.9.2 Generated Factors"/>
<link href="#rfc.section.4.9.3" rel="Chapter" title="4.9.3 Encrypting the Key"/>
<link href="#rfc.section.4.9.4" rel="Chapter" title="4.9.4 Encrypting the Content"/>
<link href="#rfc.section.4.9.5" rel="Chapter" title="4.9.5 Output Results"/>
<link href="#rfc.section.4.10" rel="Chapter" title="4.10 Including Additional Authenticated Data"/>
<link href="#rfc.section.4.10.1" rel="Chapter" title="4.10.1 Input Factors"/>
<link href="#rfc.section.4.10.2" rel="Chapter" title="4.10.2 Generated Factors"/>
<link href="#rfc.section.4.10.3" rel="Chapter" title="4.10.3 Encrypting the Key"/>
<link href="#rfc.section.4.10.4" rel="Chapter" title="4.10.4 Encrypting the Content"/>
<link href="#rfc.section.4.10.5" rel="Chapter" title="4.10.5 Output Results"/>
<link href="#rfc.section.4.11" rel="Chapter" title="4.11 Protecting Specific Header Fields"/>
<link href="#rfc.section.4.11.1" rel="Chapter" title="4.11.1 Input Factors"/>
<link href="#rfc.section.4.11.2" rel="Chapter" title="4.11.2 Generated Factors"/>
<link href="#rfc.section.4.11.3" rel="Chapter" title="4.11.3 Encrypting the Key"/>
<link href="#rfc.section.4.11.4" rel="Chapter" title="4.11.4 Encrypting the Content"/>
<link href="#rfc.section.4.11.5" rel="Chapter" title="4.11.5 Output Results"/>
<link href="#rfc.section.4.12" rel="Chapter" title="4.12 Protecting Content Only"/>
<link href="#rfc.section.4.12.1" rel="Chapter" title="4.12.1 Input Factors"/>
<link href="#rfc.section.4.12.2" rel="Chapter" title="4.12.2 Generated Factors"/>
<link href="#rfc.section.4.12.3" rel="Chapter" title="4.12.3 Encrypting the Key"/>
<link href="#rfc.section.4.12.4" rel="Chapter" title="4.12.4 Encrypting the Content"/>
<link href="#rfc.section.4.12.5" rel="Chapter" title="4.12.5 Output Results"/>
<link href="#rfc.section.4.13" rel="Chapter" title="4.13 Encrypting to Multiple Recipients"/>
<link href="#rfc.section.4.13.1" rel="Chapter" title="4.13.1 Input Factors"/>
<link href="#rfc.section.4.13.2" rel="Chapter" title="4.13.2 Generated Factors"/>
<link href="#rfc.section.4.13.3" rel="Chapter" title="4.13.3 Encrypting the Key to the First Recipient"/>
<link href="#rfc.section.4.13.4" rel="Chapter" title="4.13.4 Encrypting the Key to the Second Recipient"/>
<link href="#rfc.section.4.13.5" rel="Chapter" title="4.13.5 Encrypting the Key to the Third Recipient"/>
<link href="#rfc.section.4.13.6" rel="Chapter" title="4.13.6 Encrypting the Content"/>
<link href="#rfc.section.4.13.7" rel="Chapter" title="4.13.7 Output Results"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Nesting Signatures and Encryption"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Signing Input Factors"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Signing Operation"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Signing Output"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Encryption Input Factors"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Encryption Generated Factors"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Encrypting the Key"/>
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Encrypting the Content"/>
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Encryption Output"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations"/>
<link href="#rfc.references" rel="Chapter" title="8 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements"/>
<link href="#rfc.authors" rel="Chapter"/>

<meta name="generator" content="xml2rfc version 2.4.5 - http://tools.ietf.org/tools/xml2rfc" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<meta name="viewport" content="width=600" />
<link rel="schema.dct" href="http://purl.org/dc/terms/" />

<meta name="dct.creator" content="Miller, M." />
<meta name="dct.identifier" content="urn:ietf:id:draft-ietf-jose-cookbook-02" />
<meta name="dct.issued" scheme="ISO8601" content="2014-4-21" />
<meta name="dct.abstract" content="A set of examples of using JavaScript Object Signing and Encryption (JOSE) to protect data.  This document illustrates a representative sampling of various JSON Web Signature (JWS) and JSON Web Encryption (JWE) results given similar inputs." />
<meta name="description" content="A set of examples of using JavaScript Object Signing and Encryption (JOSE) to protect data.  This document illustrates a representative sampling of various JSON Web Signature (JWS) and JSON Web Encryption (JWE) results given similar inputs." />

</head>

<body>

<table class="header">
<tbody>

<tr>
<td class="left">JOSE Working Group</td>
<td class="right">M. Miller</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">April 21, 2014</td>
</tr>
<tr>
<td class="left">Expires: October 23, 2014</td>
<td class="right"></td>
</tr>

</tbody>
</table>

<p class="title">Examples of Protecting Content using JavaScript Object Signing and Encryption (JOSE)<br />
<span class="filename">draft-ietf-jose-cookbook-02</span></p>

<h1 id="rfc.abstract">
<a href="#rfc.abstract">Abstract</a>
</h1>
<p>A set of examples of using JavaScript Object Signing and Encryption (JOSE) to protect data.  This document illustrates a representative sampling of various JSON Web Signature (JWS) and JSON Web Encryption (JWE) results given similar inputs.</p>
<h1 id="rfc.status">
<a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 23, 2014.</p>
<h1 id="rfc.copyrightnotice">
<a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

<hr class="noprint" />
<h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
<ul class="toc">

<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Conventions Used in this Document</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">JSON Web Signature Examples</a></li>
<li>3.1.   <a href="#rfc.section.3.1">RSA v1.5 Signature</a></li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">Input Factors</a></li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Signing Operation</a></li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Output Results</a></li>
<li>3.2.   <a href="#rfc.section.3.2">RSA-PSS Signature</a></li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">Input Factors</a></li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Signing Operation</a></li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Output Results</a></li>
<li>3.3.   <a href="#rfc.section.3.3">ECDSA Signature</a></li>
<li>3.3.1.   <a href="#rfc.section.3.3.1">Input Factors</a></li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">Signing Operation</a></li>
<li>3.3.3.   <a href="#rfc.section.3.3.3">Output Results</a></li>
<li>3.4.   <a href="#rfc.section.3.4">HMAC-SHA2 Integrity Protection</a></li>
<li>3.4.1.   <a href="#rfc.section.3.4.1">Input Factors</a></li>
<li>3.4.2.   <a href="#rfc.section.3.4.2">Signing Operation</a></li>
<li>3.4.3.   <a href="#rfc.section.3.4.3">Output Results</a></li>
<li>3.5.   <a href="#rfc.section.3.5">Detached Signature</a></li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">Input Factors</a></li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">Signing Operation</a></li>
<li>3.5.3.   <a href="#rfc.section.3.5.3">Output Results</a></li>
<li>3.6.   <a href="#rfc.section.3.6">Protecting Specific Header Fields</a></li>
<li>3.6.1.   <a href="#rfc.section.3.6.1">Input Factors</a></li>
<li>3.6.2.   <a href="#rfc.section.3.6.2">Signing Operation</a></li>
<li>3.6.3.   <a href="#rfc.section.3.6.3">Output Results</a></li>
<li>3.7.   <a href="#rfc.section.3.7">Protecting Content Only</a></li>
<li>3.7.1.   <a href="#rfc.section.3.7.1">Input Factors</a></li>
<li>3.7.2.   <a href="#rfc.section.3.7.2">Signing Operation</a></li>
<li>3.7.3.   <a href="#rfc.section.3.7.3">Output Results</a></li>
<li>3.8.   <a href="#rfc.section.3.8">Multiple Signatures</a></li>
<li>3.8.1.   <a href="#rfc.section.3.8.1">Input Factors</a></li>
<li>3.8.2.   <a href="#rfc.section.3.8.2">First Signing Operation</a></li>
<li>3.8.3.   <a href="#rfc.section.3.8.3">Second Signing Operation</a></li>
<li>3.8.4.   <a href="#rfc.section.3.8.4">Third Signing Operation</a></li>
<li>3.8.5.   <a href="#rfc.section.3.8.5">Output Results</a></li>
<li>4.   <a href="#rfc.section.4">JSON Web Encryption Examples</a></li>
<li>4.1.   <a href="#rfc.section.4.1">Key Encryption using RSA v1.5 and AES-HMAC-SHA2</a></li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Input Factors</a></li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Generated Factors</a></li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Encrypting the Key</a></li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">Encrypting the Content</a></li>
<li>4.1.5.   <a href="#rfc.section.4.1.5">Output Results</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Key Encryption using RSA-OAEP with A256GCM</a></li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Input Factors</a></li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Generated Factors</a></li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">Encrypting the Key</a></li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Encrypting the Content</a></li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">Output Results</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Key Wrap using PBES2-AES-KeyWrap with AES-CBC-HMAC-SHA2</a></li>
<li>4.3.1.   <a href="#rfc.section.4.3.1">Input Factors</a></li>
<li>4.3.2.   <a href="#rfc.section.4.3.2">Generated Factors</a></li>
<li>4.3.3.   <a href="#rfc.section.4.3.3">Encrypting the Key</a></li>
<li>4.3.4.   <a href="#rfc.section.4.3.4">Encrypting the Content</a></li>
<li>4.3.5.   <a href="#rfc.section.4.3.5">Output Results</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Key Agreement with Key Wrapping using ECDH-ES and AES-KeyWrap with AES-GCM</a></li>
<li>4.4.1.   <a href="#rfc.section.4.4.1">Input Factors</a></li>
<li>4.4.2.   <a href="#rfc.section.4.4.2">Generated Factors</a></li>
<li>4.4.3.   <a href="#rfc.section.4.4.3">Encrypting the Key</a></li>
<li>4.4.4.   <a href="#rfc.section.4.4.4">Encrypting the Content</a></li>
<li>4.4.5.   <a href="#rfc.section.4.4.5">Output Results</a></li>
<li>4.5.   <a href="#rfc.section.4.5">Key Agreement using ECDH-ES with AES-CBC-HMAC-SHA2</a></li>
<li>4.5.1.   <a href="#rfc.section.4.5.1">Input Factors</a></li>
<li>4.5.2.   <a href="#rfc.section.4.5.2">Generated Factors</a></li>
<li>4.5.3.   <a href="#rfc.section.4.5.3">Key Agreement</a></li>
<li>4.5.4.   <a href="#rfc.section.4.5.4">Encrypting the Content</a></li>
<li>4.5.5.   <a href="#rfc.section.4.5.5">Output Results</a></li>
<li>4.6.   <a href="#rfc.section.4.6">Direct Encryption using AES-GCM</a></li>
<li>4.6.1.   <a href="#rfc.section.4.6.1">Input Factors</a></li>
<li>4.6.2.   <a href="#rfc.section.4.6.2">Generated Factors</a></li>
<li>4.6.3.   <a href="#rfc.section.4.6.3">Encrypting the Content</a></li>
<li>4.6.4.   <a href="#rfc.section.4.6.4">Output Results</a></li>
<li>4.7.   <a href="#rfc.section.4.7">Key Wrap using AES-GCM KeyWrap with AES-CBC-HMAC-SHA2</a></li>
<li>4.7.1.   <a href="#rfc.section.4.7.1">Input Factors</a></li>
<li>4.7.2.   <a href="#rfc.section.4.7.2">Generated Factors</a></li>
<li>4.7.3.   <a href="#rfc.section.4.7.3">Encrypting the Key</a></li>
<li>4.7.4.   <a href="#rfc.section.4.7.4">Encrypting the Content</a></li>
<li>4.7.5.   <a href="#rfc.section.4.7.5">Output Results</a></li>
<li>4.8.   <a href="#rfc.section.4.8">Key Wrap using AES-KeyWrap with AES-GCM</a></li>
<li>4.8.1.   <a href="#rfc.section.4.8.1">Input Factors</a></li>
<li>4.8.2.   <a href="#rfc.section.4.8.2">Generated Factors</a></li>
<li>4.8.3.   <a href="#rfc.section.4.8.3">Encrypting the Key</a></li>
<li>4.8.4.   <a href="#rfc.section.4.8.4">Encrypting the Content</a></li>
<li>4.8.5.   <a href="#rfc.section.4.8.5">Output Results</a></li>
<li>4.9.   <a href="#rfc.section.4.9">Compressed Content</a></li>
<li>4.9.1.   <a href="#rfc.section.4.9.1">Input Factors</a></li>
<li>4.9.2.   <a href="#rfc.section.4.9.2">Generated Factors</a></li>
<li>4.9.3.   <a href="#rfc.section.4.9.3">Encrypting the Key</a></li>
<li>4.9.4.   <a href="#rfc.section.4.9.4">Encrypting the Content</a></li>
<li>4.9.5.   <a href="#rfc.section.4.9.5">Output Results</a></li>
<li>4.10.   <a href="#rfc.section.4.10">Including Additional Authenticated Data</a></li>
<li>4.10.1.   <a href="#rfc.section.4.10.1">Input Factors</a></li>
<li>4.10.2.   <a href="#rfc.section.4.10.2">Generated Factors</a></li>
<li>4.10.3.   <a href="#rfc.section.4.10.3">Encrypting the Key</a></li>
<li>4.10.4.   <a href="#rfc.section.4.10.4">Encrypting the Content</a></li>
<li>4.10.5.   <a href="#rfc.section.4.10.5">Output Results</a></li>
<li>4.11.   <a href="#rfc.section.4.11">Protecting Specific Header Fields</a></li>
<li>4.11.1.   <a href="#rfc.section.4.11.1">Input Factors</a></li>
<li>4.11.2.   <a href="#rfc.section.4.11.2">Generated Factors</a></li>
<li>4.11.3.   <a href="#rfc.section.4.11.3">Encrypting the Key</a></li>
<li>4.11.4.   <a href="#rfc.section.4.11.4">Encrypting the Content</a></li>
<li>4.11.5.   <a href="#rfc.section.4.11.5">Output Results</a></li>
<li>4.12.   <a href="#rfc.section.4.12">Protecting Content Only</a></li>
<li>4.12.1.   <a href="#rfc.section.4.12.1">Input Factors</a></li>
<li>4.12.2.   <a href="#rfc.section.4.12.2">Generated Factors</a></li>
<li>4.12.3.   <a href="#rfc.section.4.12.3">Encrypting the Key</a></li>
<li>4.12.4.   <a href="#rfc.section.4.12.4">Encrypting the Content</a></li>
<li>4.12.5.   <a href="#rfc.section.4.12.5">Output Results</a></li>
<li>4.13.   <a href="#rfc.section.4.13">Encrypting to Multiple Recipients</a></li>
<li>4.13.1.   <a href="#rfc.section.4.13.1">Input Factors</a></li>
<li>4.13.2.   <a href="#rfc.section.4.13.2">Generated Factors</a></li>
<li>4.13.3.   <a href="#rfc.section.4.13.3">Encrypting the Key to the First Recipient</a></li>
<li>4.13.4.   <a href="#rfc.section.4.13.4">Encrypting the Key to the Second Recipient</a></li>
<li>4.13.5.   <a href="#rfc.section.4.13.5">Encrypting the Key to the Third Recipient</a></li>
<li>4.13.6.   <a href="#rfc.section.4.13.6">Encrypting the Content</a></li>
<li>4.13.7.   <a href="#rfc.section.4.13.7">Output Results</a></li>
<li>5.   <a href="#rfc.section.5">Nesting Signatures and Encryption</a></li>
<li>5.1.   <a href="#rfc.section.5.1">Signing Input Factors</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Signing Operation</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Signing Output</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Encryption Input Factors</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Encryption Generated Factors</a></li>
<li>5.6.   <a href="#rfc.section.5.6">Encrypting the Key</a></li>
<li>5.7.   <a href="#rfc.section.5.7">Encrypting the Content</a></li>
<li>5.8.   <a href="#rfc.section.5.8">Encryption Output</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a></li>
<li>8.   <a href="#rfc.references">Informative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>

</ul>

<h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">The JavaScript Object Signing and Encryption (JOSE) technologies &#8211; JSON Web Key (JWK) <a href="#I-D.ietf-jose-json-web-key">[I-D.ietf-jose-json-web-key]</a>, JSON Web Signature (JWS) <a href="#I-D.ietf-jose-json-web-signature">[I-D.ietf-jose-json-web-signature]</a>, JSON Web Encryption (JWE) <a href="#I-D.ietf-jose-json-web-encryption">[I-D.ietf-jose-json-web-encryption]</a>, and JSON Web Algorithms (JWA) <a href="#I-D.ietf-jose-json-web-algorithms">[I-D.ietf-jose-json-web-algorithms]</a> &#8211; collectively can be used to protect content in a myriad of ways.  The full set of permutations is extremely large, and might be daunting to some.</p>
<p id="rfc.section.1.p.2">This document provides a number of examples of signing or encrypting content using JOSE.  While not exhaustive, it does compile together a representative sample of JOSE features.  As much as possible, the same signature payload or encryption plaintext content is used to illustrate differences in various signing and encryption results.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#intro-conventions" id="intro-conventions">Conventions Used in this Document</a></h1>
<p id="rfc.section.1.1.p.1">All instances of binary octet strings are represented using <a href="#RFC4648">[RFC4648]</a> base64url encoding.</p>
<p id="rfc.section.1.1.p.2">Wherever possible, the examples include both the Compact and JSON serializations.</p>
<p id="rfc.section.1.1.p.3">All of the examples in this document have whitespace added to improve formatting and readability.  Except for plaintext or payload content, whitespace is not part of the cryptographic operations.  Plaintext or payload content does include whitespace (unless otherwise noted), with line breaks (U+000A LINE FEED) added to improve readability.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#terms" id="terms">Terminology</a></h1>
<p id="rfc.section.2.p.1">This document inherits terminology regarding JSON Web Key (JWK) technology from <a href="#I-D.ietf-jose-json-web-key">[I-D.ietf-jose-json-web-key]</a>, terminology regarding JSON Web Signature (JWS) technology from <a href="#I-D.ietf-jose-json-web-signature">[I-D.ietf-jose-json-web-signature]</a>, terminology regarding JSON Web Encryption (JWE) technology from <a href="#I-D.ietf-jose-json-web-encryption">[I-D.ietf-jose-json-web-encryption]</a>, and terminology regarding algorithms from <a href="#I-D.ietf-jose-json-web-algorithms">[I-D.ietf-jose-json-web-algorithms]</a>.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#jws" id="jws">JSON Web Signature Examples</a></h1>
<p id="rfc.section.3.p.1">The following sections demonstrate how to generate various JWS objects.</p>
<p id="rfc.section.3.p.2">All of the succeeding examples use the following payload plaintext, serialized as UTF-8;  the sequence &#8220;\xe2\x80\x99&#8221; substituted for (U+2019 RIGHT SINGLE QUOTATION MARK) and line breaks (U+000A LINE FEED) replacing some &#8220; &#8220; (U+0020 SPACE) to improve readability:</p>
<div id="rfc.figure.1"/>
<div id="jws-payload"/>
<pre>
It\xe2\x80\x99s a dangerous business, Frodo, going out your
door. You step onto the road, and if you don't keep your feet,
there\xe2\x80\x99s no knowing where you might be swept off
to.
</pre>
<p class="figure">Figure 1: Payload content plaintext</p>
<p id="rfc.section.3.p.3">The Payload &#8211; with the sequence &#8220;\xe2\x80\x99&#8221; replaced with (U+2019 RIGHT SINGLE QUOTATION MARK) and line breaks (U+000A LINE FEED) replaced with &#8220; &#8220; (U+0020 SPACE) &#8211; encoded as UTF-8 then as <a href="#RFC4648">[RFC4648]</a> base64url:</p>
<div id="rfc.figure.2"/>
<div id="jws-payload_b64u"/>
<pre>
SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywgZ29pbmcgb3V0IH
lvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9hZCwgYW5kIGlmIHlvdSBk
b24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXigJlzIG5vIGtub3dpbmcgd2hlcm
UgeW91IG1pZ2h0IGJlIHN3ZXB0IG9mZiB0by4
</pre>
<p class="figure">Figure 2: Payload content, base64url-encoded</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#jws-rsa" id="jws-rsa">RSA v1.5 Signature</a></h1>
<p id="rfc.section.3.1.p.1">This example illustrates signing content using the &#8220;RS256&#8221; (RSASSA-PKCS1-v1_5 with SHA-256) algorithm.</p>
<h1 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#jws-rsa-input" id="jws-rsa-input">Input Factors</a></h1>
<p id="rfc.section.3.1.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>RSA private key; this example uses the key from <a href="#jws-rsa-key">Figure 3</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;RS256&#8221;.</li>
</ul>
<div id="rfc.figure.3"/>
<div id="jws-rsa-key"/>
<pre>
{
"kty": "RSA",
"kid": "bilbo.baggins@hobbiton.example",
"use": "sig",
"n": "n4EPtAOCc9AlkeQHPzHStgAbgs7bTZLwUBZdR8_KuKPEHLd4rHVTeT
-O-XV2jRojdNhxJWTDvNd7nqQ0VEiZQHz_AJmSCpMaJMRBSFKrKb2wqV
wGU_NsYOYL-QtiWN2lbzcEe6XC0dApr5ydQLrHqkHHig3RBordaZ6Aj-
oBHqFEHYpPe7Tpe-OfVfHd1E6cS6M1FZcD1NNLYD5lFHpPI9bTwJlsde
3uhGqC0ZCuEHg8lhzwOHrtIQbS0FVbb9k3-tVTU4fg_3L_vniUFAKwuC
LqKnS2BYwdq_mzSnbLY7h_qixoR7jig3__kRhuaxwUkRz5iaiQkqgc5g
HdrNP5zw",
"e": "AQAB",
"d": "bWUC9B-EFRIo8kpGfh0ZuyGPvMNKvYWNtB_ikiH9k20eT-O1q_I78e
iZkpXxXQ0UTEs2LsNRS-8uJbvQ-A1irkwMSMkK1J3XTGgdrhCku9gRld
Y7sNA_AKZGh-Q661_42rINLRCe8W-nZ34ui_qOfkLnK9QWDDqpaIsA-b
MwWWSDFu2MUBYwkHTMEzLYGqOe04noqeq1hExBTHBOBdkMXiuFhUq1BU
6l-DqEiWxqg82sXt2h-LMnT3046AOYJoRioz75tSUQfGCshWTBnP5uDj
d18kKhyv07lhfSJdrPdM5Plyl21hsFf4L_mHCuoFau7gdsPfHPxxjVOc
OpBrQzwQ",
"p": "3Slxg_DwTXJcb6095RoXygQCAZ5RnAvZlno1yhHtnUex_fp7AZ_9nR
aO7HX_-SFfGQeutao2TDjDAWU4Vupk8rw9JR0AzZ0N2fvuIAmr_WCsmG
peNqQnev1T7IyEsnh8UMt-n5CafhkikzhEsrmndH6LxOrvRJlsPp6Zv8
bUq0k",
"q": "uKE2dh-cTf6ERF4k4e_jy78GfPYUIaUyoSSJuBzp3Cubk3OCqs6grT
8bR_cu0Dm1MZwWmtdqDyI95HrUeq3MP15vMMON8lHTeZu2lmKvwqW7an
V5UzhM1iZ7z4yMkuUwFWoBvyY898EXvRD-hdqRxHlSqAZ192zB3pVFJ0
s7pFc",
"dp": "B8PVvXkvJrj2L-GYQ7v3y9r6Kw5g9SahXBwsWUzp19TVlgI-YV85q
1NIb1rxQtD-IsXXR3-TanevuRPRt5OBOdiMGQp8pbt26gljYfKU_E9xn
-RULHz0-ed9E9gXLKD4VGngpz-PfQ_q29pk5xWHoJp009Qf1HvChixRX
59ehik",
"dq": "CLDmDGduhylc9o7r84rEUVn7pzQ6PF83Y-iBZx5NT-TpnOZKF1pEr
AMVeKzFEl41DlHHqqBLSM0W1sOFbwTxYWZDm6sI6og5iTbwQGIC3gnJK
bi_7k_vJgGHwHxgPaX2PnvP-zyEkDERuf-ry4c_Z11Cq9AqC2yeL6kdK
T1cYF8",
"qi": "3PiqvXQN0zwMeE-sBvZgi289XP9XCQF3VWqPzMKnIgQp7_Tugo6-N
ZBKCQsMf3HaEGBjTVJs_jcK8-TRXvaKe-7ZMaQj8VfBdYkssbu0NKDDh
jJ-GtiseaDVWt7dcH0cfwxgFUHpQh7FoCrjFJ6h6ZEpMF6xmujs4qMpP
z8aaI4"
}
</pre>
<p class="figure">Figure 3: RSA 2048-bit Private Key, in JWK format</p>
<h1 id="rfc.section.3.1.2"><a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#jws-rsa-op" id="jws-rsa-op">Signing Operation</a></h1>
<p id="rfc.section.3.1.2.p.1">The following are generated to complete the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-rsa-protected">Figure 4</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-rsa-protected_b64u">Figure 5</a>.</li>
</ul>
<div id="rfc.figure.4"/>
<div id="jws-rsa-protected"/>
<pre>
{
"alg": "RS256",
"kid": "bilbo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 4: Protected JWS Header JSON</p>
<div id="rfc.figure.5"/>
<div id="jws-rsa-protected_b64u"/>
<pre>
eyJhbGciOiJSUzI1NiIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
</pre>
<p class="figure">Figure 5: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.1.2.p.3">Performing the signature operation over the combined protected JWS header (<a href="#jws-rsa-protected_b64u">Figure 5</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.6"/>
<div id="jws-rsa-sig"/>
<pre>
MRjdkly7_-oTPTS3AXP41iQIGKa80A0ZmTuV5MEaHoxnW2e5CZ5NlKtainoFmK
ZopdHM1O2U4mwzJdQx996ivp83xuglII7PNDi84wnB-BDkoBwA78185hX-Es4J
IwmDLJK3lfWRa-XtL0RnltuYv746iYTh_qHRD68BNt1uSNCrUCTJDt5aAE6x8w
W1Kt9eRo4QPocSadnHXFxnt8Is9UzpERV0ePPQdLuW3IS_de3xyIrDaLGdjluP
xUAhb6L2aXic1U12podGU0KLUQSE_oI-ZnmKJ3F4uOZDnd6QZWJushZ41Axf_f
cIe8u9ipH84ogoree7vjbU5y18kDquDg
</pre>
<p class="figure">Figure 6: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.1.3"><a href="#rfc.section.3.1.3">3.1.3.</a> <a href="#jws-rsa-output" id="jws-rsa-output">Output Results</a></h1>
<p id="rfc.section.3.1.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-rsa-protected">Figure 4</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-rsa-sig">Figure 6</a>)</li>
</ul>
<p id="rfc.section.3.1.3.p.3">The resulting JWS object using the Compact serialization:</p>
<div id="rfc.figure.7"/>
<div id="jws-rsa-compact"/>
<pre>
eyJhbGciOiJSUzI1NiIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
.
SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywgZ29pbmcgb3V0IH
lvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9hZCwgYW5kIGlmIHlvdSBk
b24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXigJlzIG5vIGtub3dpbmcgd2hlcm
UgeW91IG1pZ2h0IGJlIHN3ZXB0IG9mZiB0by4
.
MRjdkly7_-oTPTS3AXP41iQIGKa80A0ZmTuV5MEaHoxnW2e5CZ5NlKtainoFmK
ZopdHM1O2U4mwzJdQx996ivp83xuglII7PNDi84wnB-BDkoBwA78185hX-Es4J
IwmDLJK3lfWRa-XtL0RnltuYv746iYTh_qHRD68BNt1uSNCrUCTJDt5aAE6x8w
W1Kt9eRo4QPocSadnHXFxnt8Is9UzpERV0ePPQdLuW3IS_de3xyIrDaLGdjluP
xUAhb6L2aXic1U12podGU0KLUQSE_oI-ZnmKJ3F4uOZDnd6QZWJushZ41Axf_f
cIe8u9ipH84ogoree7vjbU5y18kDquDg
</pre>
<p class="figure">Figure 7: Compact Serialization</p>
<p id="rfc.section.3.1.3.p.4">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.8"/>
<div id="jws-rsa-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImJpbGJvLmJhZ2
dpbnNAaG9iYml0b24uZXhhbXBsZSJ9",
"signature": "MRjdkly7_-oTPTS3AXP41iQIGKa80A0ZmTuV5MEaHo
xnW2e5CZ5NlKtainoFmKZopdHM1O2U4mwzJdQx996ivp83xuglII
7PNDi84wnB-BDkoBwA78185hX-Es4JIwmDLJK3lfWRa-XtL0Rnlt
uYv746iYTh_qHRD68BNt1uSNCrUCTJDt5aAE6x8wW1Kt9eRo4QPo
cSadnHXFxnt8Is9UzpERV0ePPQdLuW3IS_de3xyIrDaLGdjluPxU
Ahb6L2aXic1U12podGU0KLUQSE_oI-ZnmKJ3F4uOZDnd6QZWJush
Z41Axf_fcIe8u9ipH84ogoree7vjbU5y18kDquDg"
}
]
}
</pre>
<p class="figure">Figure 8: JSON Serialization</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#jws-rsapss" id="jws-rsapss">RSA-PSS Signature</a></h1>
<p id="rfc.section.3.2.p.1">This example illustrates signing content using the &#8220;PS256&#8221; (RSASSA-PSS with SHA-256) algorithm.</p>
<h1 id="rfc.section.3.2.1"><a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#jws-rsapss-input" id="jws-rsapss-input">Input Factors</a></h1>
<p id="rfc.section.3.2.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>RSA private key; this example uses the key from <a href="#jws-rsa-key">Figure 3</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;PS384&#8221;.</li>
</ul>
<h1 id="rfc.section.3.2.2"><a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#jws-rsapss-op" id="jws-rsapss-op">Signing Operation</a></h1>
<p id="rfc.section.3.2.2.p.1">The following are generated to complete the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-rsapss-protected">Figure 9</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-rsapss-protected_b64u">Figure 10</a>.</li>
</ul>
<div id="rfc.figure.9"/>
<div id="jws-rsapss-protected"/>
<pre>
{
"alg": "PS384",
"kid": "bilbo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 9: Protected JWS Header JSON</p>
<div id="rfc.figure.10"/>
<div id="jws-rsapss-protected_b64u"/>
<pre>
eyJhbGciOiJQUzM4NCIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
</pre>
<p class="figure">Figure 10: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.2.2.p.3">Performing the signature operation over the combined protected JWS header (<a href="#jws-rsapss-protected_b64u">Figure 10</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.11"/>
<div id="jws-rsapss-sig"/>
<pre>
cu22eBqkYDKgIlTpzDXGvaFfz6WGoz7fUDcfT0kkOy42miAh2qyBzk1xEsnk2I
pN6-tPid6VrklHkqsGqDqHCdP6O8TTB5dDDItllVo6_1OLPpcbUrhiUSMxbbXU
vdvWXzg-UD8biiReQFlfz28zGWVsdiNAUf8ZnyPEgVFn442ZdNqiVJRmBqrYRX
e8P_ijQ7p8Vdz0TTrxUeT3lm8d9shnr2lfJT8ImUjvAA2Xez2Mlp8cBE5awDzT
0qI0n6uiP1aCN_2_jLAeQTlqRHtfa64QQSUmFAAjVKPbByi7xho0uTOcbH510a
6GYmJUAfmWjwZ6oD4ifKo8DYM-X72Eaw
</pre>
<p class="figure">Figure 11: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.2.3"><a href="#rfc.section.3.2.3">3.2.3.</a> <a href="#jws-rsapss-output" id="jws-rsapss-output">Output Results</a></h1>
<p id="rfc.section.3.2.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-rsapss-protected_b64u">Figure 10</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-rsapss-sig">Figure 11</a>)</li>
</ul>
<p id="rfc.section.3.2.3.p.3">The resulting JWS object using the Compact serialization:</p>
<div id="rfc.figure.12"/>
<div id="jws-rsapss-compact"/>
<pre>
eyJhbGciOiJQUzM4NCIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
.
SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywgZ29pbmcgb3V0IH
lvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9hZCwgYW5kIGlmIHlvdSBk
b24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXigJlzIG5vIGtub3dpbmcgd2hlcm
UgeW91IG1pZ2h0IGJlIHN3ZXB0IG9mZiB0by4
.
cu22eBqkYDKgIlTpzDXGvaFfz6WGoz7fUDcfT0kkOy42miAh2qyBzk1xEsnk2I
pN6-tPid6VrklHkqsGqDqHCdP6O8TTB5dDDItllVo6_1OLPpcbUrhiUSMxbbXU
vdvWXzg-UD8biiReQFlfz28zGWVsdiNAUf8ZnyPEgVFn442ZdNqiVJRmBqrYRX
e8P_ijQ7p8Vdz0TTrxUeT3lm8d9shnr2lfJT8ImUjvAA2Xez2Mlp8cBE5awDzT
0qI0n6uiP1aCN_2_jLAeQTlqRHtfa64QQSUmFAAjVKPbByi7xho0uTOcbH510a
6GYmJUAfmWjwZ6oD4ifKo8DYM-X72Eaw
</pre>
<p class="figure">Figure 12: Compact Serialization</p>
<p id="rfc.section.3.2.3.p.4">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.13"/>
<div id="jws-rsapss-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJQUzM4NCIsImtpZCI6ImJpbGJvLmJhZ2
dpbnNAaG9iYml0b24uZXhhbXBsZSJ9",
"signature": "cu22eBqkYDKgIlTpzDXGvaFfz6WGoz7fUDcfT0kkOy
42miAh2qyBzk1xEsnk2IpN6-tPid6VrklHkqsGqDqHCdP6O8TTB5
dDDItllVo6_1OLPpcbUrhiUSMxbbXUvdvWXzg-UD8biiReQFlfz2
8zGWVsdiNAUf8ZnyPEgVFn442ZdNqiVJRmBqrYRXe8P_ijQ7p8Vd
z0TTrxUeT3lm8d9shnr2lfJT8ImUjvAA2Xez2Mlp8cBE5awDzT0q
I0n6uiP1aCN_2_jLAeQTlqRHtfa64QQSUmFAAjVKPbByi7xho0uT
OcbH510a6GYmJUAfmWjwZ6oD4ifKo8DYM-X72Eaw"
}
]
}
</pre>
<p class="figure">Figure 13: JSON Serialization</p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#jws-ecdsa" id="jws-ecdsa">ECDSA Signature</a></h1>
<p id="rfc.section.3.3.p.1">This example illustrates signing content using the &#8220;ES512&#8221; (ECDSA with curve P-521 and SHA-512) algorithm.</p>
<h1 id="rfc.section.3.3.1"><a href="#rfc.section.3.3.1">3.3.1.</a> <a href="#jws-ecdsa-input" id="jws-ecdsa-input">Input Factors</a></h1>
<p id="rfc.section.3.3.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>EC private key on the curve P-521; this example uses the key from <a href="#jws-ecdsa-key">Figure 14</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;ES512&#8221;</li>
</ul>
<div id="rfc.figure.14"/>
<div id="jws-ecdsa-key"/>
<pre>
{
"kty": "EC",
"kid": "bilbo.baggins@hobbiton.example",
"use": "sig",
"crv": "P-521",
"x": "AHKZLLOsCOzz5cY97ewNUajB957y-C-U88c3v13nmGZx6sYl_oJXu9
A5RkTKqjqvjyekWF-7ytDyRXYgCF5cj0Kt",
"y": "AdymlHvOiLxXkEhayXQnNCvDX4h9htZaCJN34kfmC6pV5OhQHiraVy
SsUdaQkAgDPrwQrJmbnX9cwlGfP-HqHZR1",
"d": "AAhRON2r9cqXX1hg-RoI6R1tX5p2rUAYdmpHZoC1XNM56KtscrX6zb
KipQrCW9CGZH3T4ubpnoTKLDYJ_fF3_rJt"
}
</pre>
<p class="figure">Figure 14: Elliptic Curve P-521 Private Key</p>
<h1 id="rfc.section.3.3.2"><a href="#rfc.section.3.3.2">3.3.2.</a> <a href="#jws-ecdsa-op" id="jws-ecdsa-op">Signing Operation</a></h1>
<p id="rfc.section.3.3.2.p.1">The following are generated before beginning the signature process:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-ecdsa-protected">Figure 15</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-ecdsa-protected_b64u">Figure 16</a>.</li>
</ul>
<div id="rfc.figure.15"/>
<div id="jws-ecdsa-protected"/>
<pre>
{
"alg": "ES512",
"kid": "bilbo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 15: Protected JWS Header JSON</p>
<div id="rfc.figure.16"/>
<div id="jws-ecdsa-protected_b64u"/>
<pre>
eyJhbGciOiJFUzUxMiIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
</pre>
<p class="figure">Figure 16: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.3.2.p.3">Performing the signature operation over the combined protected JWS header (<a href="#jws-ecdsa-protected_b64u">Figure 16</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.17"/>
<div id="jws-ecdsa-sig"/>
<pre>
AE_R_YZCChjn4791jSQCrdPZCNYqHXCTZH0-JZGYNlaAjP2kqaluUIIUnC9qvb
u9Plon7KRTzoNEuT4Va2cmL1eJAQy3mtPBu_u_sDDyYjnAMDxXPn7XrT0lw-kv
AD890jl8e2puQens_IEKBpHABlsbEPX6sFY8OcGDqoRuBomu9xQ2
</pre>
<p class="figure">Figure 17: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.3.3"><a href="#rfc.section.3.3.3">3.3.3.</a> <a href="#jws-ecdsa-output" id="jws-ecdsa-output">Output Results</a></h1>
<p id="rfc.section.3.3.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-ecdsa-protected_b64u">Figure 16</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-ecdsa-sig">Figure 17</a>)</li>
</ul>
<p id="rfc.section.3.3.3.p.3">The resulting JWS object using the Compact serialization:</p>
<div id="rfc.figure.18"/>
<div id="jws-ecdsa-compact"/>
<pre>
eyJhbGciOiJFUzUxMiIsImtpZCI6ImJpbGJvLmJhZ2dpbnNAaG9iYml0b24uZX
hhbXBsZSJ9
.
SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywgZ29pbmcgb3V0IH
lvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9hZCwgYW5kIGlmIHlvdSBk
b24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXigJlzIG5vIGtub3dpbmcgd2hlcm
UgeW91IG1pZ2h0IGJlIHN3ZXB0IG9mZiB0by4
.
AE_R_YZCChjn4791jSQCrdPZCNYqHXCTZH0-JZGYNlaAjP2kqaluUIIUnC9qvb
u9Plon7KRTzoNEuT4Va2cmL1eJAQy3mtPBu_u_sDDyYjnAMDxXPn7XrT0lw-kv
AD890jl8e2puQens_IEKBpHABlsbEPX6sFY8OcGDqoRuBomu9xQ2
</pre>
<p class="figure">Figure 18: Compact Serialization</p>
<p id="rfc.section.3.3.3.p.4">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.19"/>
<div id="jws-ecdsa-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJFUzUxMiIsImtpZCI6ImJpbGJvLmJhZ2
dpbnNAaG9iYml0b24uZXhhbXBsZSJ9",
"signature": "AE_R_YZCChjn4791jSQCrdPZCNYqHXCTZH0-JZGYNl
aAjP2kqaluUIIUnC9qvbu9Plon7KRTzoNEuT4Va2cmL1eJAQy3mt
PBu_u_sDDyYjnAMDxXPn7XrT0lw-kvAD890jl8e2puQens_IEKBp
HABlsbEPX6sFY8OcGDqoRuBomu9xQ2"
}
]
}
</pre>
<p class="figure">Figure 19: JSON Serialization</p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> <a href="#jws-hmac" id="jws-hmac">HMAC-SHA2 Integrity Protection</a></h1>
<p id="rfc.section.3.4.p.1">This example illustrates integrity protecting content using the &#8220;HS256&#8221; (HMAC-SHA-256) algorithm.</p>
<h1 id="rfc.section.3.4.1"><a href="#rfc.section.3.4.1">3.4.1.</a> <a href="#jws-hmac-input" id="jws-hmac-input">Input Factors</a></h1>
<p id="rfc.section.3.4.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>HMAC symmetric key; this example uses the key from <a href="#jws-hmac-key">Figure 20</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;HS256&#8221;.</li>
</ul>
<div id="rfc.figure.20"/>
<div id="jws-hmac-key"/>
<pre>
{
"kty": "oct",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037",
"use": "sig",
"k": "hJtXIZ2uSN5kbQfbtTNWbpdmhkV8FJG-Onbc6mxCcYg"
}
</pre>
<p class="figure">Figure 20: AES 256-bit symmetric key</p>
<h1 id="rfc.section.3.4.2"><a href="#rfc.section.3.4.2">3.4.2.</a> <a href="#jws-hmac-op" id="jws-hmac-op">Signing Operation</a></h1>
<p id="rfc.section.3.4.2.p.1">The following are generated before completing the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-hmac-protected">Figure 21</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-hmac-protected_b64u">Figure 22</a>.</li>
</ul>
<div id="rfc.figure.21"/>
<div id="jws-hmac-protected"/>
<pre>
{
"alg": "HS256",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
}
</pre>
<p class="figure">Figure 21: Protected JWS Header JSON</p>
<div id="rfc.figure.22"/>
<div id="jws-hmac-protected_b64u"/>
<pre>
eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOWItNDcxYi1iZmQ2LW
VlZjMxNGJjNzAzNyJ9
</pre>
<p class="figure">Figure 22: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.4.2.p.3">Performing the signature operation over the combined protected JWS header (<a href="#jws-hmac-protected_b64u">Figure 22</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.23"/>
<div id="jws-hmac-sig"/>
<pre>
s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0
</pre>
<p class="figure">Figure 23: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.4.3"><a href="#rfc.section.3.4.3">3.4.3.</a> <a href="#jws-hmac-output" id="jws-hmac-output">Output Results</a></h1>
<p id="rfc.section.3.4.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-hmac-protected_b64u">Figure 22</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-hmac-sig">Figure 23</a>)</li>
</ul>
<p id="rfc.section.3.4.3.p.3">The resulting JWS object using the Compact serialization:</p>
<div id="rfc.figure.24"/>
<div id="jws-hmac-compact"/>
<pre>
eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOWItNDcxYi1iZmQ2LW
VlZjMxNGJjNzAzNyJ9
.
SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywgZ29pbmcgb3V0IH
lvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9hZCwgYW5kIGlmIHlvdSBk
b24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXigJlzIG5vIGtub3dpbmcgd2hlcm
UgeW91IG1pZ2h0IGJlIHN3ZXB0IG9mZiB0by4
.
s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0
</pre>
<p class="figure">Figure 24: Compact Serialization</p>
<p id="rfc.section.3.4.3.p.4">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.25"/>
<div id="jws-hmac-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LT
RkOWItNDcxYi1iZmQ2LWVlZjMxNGJjNzAzNyJ9",
"signature": "s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p
0"
}
]
}
</pre>
<p class="figure">Figure 25: JSON Serialization</p>
<h1 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5.</a> <a href="#jws-detached" id="jws-detached">Detached Signature</a></h1>
<p id="rfc.section.3.5.p.1">This example illustrates a detached signature.  This example is identical others, except the resulting JWS objects do not include the Payload content.  Instead, the application is expected to locate it elsewhere.  For example, the signature might be in a meta-data section, with the payload being the content.</p>
<h1 id="rfc.section.3.5.1"><a href="#rfc.section.3.5.1">3.5.1.</a> <a href="#jws-detached-input" id="jws-detached-input">Input Factors</a></h1>
<p id="rfc.section.3.5.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>Signing key; this example uses the AES symmetric key from <a href="#jws-hmac-key">Figure 20</a>.</li>
<li>Signing algorithm; this example uses &#8220;HS256&#8221;.</li>
</ul>
<h1 id="rfc.section.3.5.2"><a href="#rfc.section.3.5.2">3.5.2.</a> <a href="#jws-detached-op" id="jws-detached-op">Signing Operation</a></h1>
<p id="rfc.section.3.5.2.p.1">The following are generated before completing the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-detached-protected">Figure 26</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-detached-protected_b64u">Figure 27</a>.</li>
</ul>
<p id="rfc.section.3.5.2.p.3">The protected JWS header parameters:</p>
<div id="rfc.figure.26"/>
<div id="jws-detached-protected"/>
<pre>
{
"alg": "HS256",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
}
</pre>
<p class="figure">Figure 26: Protected JWS Header JSON</p>
<div id="rfc.figure.27"/>
<div id="jws-detached-protected_b64u"/>
<pre>
eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOWItNDcxYi1iZmQ2LW
VlZjMxNGJjNzAzNyJ9
</pre>
<p class="figure">Figure 27: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.5.2.p.4">Performing the signature operation over the combined protected JWS header (<a href="#jws-detached-protected_b64u">Figure 27</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.28"/>
<div id="jws-detached-sig"/>
<pre>
s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0
</pre>
<p class="figure">Figure 28: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.5.3"><a href="#rfc.section.3.5.3">3.5.3.</a> <a href="#jws-detached-output" id="jws-detached-output">Output Results</a></h1>
<p id="rfc.section.3.5.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-detached-protected_b64u">Figure 27</a>)</li>
<li>Signature (<a href="#jws-detached-sig">Figure 28</a>)</li>
</ul>
<p id="rfc.section.3.5.3.p.3">The resulting JWS object using the Compact serialization:</p>
<div id="rfc.figure.29"/>
<div id="jws-detached-compact"/>
<pre>
eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOWItNDcxYi1iZmQ2LW
VlZjMxNGJjNzAzNyJ9
.
.
s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0
</pre>
<p class="figure">Figure 29: JSON Serialization</p>
<p id="rfc.section.3.5.3.p.4">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.30"/>
<div id="jws-detached-json"/>
<pre>
{
"signatures": [
{
"protected": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LT
RkOWItNDcxYi1iZmQ2LWVlZjMxNGJjNzAzNyJ9",
"signature": "s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p
0"
}
]
}
</pre>
<p class="figure">Figure 30: JSON Serialization</p>
<h1 id="rfc.section.3.6"><a href="#rfc.section.3.6">3.6.</a> <a href="#jws-somefields" id="jws-somefields">Protecting Specific Header Fields</a></h1>
<p id="rfc.section.3.6.p.1">This example illustrates a signature where only certain header parameters are protected.  Since this example contains both unprotected and protected header parameters, only the JSON serialization is possible.</p>
<h1 id="rfc.section.3.6.1"><a href="#rfc.section.3.6.1">3.6.1.</a> <a href="#jws-somefields-input" id="jws-somefields-input">Input Factors</a></h1>
<p id="rfc.section.3.6.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>Signing key; this example uses the AES symmetric key from <a href="#jws-hmac-key">Figure 20</a>.</li>
<li>Signing algorithm; this example uses &#8220;HS256&#8221;.</li>
</ul>
<h1 id="rfc.section.3.6.2"><a href="#rfc.section.3.6.2">3.6.2.</a> <a href="#jws-somefields-op" id="jws-somefields-op">Signing Operation</a></h1>
<p id="rfc.section.3.6.2.p.1">The following are generated before completing the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-somefields-protected">Figure 31</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-somefields-protected_b64u">Figure 32</a>.</li>
<li>Unprotected JWS Header; this example uses the header from <a href="#jws-somefields-unprotected">Figure 33</a>.</li>
</ul>
<p id="rfc.section.3.6.2.p.3">The protected JWS header parameters:</p>
<div id="rfc.figure.31"/>
<div id="jws-somefields-protected"/>
<pre>
{
"alg": "HS256"
}
</pre>
<p class="figure">Figure 31: Protected JWS Header JSON</p>
<div id="rfc.figure.32"/>
<div id="jws-somefields-protected_b64u"/>
<pre>
eyJhbGciOiJIUzI1NiJ9
</pre>
<p class="figure">Figure 32: Protected JWS Header, base64url-encoded</p>
<div id="rfc.figure.33"/>
<div id="jws-somefields-unprotected"/>
<pre>
{
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
}
</pre>
<p class="figure">Figure 33: Unprotected JWS Header JSON</p>
<p id="rfc.section.3.6.2.p.4">Performing the signature operation over the combined protected JWS header (<a href="#jws-somefields-protected_b64u">Figure 32</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.34"/>
<div id="jws-somefields-sig"/>
<pre>
bWUSVaxorn7bEF1djytBd0kHv70Ly5pvbomzMWSOr20
</pre>
<p class="figure">Figure 34: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.6.3"><a href="#rfc.section.3.6.3">3.6.3.</a> <a href="#jws-somefields-output" id="jws-somefields-output">Output Results</a></h1>
<p id="rfc.section.3.6.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jws-somefields-protected_b64u">Figure 32</a>)</li>
<li>Unprotected JWS header (<a href="#jws-somefields-unprotected">Figure 33</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-somefields-sig">Figure 34</a>)</li>
</ul>
<p id="rfc.section.3.6.3.p.3">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.35"/>
<div id="jws-somefields-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJIUzI1NiJ9",
"header": {
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
},
"signature": "bWUSVaxorn7bEF1djytBd0kHv70Ly5pvbomzMWSOr2
0"
}
]
}
</pre>
<p class="figure">Figure 35: JSON Serialization</p>
<h1 id="rfc.section.3.7"><a href="#rfc.section.3.7">3.7.</a> <a href="#jws-nofields" id="jws-nofields">Protecting Content Only</a></h1>
<p id="rfc.section.3.7.p.1">This example illustrates a signature where none of the header parameters are protected.  Since this example contains only unprotected header parameters, only the JSON serialization is possible.</p>
<h1 id="rfc.section.3.7.1"><a href="#rfc.section.3.7.1">3.7.1.</a> <a href="#jws-nofields-input" id="jws-nofields-input">Input Factors</a></h1>
<p id="rfc.section.3.7.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>Signing key; this example uses the AES key from <a href="#jws-hmac-key">Figure 20</a>.</li>
<li>Signing algorithm; this example uses &#8220;HS256&#8221;</li>
</ul>
<h1 id="rfc.section.3.7.2"><a href="#rfc.section.3.7.2">3.7.2.</a> <a href="#jws-nofields-op" id="jws-nofields-op">Signing Operation</a></h1>
<p id="rfc.section.3.7.2.p.1">The following are generated before completing the signing operation:</p>
<p/>

<ul>
<li>Unprotected JWS Header; this example uses the header from <a href="#jws-nofields-unprotected">Figure 36</a>.</li>
</ul>
<div id="rfc.figure.36"/>
<div id="jws-nofields-unprotected"/>
<pre>
{
"alg": "HS256",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
}
</pre>
<p class="figure">Figure 36: Unprotected JWS Header JSON</p>
<p id="rfc.section.3.7.2.p.3">Performing the signature operation over the combined empty string (as there is no protected JWS header) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.37"/>
<div id="jws-nofields-sig"/>
<pre>
xuLifqLGiblpv9zBpuZczWhNj1gARaLV3UxvxhJxZuk
</pre>
<p class="figure">Figure 37: Signature, base64url-encoded</p>
<h1 id="rfc.section.3.7.3"><a href="#rfc.section.3.7.3">3.7.3.</a> <a href="#jws-nofields-output" id="jws-nofields-output">Output Results</a></h1>
<p id="rfc.section.3.7.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Unprotected JWS header (<a href="#jws-nofields-unprotected">Figure 36</a>)</li>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature (<a href="#jws-nofields-sig">Figure 37</a>)</li>
</ul>
<p id="rfc.section.3.7.3.p.3">The resulting JWS object using the JSON serialization:</p>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"header": {
"alg": "HS256",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
},
"signature": "xuLifqLGiblpv9zBpuZczWhNj1gARaLV3UxvxhJxZu
k"
}
]
}
</pre>
<p class="figure">JSON Serialization</p>
<h1 id="rfc.section.3.8"><a href="#rfc.section.3.8">3.8.</a> <a href="#jws-multi" id="jws-multi">Multiple Signatures</a></h1>
<p id="rfc.section.3.8.p.1">This example illustrates multiple signatures applied to the same payload.  Since this example contains more than one signature, only the JSON serialization is possible.</p>
<h1 id="rfc.section.3.8.1"><a href="#rfc.section.3.8.1">3.8.1.</a> <a href="#jws-multi-input" id="jws-multi-input">Input Factors</a></h1>
<p id="rfc.section.3.8.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the content from <a href="#jws-payload">Figure 1</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-payload_b64u">Figure 2</a>.</li>
<li>Signing keys; this example uses the following:  <ul><li>RSA private key from <a href="#jws-rsa-key">Figure 3</a> for the first signature</li><li>EC private key from <a href="#jws-ecdsa-key">Figure 14</a> for the second signature</li><li>AES symmetric key from <a href="#jws-hmac-key">Figure 20</a> for the third signature</li></ul></li>
<li>Signing algorithms; this example uses the following:  <ul><li>&#8220;RS256&#8221; for the first signature</li><li>&#8220;ES512&#8221; for the second signature</li><li>&#8220;HS256&#8221; for the third signature</li></ul></li>
</ul>
<h1 id="rfc.section.3.8.2"><a href="#rfc.section.3.8.2">3.8.2.</a> <a href="#jws-multi-op_1" id="jws-multi-op_1">First Signing Operation</a></h1>
<p id="rfc.section.3.8.2.p.1">The following are generated before completing the first signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-multi-protected_1">Figure 38</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-multi-protected_b64u_1">Figure 39</a>.</li>
<li>Unprotected JWS Header; this example uses the header from <a href="#jws-multi-unprotected_1">Figure 40</a>.</li>
</ul>
<div id="rfc.figure.38"/>
<div id="jws-multi-protected_1"/>
<pre>
{
"alg": "RS256"
}
</pre>
<p class="figure">Figure 38: Signature #1 Protected JWS Header JSON</p>
<div id="rfc.figure.39"/>
<div id="jws-multi-protected_b64u_1"/>
<pre>
eyJhbGciOiJSUzI1NiJ9
</pre>
<p class="figure">Figure 39: Signature #1 Protected JWS Header, base64url-encoded</p>
<div id="rfc.figure.40"/>
<div id="jws-multi-unprotected_1"/>
<pre>
{
"kid": "bilbo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 40: Signature #1 JWS Header JSON</p>
<p id="rfc.section.3.8.2.p.3">Performing the first signature operation over the combined protected JWS header (<a href="#jws-multi-protected_b64u_1">Figure 39</a>) and the Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.41"/>
<div id="jws-multi-sig_1"/>
<pre>
MIsjqtVlOpa71KE-Mss8_Nq2YH4FGhiocsqrgi5NvyG53uoimic1tcMdSg-qpt
rzZc7CG6Svw2Y13TDIqHzTUrL_lR2ZFcryNFiHkSw129EghGpwkpxaTn_THJTC
glNbADko1MZBCdwzJxwqZc-1RlpO2HibUYyXSwO97BSe0_evZKdjvvKSgsIqjy
tKSeAMbhMBdMma622_BG5t4sdbuCHtFjp9iJmkio47AIwqkZV1aIZsv33uPUqB
BCXbYoQJwt7mxPftHmNlGoOSMxR_3thmXTCm4US-xiNOyhbm8afKK64jU6_TPt
QHiJeQJxz9G3Tx-083B745_AfYOnlC9w
</pre>
<p class="figure">Figure 41: Signature #1, base64url-encoded</p>
<p id="rfc.section.3.8.2.p.4">The following is the assembled first signature serialized as JSON:</p>
<div id="rfc.figure.42"/>
<div id="jws-multi-sig_sig_1"/>
<pre>
{
"protected": "eyJhbGciOiJSUzI1NiJ9",
"header": {
"kid": "bilbo.baggins@hobbiton.example"
},
"signature": "MIsjqtVlOpa71KE-Mss8_Nq2YH4FGhiocsqrgi5NvyG53u
oimic1tcMdSg-qptrzZc7CG6Svw2Y13TDIqHzTUrL_lR2ZFcryNFiHkS
w129EghGpwkpxaTn_THJTCglNbADko1MZBCdwzJxwqZc-1RlpO2HibUY
yXSwO97BSe0_evZKdjvvKSgsIqjytKSeAMbhMBdMma622_BG5t4sdbuC
HtFjp9iJmkio47AIwqkZV1aIZsv33uPUqBBCXbYoQJwt7mxPftHmNlGo
OSMxR_3thmXTCm4US-xiNOyhbm8afKK64jU6_TPtQHiJeQJxz9G3Tx-0
83B745_AfYOnlC9w"
}
</pre>
<p class="figure">Figure 42: Signature #1 JSON</p>
<h1 id="rfc.section.3.8.3"><a href="#rfc.section.3.8.3">3.8.3.</a> <a href="#jws-multi-op_2" id="jws-multi-op_2">Second Signing Operation</a></h1>
<p id="rfc.section.3.8.3.p.1">The following are generated before completing the second signing operation:</p>
<p/>

<ul>
<li>Unprotected JWS Header; this example uses the header from <a href="#jws-multi-unprotected_2">Figure 43</a>.</li>
</ul>
<div id="rfc.figure.43"/>
<div id="jws-multi-unprotected_2"/>
<pre>
{
"alg": "ES512",
"kid": "bilbo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 43: Signature #2 JWS Header JSON</p>
<p id="rfc.section.3.8.3.p.3">Performing the second signature operation over the combined empty string (as there is no protected JWS header) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.44"/>
<div id="jws-multi-sig_2"/>
<pre>
ARcVLnaJJaUWG8fG-8t5BREVAuTY8n8YHjwDO1muhcdCoFZFFjfISu0Cdkn9Yb
dlmi54ho0x924DUz8sK7ZXkhc7AFM8ObLfTvNCrqcI3Jkl2U5IX3utNhODH6v7
xgy1Qahsn0fyb4zSAkje8bAWz4vIfj5pCMYxxm4fgV3q7ZYhm5eD
</pre>
<p class="figure">Figure 44: Signature #2, base64url-encoded</p>
<p id="rfc.section.3.8.3.p.4">The following is the assembled second signature serialized as JSON:</p>
<div id="rfc.figure.45"/>
<div id="jws-multi-sig_sig_2"/>
<pre>
{
"header": {
"alg": "ES512",
"kid": "bilbo.baggins@hobbiton.example"
},
"signature": "ARcVLnaJJaUWG8fG-8t5BREVAuTY8n8YHjwDO1muhcdCoF
ZFFjfISu0Cdkn9Ybdlmi54ho0x924DUz8sK7ZXkhc7AFM8ObLfTvNCrq
cI3Jkl2U5IX3utNhODH6v7xgy1Qahsn0fyb4zSAkje8bAWz4vIfj5pCM
Yxxm4fgV3q7ZYhm5eD"
}
</pre>
<p class="figure">Figure 45: Signature #2 JSON</p>
<h1 id="rfc.section.3.8.4"><a href="#rfc.section.3.8.4">3.8.4.</a> <a href="#jws-multi-op_3" id="jws-multi-op_3">Third Signing Operation</a></h1>
<p id="rfc.section.3.8.4.p.1">The following are generated before completing the third signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses the header from <a href="#jws-multi-protected_3">Figure 46</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jws-multi-protected_b64u_3">Figure 47</a>.</li>
</ul>
<div id="rfc.figure.46"/>
<div id="jws-multi-protected_3"/>
<pre>
{
"alg": "HS256",
"kid": "018c0ae5-4d9b-471b-bfd6-eef314bc7037"
}
</pre>
<p class="figure">Figure 46: Signature #3 Protected JWS Header JSON</p>
<div id="rfc.figure.47"/>
<div id="jws-multi-protected_b64u_3"/>
<pre>
eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOWItNDcxYi1iZmQ2LW
VlZjMxNGJjNzAzNyJ9
</pre>
<p class="figure">Figure 47: Signature #3 Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.3.8.4.p.3">Performing the third signature operation over the combined protected JWS header (<a href="#jws-multi-protected_b64u_3">Figure 47</a>) and Payload content (<a href="#jws-payload_b64u">Figure 2</a>) produces the following signature:</p>
<div id="rfc.figure.48"/>
<div id="jws-multi-sig_3"/>
<pre>
s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0
</pre>
<p class="figure">Figure 48: Signature #3, base64url-encoded</p>
<p id="rfc.section.3.8.4.p.4">The following is the assembled third signature serialized as JSON:</p>
<div id="rfc.figure.49"/>
<div id="jws-multi-sig_sig_3"/>
<pre>
{
"protected": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LTRkOW
ItNDcxYi1iZmQ2LWVlZjMxNGJjNzAzNyJ9",
"signature": "s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p0"
}
</pre>
<p class="figure">Figure 49: Signature #3 JSON</p>
<h1 id="rfc.section.3.8.5"><a href="#rfc.section.3.8.5">3.8.5.</a> <a href="#jws-multi-output" id="jws-multi-output">Output Results</a></h1>
<p id="rfc.section.3.8.5.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Payload content (<a href="#jws-payload_b64u">Figure 2</a>)</li>
<li>Signature #1 JSON (<a href="#jws-multi-sig_sig_1">Figure 42</a>)</li>
<li>Signature #2 JSON (<a href="#jws-multi-sig_sig_2">Figure 45</a>)</li>
<li>Signature #3 JSON (<a href="#jws-multi-sig_sig_3">Figure 49</a>)</li>
</ul>
<p id="rfc.section.3.8.5.p.3">The resulting JWS object using the JSON serialization:</p>
<div id="rfc.figure.50"/>
<div id="jws-multi-json"/>
<pre>
{
"payload": "SXTigJlzIGEgZGFuZ2Vyb3VzIGJ1c2luZXNzLCBGcm9kbywg
Z29pbmcgb3V0IHlvdXIgZG9vci4gWW91IHN0ZXAgb250byB0aGUgcm9h
ZCwgYW5kIGlmIHlvdSBkb24ndCBrZWVwIHlvdXIgZmVldCwgdGhlcmXi
gJlzIG5vIGtub3dpbmcgd2hlcmUgeW91IG1pZ2h0IGJlIHN3ZXB0IG9m
ZiB0by4",
"signatures": [
{
"protected": "eyJhbGciOiJSUzI1NiJ9",
"header": {
"kid": "bilbo.baggins@hobbiton.example"
},
"signature": "MIsjqtVlOpa71KE-Mss8_Nq2YH4FGhiocsqrgi5Nvy
G53uoimic1tcMdSg-qptrzZc7CG6Svw2Y13TDIqHzTUrL_lR2ZFc
ryNFiHkSw129EghGpwkpxaTn_THJTCglNbADko1MZBCdwzJxwqZc
-1RlpO2HibUYyXSwO97BSe0_evZKdjvvKSgsIqjytKSeAMbhMBdM
ma622_BG5t4sdbuCHtFjp9iJmkio47AIwqkZV1aIZsv33uPUqBBC
XbYoQJwt7mxPftHmNlGoOSMxR_3thmXTCm4US-xiNOyhbm8afKK6
4jU6_TPtQHiJeQJxz9G3Tx-083B745_AfYOnlC9w"
},
{
"header": {
"alg": "ES512",
"kid": "bilbo.baggins@hobbiton.example"
},
"signature": "ARcVLnaJJaUWG8fG-8t5BREVAuTY8n8YHjwDO1muhc
dCoFZFFjfISu0Cdkn9Ybdlmi54ho0x924DUz8sK7ZXkhc7AFM8Ob
LfTvNCrqcI3Jkl2U5IX3utNhODH6v7xgy1Qahsn0fyb4zSAkje8b
AWz4vIfj5pCMYxxm4fgV3q7ZYhm5eD"
},
{
"protected": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjAxOGMwYWU1LT
RkOWItNDcxYi1iZmQ2LWVlZjMxNGJjNzAzNyJ9",
"signature": "s0h6KThzkfBBBkLspW1h84VsJZFTsPPqMDA7g1Md7p
0"
}
]
}
</pre>
<p class="figure">Figure 50: JSON Serialization</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#jwe" id="jwe">JSON Web Encryption Examples</a></h1>
<p id="rfc.section.4.p.1">The following sections demonstrate how to generate various JWE objects.</p>
<p id="rfc.section.4.p.2">All of the succeeding examples (unless otherwise noted) use the following plaintext content, serialized as UTF-8, with the sequence &#8220;\xe2\x80\x93&#8221; replacing (U+2013 EN DASH) and line breaks (U+000A LINE FEED) replacing some &#8220; &#8220; (U+0020 SPACE) characters to improve formatting:</p>
<div id="rfc.figure.51"/>
<div id="jwe-plaintext"/>
<pre>
You can trust us to stick with you through thick and
thin\xe2\x80\x93to the bitter end. And you can trust us to
keep any secret of yours\xe2\x80\x93closer than you keep it
yourself. But you cannot trust us to let you face trouble
alone, and go off without a word. We are your friends, Frodo.
</pre>
<p class="figure">Figure 51: Plaintext content</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#jwe-rsa15" id="jwe-rsa15">Key Encryption using RSA v1.5 and AES-HMAC-SHA2</a></h1>
<p id="rfc.section.4.1.p.1">This example illustrates encrypting content using the &#8220;RSA1_5&#8221; (RSAES-PKCS1-v1_5) key encryption algorithm and the &#8220;A128CBC-HS256&#8221; (AES-128-CBC-HMAC-SHA-256) content encryption algorithm.</p>
<h1 id="rfc.section.4.1.1"><a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#jwe-rsa15-input" id="jwe-rsa15-input">Input Factors</a></h1>
<p id="rfc.section.4.1.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>RSA public key; this example uses the key from <a href="#jwe-rsa15-key">Figure 52</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;RSA1_5&#8221;.</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128CBC-HS256&#8221;.</li>
</ul>
<div id="rfc.figure.52"/>
<div id="jwe-rsa15-key"/>
<pre>
{
"kty": "RSA",
"kid": "frodo.baggins@hobbiton.example",
"use": "enc",
"n": "maxhbsmBtdQ3CNrKvprUE6n9lYcregDMLYNeTAWcLj8NnPU9XIYegT
HVHQjxKDSHP2l-F5jS7sppG1wgdAqZyhnWvXhYNvcM7RfgKxqNx_xAHx
6f3yy7s-M9PSNCwPC2lh6UAkR4I00EhV9lrypM9Pi4lBUop9t5fS9W5U
NwaAllhrd-osQGPjIeI1deHTwx-ZTHu3C60Pu_LJIl6hKn9wbwaUmA4c
R5Bd2pgbaY7ASgsjCUbtYJaNIHSoHXprUdJZKUMAzV0WOKPfA6OPI4oy
pBadjvMZ4ZAj3BnXaSYsEZhaueTXvZB4eZOAjIyh2e_VOIKVMsnDrJYA
VotGlvMQ",
"e": "AQAB",
"d": "Kn9tgoHfiTVi8uPu5b9TnwyHwG5dK6RE0uFdlpCGnJN7ZEi963R7wy
bQ1PLAHmpIbNTztfrheoAniRV1NCIqXaW_qS461xiDTp4ntEPnqcKsyO
5jMAji7-CL8vhpYYowNFvIesgMoVaPRYMYT9TW63hNM0aWs7USZ_hLg6
Oe1mY0vHTI3FucjSM86Nff4oIENt43r2fspgEPGRrdE6fpLc9Oaq-qeP
1GFULimrRdndm-P8q8kvN3KHlNAtEgrQAgTTgz80S-3VD0FgWfgnb1PN
miuPUxO8OpI9KDIfu_acc6fg14nsNaJqXe6RESvhGPH2afjHqSy_Fd2v
pzj85bQQ",
"p": "2DwQmZ43FoTnQ8IkUj3BmKRf5Eh2mizZA5xEJ2MinUE3sdTYKSLtaE
oekX9vbBZuWxHdVhM6UnKCJ_2iNk8Z0ayLYHL0_G21aXf9-unynEpUsH
7HHTklLpYAzOOx1ZgVljoxAdWNn3hiEFrjZLZGS7lOH-a3QQlDDQoJOJ
2VFmU",
"q": "te8LY4-W7IyaqH1ExujjMqkTAlTeRbv0VLQnfLY2xINnrWdwiQ93_V
F099aP1ESeLja2nw-6iKIe-qT7mtCPozKfVtUYfz5HrJ_XY2kfexJINb
9lhZHMv5p1skZpeIS-GPHCC6gRlKo1q-idn_qxyusfWv7WAxlSVfQfk8
d6Et0",
"dp": "UfYKcL_or492vVc0PzwLSplbg4L3-Z5wL48mwiswbpzOyIgd2xHTH
QmjJpFAIZ8q-zf9RmgJXkDrFs9rkdxPtAsL1WYdeCT5c125Fkdg317JV
RDo1inX7x2Kdh8ERCreW8_4zXItuTl_KiXZNU5lvMQjWbIw2eTx1lpsf
lo0rYU",
"dq": "iEgcO-QfpepdH8FWd7mUFyrXdnOkXJBCogChY6YKuIHGc_p8Le9Mb
pFKESzEaLlN1Ehf3B6oGBl5Iz_ayUlZj2IoQZ82znoUrpa9fVYNot87A
CfzIG7q9Mv7RiPAderZi03tkVXAdaBau_9vs5rS-7HMtxkVrxSUvJY14
TkXlHE",
"qi": "kC-lzZOqoFaZCr5l0tOVtREKoVqaAYhQiqIRGL-MzS4sCmRkxm5vZ
lXYx6RtE1n_AagjqajlkjieGlxTTThHD8Iga6foGBMaAr5uR1hGQpSc7
Gl7CF1DZkBJMTQN6EshYzZfxW08mIO8M6Rzuh0beL6fG9mkDcIyPrBXx
2bQ_mM"
}
</pre>
<p class="figure">Figure 52: RSA 2048-bit Key, in JWK format</p>
<p id="rfc.section.4.1.1.p.3">(<strong>NOTE</strong>: While the key includes the private parameters, only the public parameters &#8220;e&#8221; and &#8220;n&#8221; are necessary for the encryption operation.)</p>
<h1 id="rfc.section.4.1.2"><a href="#rfc.section.4.1.2">4.1.2.</a> <a href="#jwe-rsa15-gen" id="jwe-rsa15-gen">Generated Factors</a></h1>
<p id="rfc.section.4.1.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-rsa15-cek">Figure 53</a></li>
<li>Initialization vector/nonce; this example uses the initialization vector from <a href="#jwe-rsa15-iv">Figure 54</a></li>
</ul>
<div id="rfc.figure.53"/>
<div id="jwe-rsa15-cek"/>
<pre>
3qyTVhIWt5juqZUCpfRqpvauwB956MEJL2Rt-8qXKSo
</pre>
<p class="figure">Figure 53: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.54"/>
<div id="jwe-rsa15-iv"/>
<pre>
bbd5sTkYwhAIqfHsx8DayA
</pre>
<p class="figure">Figure 54: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.1.3"><a href="#rfc.section.4.1.3">4.1.3.</a> <a href="#jwe-rsa15-keyenc" id="jwe-rsa15-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.1.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-rsa15-cek">Figure 53</a>) with the RSA key (<a href="#jwe-rsa15-key">Figure 52</a>) results in the following encrypted key:</p>
<div id="rfc.figure.55"/>
<div id="jwe-rsa15-encdkey"/>
<pre>
laLxI0j-nLH-_BgLOXMozKxmy9gffy2gTdvqzfTihJBuuzxg0V7yk1WClnQePF
vG2K-pvSlWc9BRIazDrn50RcRai__3TDON395H3c62tIouJJ4XaRvYHFjZTZ2G
Xfz8YAImcc91Tfk0WXC2F5Xbb71ClQ1DDH151tlpH77f2ff7xiSxh9oSewYrcG
TSLUeeCt36r1Kt3OSj7EyBQXoZlN7IxbyhMAfgIe7Mv1rOTOI5I8NQqeXXW8Vl
zNmoxaGMny3YnGir5Wf6Qt2nBq4qDaPdnaAuuGUGEecelIO1wx1BpyIfgvfjOh
MBs9M8XL223Fg47xlGsMXdfuY-4jaqVw
</pre>
<p class="figure">Figure 55: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.1.4"><a href="#rfc.section.4.1.4">4.1.4.</a> <a href="#jwe-rsa15-contentenc" id="jwe-rsa15-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.1.4.p.1">The following are generated before encrypting the plaintext:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-rsa15-protected">Figure 56</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jwe-rsa15-protected_b64u">Figure 57</a>.</li>
</ul>
<div id="rfc.figure.56"/>
<div id="jwe-rsa15-protected"/>
<pre>
{
"alg": "RSA1_5",
"kid": "frodo.baggins@hobbiton.example",
"enc": "A128CBC-HS256"
}
</pre>
<p class="figure">Figure 56: Protected JWE Header JSON</p>
<div id="rfc.figure.57"/>
<div id="jwe-rsa15-protected_b64u"/>
<pre>
eyJhbGciOiJSU0ExXzUiLCJraWQiOiJmcm9kby5iYWdnaW5zQGhvYmJpdG9uLm
V4YW1wbGUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0
</pre>
<p class="figure">Figure 57: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.1.4.p.3">Performing the content encryption operation on the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) using the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-rsa15-cek">Figure 53</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-rsa15-iv">Figure 54</a>); and</li>
<li>Protected JWE header (<a href="#jwe-rsa15-protected">Figure 56</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.1.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-rsa15-ciphertext">Figure 58</a>.</li>
<li>Authentication tag from <a href="#jwe-rsa15-tag">Figure 59</a>.</li>
</ul>
<div id="rfc.figure.58"/>
<div id="jwe-rsa15-ciphertext"/>
<pre>
0fys_TY_na7f8dwSfXLiYdHaA2DxUjD67ieF7fcVbIR62JhJvGZ4_FNVSiGc_r
aa0HnLQ6s1P2sv3Xzl1p1l_o5wR_RsSzrS8Z-wnI3Jvo0mkpEEnlDmZvDu_k8O
WzJv7eZVEqiWKdyVzFhPpiyQU28GLOpRc2VbVbK4dQKPdNTjPPEmRqcaGeTWZV
yeSUvf5k59yJZxRuSvWFf6KrNtmRdZ8R4mDOjHSrM_s8uwIFcqt4r5GX8TKaI0
zT5CbL5Qlw3sRc7u_hg0yKVOiRytEAEs3vZkcfLkP6nbXdC_PkMdNS-ohP78T2
O6_7uInMGhFeX4ctHG7VelHGiT93JfWDEQi5_V9UN1rhXNrYu-0fVMkZAKX3VW
i7lzA6BP430m
</pre>
<p class="figure">Figure 58: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.59"/>
<div id="jwe-rsa15-tag"/>
<pre>
kvKuFBXHe5mQr4lqgobAUg
</pre>
<p class="figure">Figure 59: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.1.5"><a href="#rfc.section.4.1.5">4.1.5.</a> <a href="#jwe-rsa15-output" id="jwe-rsa15-output">Output Results</a></h1>
<p id="rfc.section.4.1.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-rsa15-protected_b64u">Figure 57</a>).</li>
<li>Encrypted Key (<a href="#jwe-rsa15-encdkey">Figure 55</a>).</li>
<li>Initialization vector/nonce (<a href="#jwe-rsa15-iv">Figure 54</a>).</li>
<li>Ciphertext (<a href="#jwe-rsa15-ciphertext">Figure 58</a>).</li>
<li>Authentication Tag (<a href="#jwe-rsa15-tag">Figure 59</a>).</li>
</ul>
<p id="rfc.section.4.1.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.60"/>
<div id="jwe-rsa15-compact"/>
<pre>
eyJhbGciOiJSU0ExXzUiLCJraWQiOiJmcm9kby5iYWdnaW5zQGhvYmJpdG9uLm
V4YW1wbGUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0
.
laLxI0j-nLH-_BgLOXMozKxmy9gffy2gTdvqzfTihJBuuzxg0V7yk1WClnQePF
vG2K-pvSlWc9BRIazDrn50RcRai__3TDON395H3c62tIouJJ4XaRvYHFjZTZ2G
Xfz8YAImcc91Tfk0WXC2F5Xbb71ClQ1DDH151tlpH77f2ff7xiSxh9oSewYrcG
TSLUeeCt36r1Kt3OSj7EyBQXoZlN7IxbyhMAfgIe7Mv1rOTOI5I8NQqeXXW8Vl
zNmoxaGMny3YnGir5Wf6Qt2nBq4qDaPdnaAuuGUGEecelIO1wx1BpyIfgvfjOh
MBs9M8XL223Fg47xlGsMXdfuY-4jaqVw
.
bbd5sTkYwhAIqfHsx8DayA
.
0fys_TY_na7f8dwSfXLiYdHaA2DxUjD67ieF7fcVbIR62JhJvGZ4_FNVSiGc_r
aa0HnLQ6s1P2sv3Xzl1p1l_o5wR_RsSzrS8Z-wnI3Jvo0mkpEEnlDmZvDu_k8O
WzJv7eZVEqiWKdyVzFhPpiyQU28GLOpRc2VbVbK4dQKPdNTjPPEmRqcaGeTWZV
yeSUvf5k59yJZxRuSvWFf6KrNtmRdZ8R4mDOjHSrM_s8uwIFcqt4r5GX8TKaI0
zT5CbL5Qlw3sRc7u_hg0yKVOiRytEAEs3vZkcfLkP6nbXdC_PkMdNS-ohP78T2
O6_7uInMGhFeX4ctHG7VelHGiT93JfWDEQi5_V9UN1rhXNrYu-0fVMkZAKX3VW
i7lzA6BP430m
.
kvKuFBXHe5mQr4lqgobAUg
</pre>
<p class="figure">Figure 60: Compact Serialization</p>
<p id="rfc.section.4.1.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.61"/>
<div id="jwe-rsa15-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "laLxI0j-nLH-_BgLOXMozKxmy9gffy2gTdvqzf
TihJBuuzxg0V7yk1WClnQePFvG2K-pvSlWc9BRIazDrn50RcRai_
_3TDON395H3c62tIouJJ4XaRvYHFjZTZ2GXfz8YAImcc91Tfk0WX
C2F5Xbb71ClQ1DDH151tlpH77f2ff7xiSxh9oSewYrcGTSLUeeCt
36r1Kt3OSj7EyBQXoZlN7IxbyhMAfgIe7Mv1rOTOI5I8NQqeXXW8
VlzNmoxaGMny3YnGir5Wf6Qt2nBq4qDaPdnaAuuGUGEecelIO1wx
1BpyIfgvfjOhMBs9M8XL223Fg47xlGsMXdfuY-4jaqVw"
}
],
"protected": "eyJhbGciOiJSU0ExXzUiLCJraWQiOiJmcm9kby5iYWdnaW
5zQGhvYmJpdG9uLmV4YW1wbGUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In
0",
"iv": "bbd5sTkYwhAIqfHsx8DayA",
"ciphertext": "0fys_TY_na7f8dwSfXLiYdHaA2DxUjD67ieF7fcVbIR62
JhJvGZ4_FNVSiGc_raa0HnLQ6s1P2sv3Xzl1p1l_o5wR_RsSzrS8Z-wn
I3Jvo0mkpEEnlDmZvDu_k8OWzJv7eZVEqiWKdyVzFhPpiyQU28GLOpRc
2VbVbK4dQKPdNTjPPEmRqcaGeTWZVyeSUvf5k59yJZxRuSvWFf6KrNtm
RdZ8R4mDOjHSrM_s8uwIFcqt4r5GX8TKaI0zT5CbL5Qlw3sRc7u_hg0y
KVOiRytEAEs3vZkcfLkP6nbXdC_PkMdNS-ohP78T2O6_7uInMGhFeX4c
tHG7VelHGiT93JfWDEQi5_V9UN1rhXNrYu-0fVMkZAKX3VWi7lzA6BP4
30m",
"tag": "kvKuFBXHe5mQr4lqgobAUg"
}
</pre>
<p class="figure">Figure 61: JSON Serialization</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#jwe-rsa_oaep" id="jwe-rsa_oaep">Key Encryption using RSA-OAEP with A256GCM</a></h1>
<p id="rfc.section.4.2.p.1">This example illustrates encrypting content using the &#8220;RSA-OAEP&#8221; (RSAES-OAEP) key encryption algorithm and the &#8220;A256GCM&#8221; (AES-GCM) content encryption algorithm.</p>
<h1 id="rfc.section.4.2.1"><a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#jwe-rsa_oaep-input" id="jwe-rsa_oaep-input">Input Factors</a></h1>
<p id="rfc.section.4.2.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the plaintext from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>RSA public key; this example uses the key from <a href="#jwe-rsa_oaep-key">Figure 62</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;RSA-OAEP&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A256GCM&#8221;</li>
</ul>
<div id="rfc.figure.62"/>
<div id="jwe-rsa_oaep-key"/>
<pre>
{
"kty": "RSA",
"kid": "samwise.gamgee@hobbiton.example",
"use": "enc",
"n": "wbdxI55VaanZXPY29Lg5hdmv2XhvqAhoxUkanfzf2-5zVUxa6prHRr
I4pP1AhoqJRlZfYtWWd5mmHRG2pAHIlh0ySJ9wi0BioZBl1XP2e-C-Fy
XJGcTy0HdKQWlrfhTm42EW7Vv04r4gfao6uxjLGwfpGrZLarohiWCPnk
Nrg71S2CuNZSQBIPGjXfkmIy2tl_VWgGnL22GplyXj5YlBLdxXp3XeSt
sqo571utNfoUTU8E4qdzJ3U1DItoVkPGsMwlmmnJiwA7sXRItBCivR4M
5qnZtdw-7v4WuR4779ubDuJ5nalMv2S66-RPcnFAzWSKxtBDnFJJDGIU
e7Tzizjg1nms0Xq_yPub_UOlWn0ec85FCft1hACpWG8schrOBeNqHBOD
FskYpUc2LC5JA2TaPF2dA67dg1TTsC_FupfQ2kNGcE1LgprxKHcVWYQb
86B-HozjHZcqtauBzFNV5tbTuB-TpkcvJfNcFLlH3b8mb-H_ox35FjqB
SAjLKyoeqfKTpVjvXhd09knwgJf6VKq6UC418_TOljMVfFTWXUxlnfhO
OnzW6HSSzD1c9WrCuVzsUMv54szidQ9wf1cYWf3g5qFDxDQKis99gcDa
iCAwM3yEBIzuNeeCa5dartHDb1xEB_HcHSeYbghbMjGfasvKn0aZRsnT
yC0xhWBlsolZE",
"e": "AQAB",
"alg": "RSA-OAEP",
"d": "n7fzJc3_WG59VEOBTkayzuSMM780OJQuZjN_KbH8lOZG25ZoA7T4Bx
cc0xQn5oZE5uSCIwg91oCt0JvxPcpmqzaJZg1nirjcWZ-oBtVk7gCAWq
-B3qhfF3izlbkosrzjHajIcY33HBhsy4_WerrXg4MDNE4HYojy68TcxT
2LYQRxUOCf5TtJXvM8olexlSGtVnQnDRutxEUCwiewfmmrfveEogLx9E
A-KMgAjTiISXxqIXQhWUQX1G7v_mV_Hr2YuImYcNcHkRvp9E7ook0876
DhkO8v4UOZLwA1OlUX98mkoqwc58A_Y2lBYbVx1_s5lpPsEqbbH-nqIj
h1fL0gdNfihLxnclWtW7pCztLnImZAyeCWAG7ZIfv-Rn9fLIv9jZ6r7r
-MSH9sqbuziHN2grGjD_jfRluMHa0l84fFKl6bcqN1JWxPVhzNZo01yD
F-1LiQnqUYSepPf6X3a2SOdkqBRiquE6EvLuSYIDpJq3jDIsgoL8Mo1L
oomgiJxUwL_GWEOGu28gplyzm-9Q0U0nyhEf1uhSR8aJAQWAiFImWH5W
_IQT9I7-yrindr_2fWQ_i1UgMsGzA7aOGzZfPljRy6z-tY_KuBG00-28
S_aWvjyUc-Alp8AUyKjBZ-7CWH32fGWK48j1t-zomrwjL_mnhsPbGs0c
9WsWgRzI-K8gE",
"p": "7_2v3OQZzlPFcHyYfLABQ3XP85Es4hCdwCkbDeltaUXgVy9l9etKgh
vM4hRkOvbb01kYVuLFmxIkCDtpi-zLCYAdXKrAK3PtSbtzld_XZ9nlsY
a_QZWpXB_IrtFjVfdKUdMz94pHUhFGFj7nr6NNxfpiHSHWFE1zD_AC3m
Y46J961Y2LRnreVwAGNw53p07Db8yD_92pDa97vqcZOdgtybH9q6uma-
RFNhO1AoiJhYZj69hjmMRXx-x56HO9cnXNbmzNSCFCKnQmn4GQLmRj9s
fbZRqL94bbtE4_e0Zrpo8RNo8vxRLqQNwIy85fc6BRgBJomt8QdQvIgP
gWCv5HoQ",
"q": "zqOHk1P6WN_rHuM7ZF1cXH0x6RuOHq67WuHiSknqQeefGBA9PWs6Zy
KQCO-O6mKXtcgE8_Q_hA2kMRcKOcvHil1hqMCNSXlflM7WPRPZu2qCDc
qssd_uMbP-DqYthH_EzwL9KnYoH7JQFxxmcv5An8oXUtTwk4knKjkIYG
RuUwfQTus0w1NfjFAyxOOiAQ37ussIcE6C6ZSsM3n41UlbJ7TCqewzVJ
aPJN5cxjySPZPD3Vp01a9YgAD6a3IIaKJdIxJS1ImnfPevSJQBE79-EX
e2kSwVgOzvt-gsmM29QQ8veHy4uAqca5dZzMs7hkkHtw1z0jHV90epQJ
JlXXnH8Q",
"dp": "19oDkBh1AXelMIxQFm2zZTqUhAzCIr4xNIGEPNoDt1jK83_FJA-xn
x5kA7-1erdHdms_Ef67HsONNv5A60JaR7w8LHnDiBGnjdaUmmuO8XAxQ
J_ia5mxjxNjS6E2yD44USo2JmHvzeeNczq25elqbTPLhUpGo1IZuG72F
ZQ5gTjXoTXC2-xtCDEUZfaUNh4IeAipfLugbpe0JAFlFfrTDAMUFpC3i
XjxqzbEanflwPvj6V9iDSgjj8SozSM0dLtxvu0LIeIQAeEgT_yXcrKGm
pKdSO08kLBx8VUjkbv_3Pn20Gyu2YEuwpFlM_H1NikuxJNKFGmnAq9Lc
nwwT0jvoQ",
"dq": "S6p59KrlmzGzaQYQM3o0XfHCGvfqHLYjCO557HYQf72O9kLMCfd_1
VBEqeD-1jjwELKDjck8kOBl5UvohK1oDfSP1DleAy-cnmL29DqWmhgwM
1ip0CCNmkmsmDSlqkUXDi6sAaZuntyukyflI-qSQ3C_BafPyFaKrt1fg
dyEwYa08pESKwwWisy7KnmoUvaJ3SaHmohFS78TJ25cfc10wZ9hQNOrI
ChZlkiOdFCtxDqdmCqNacnhgE3bZQjGp3n83ODSz9zwJcSUvODlXBPc2
AycH6Ci5yjbxt4Ppox_5pjm6xnQkiPgj01GpsUssMmBN7iHVsrE7N2iz
nBNCeOUIQ",
"qi": "FZhClBMywVVjnuUud-05qd5CYU0dK79akAgy9oX6RX6I3IIIPckCc
iRrokxglZn-omAY5CnCe4KdrnjFOT5YUZE7G_Pg44XgCXaarLQf4hl80
oPEf6-jJ5Iy6wPRx7G2e8qLxnh9cOdf-kRqgOS3F48Ucvw3ma5V6KGMw
QqWFeV31XtZ8l5cVI-I3NzBS7qltpUVgz2Ju021eyc7IlqgzR98qKONl
27DuEES0aK0WE97jnsyO27Yp88Wa2RiBrEocM89QZI1seJiGDizHRUP4
UZxw9zsXww46wy0P6f9grnYp7t8LkyDDk8eoI4KX6SNMNVcyVS9IWjlq
8EzqZEKIA"
}
</pre>
<p class="figure">Figure 62: RSA 4096-bit Key</p>
<p id="rfc.section.4.2.1.p.3">(<strong>NOTE</strong>: While the key includes the private parameters, only the public parameters &#8220;e&#8221; and &#8220;n&#8221; are necessary for the encryption operation.)</p>
<h1 id="rfc.section.4.2.2"><a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#jwe-rsa_oaep-gen" id="jwe-rsa_oaep-gen">Generated Factors</a></h1>
<p id="rfc.section.4.2.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption CEK (CEK); this example uses the key from <a href="#jwe-rsa_oaep-cek">Figure 63</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-rsa_oaep-iv">Figure 64</a>.</li>
</ul>
<div id="rfc.figure.63"/>
<div id="jwe-rsa_oaep-cek"/>
<pre>
mYMfsggkTAm0TbvtlFh2hyoXnbEzJQjMxmgLN3d8xXA
</pre>
<p class="figure">Figure 63: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.64"/>
<div id="jwe-rsa_oaep-iv"/>
<pre>
-nBoKLH0YkLZPSI9
</pre>
<p class="figure">Figure 64: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.2.3"><a href="#rfc.section.4.2.3">4.2.3.</a> <a href="#jwe-rsa_oaep-keyenc" id="jwe-rsa_oaep-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.2.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-rsa_oaep-cek">Figure 63</a>)) with the RSA key (<a href="#jwe-rsa_oaep-key">Figure 62</a>) produces the following encrypted key:</p>
<div id="rfc.figure.65"/>
<div id="jwe-rsa_oaep-encdkey"/>
<pre>
rT99rwrBTbTI7IJM8fU3Eli7226HEB7IchCxNuh7lCiud48LxeolRdtFF4nzQi
beYOl5S_PJsAXZwSXtDePz9hk-BbtsTBqC2UsPOdwjC9NhNupNNu9uHIVftDyu
cvI6hvALeZ6OGnhNV4v1zx2k7O1D89mAzfw-_kT3tkuorpDU-CpBENfIHX1Q58
-Aad3FzMuo3Fn9buEP2yXakLXYa15BUXQsupM4A1GD4_H4Bd7V3u9h8Gkg8Bpx
KdUV9ScfJQTcYm6eJEBz3aSwIaK4T3-dwWpuBOhROQXBosJzS1asnuHtVMt2pK
IIfux5BC6huIvmY7kzV7W7aIUrpYm_3H4zYvyMeq5pGqFmW2k8zpO878TRlZx7
pZfPYDSXZyS0CfKKkMozT_qiCwZTSz4duYnt8hS4Z9sGthXn9uDqd6wycMagnQ
fOTs_lycTWmY-aqWVDKhjYNRf03NiwRtb5BE-tOdFwCASQj3uuAgPGrO2AWBe3
8UjQb0lvXn1SpyvYZ3WFc7WOJYaTa7A8DRn6MC6T-xDmMuxC0G7S2rscw5lQQU
06MvZTlFOt0UvfuKBa03cxA_nIBIhLMjY2kOTxQMmpDPTr6Cbo8aKaOnx6ASE5
Jx9paBpnNmOOKH35j_QlrQhDWUN6A2Gg8iFayJ69xDEdHAVCGRzN3woEI2ozDR
s
</pre>
<p class="figure">Figure 65: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.2.4"><a href="#rfc.section.4.2.4">4.2.4.</a> <a href="#jwe-rsa_oaep-contentenc" id="jwe-rsa_oaep-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.2.4.p.1">The following are generated before encrypting the plaintext:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the the header from <a href="#jwe-rsa_oaep-protected">Figure 66</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jwe-rsa_oaep-protected_b64u">Figure 67</a>.</li>
</ul>
<div id="rfc.figure.66"/>
<div id="jwe-rsa_oaep-protected"/>
<pre>
{
"alg": "RSA-OAEP",
"kid": "samwise.gamgee@hobbiton.example",
"enc": "A256GCM"
}
</pre>
<p class="figure">Figure 66: Protected JWE Header JSON</p>
<div id="rfc.figure.67"/>
<div id="jwe-rsa_oaep-protected_b64u"/>
<pre>
eyJhbGciOiJSU0EtT0FFUCIsImtpZCI6InNhbXdpc2UuZ2FtZ2VlQGhvYmJpdG
9uLmV4YW1wbGUiLCJlbmMiOiJBMjU2R0NNIn0
</pre>
<p class="figure">Figure 67: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.2.4.p.3">Performing the content encryption operation over the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-rsa_oaep-cek">Figure 63</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-rsa_oaep-iv">Figure 64</a>); and</li>
<li>Protected JWE Header (<a href="#jwe-rsa_oaep-protected_b64u">Figure 67</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.2.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-rsa_oaep-ciphertext">Figure 68</a>.</li>
<li>Authentication tag from <a href="#jwe-rsa_oaep-tag">Figure 69</a>.</li>
</ul>
<div id="rfc.figure.68"/>
<div id="jwe-rsa_oaep-ciphertext"/>
<pre>
o4k2cnGN8rSSw3IDo1YuySkqeS_t2m1GXklSgqBdpACm6UJuJowOHC5ytjqYgR
L-I-soPlwqMUf4UgRWWeaOGNw6vGW-xyM01lTYxrXfVzIIaRdhYtEMRBvBWbEw
P7ua1DRfvaOjgZv6Ifa3brcAM64d8p5lhhNcizPersuhw5f-pGYzseva-TUaL8
iWnctc-sSwy7SQmRkfhDjwbz0fz6kFovEgj64X1I5s7E6GLp5fnbYGLa1QUiML
7Cc2GxgvI7zqWo0YIEc7aCflLG1-8BboVWFdZKLK9vNoycrYHumwzKluLWEbSV
maPpOslY2n525DxDfWaVFUfKQxMF56vn4B9QMpWAbnypNimbM8zVOw
</pre>
<p class="figure">Figure 68: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.69"/>
<div id="jwe-rsa_oaep-tag"/>
<pre>
UCGiqJxhBI3IFVdPalHHvA
</pre>
<p class="figure">Figure 69: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.2.5"><a href="#rfc.section.4.2.5">4.2.5.</a> <a href="#jwe-rsa_oaep-output" id="jwe-rsa_oaep-output">Output Results</a></h1>
<p id="rfc.section.4.2.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-rsa_oaep-protected_b64u">Figure 67</a>)</li>
<li>Encrypted key (<a href="#jwe-rsa_oaep-encdkey">Figure 65</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-rsa_oaep-iv">Figure 64</a>)</li>
<li>Ciphertext (<a href="#jwe-rsa_oaep-ciphertext">Figure 68</a>)</li>
<li>Authentication tag (<a href="#jwe-rsa_oaep-tag">Figure 69</a>)</li>
</ul>
<p id="rfc.section.4.2.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.70"/>
<div id="jwe-rsa_oaep-compact"/>
<pre>
eyJhbGciOiJSU0EtT0FFUCIsImtpZCI6InNhbXdpc2UuZ2FtZ2VlQGhvYmJpdG
9uLmV4YW1wbGUiLCJlbmMiOiJBMjU2R0NNIn0
.
rT99rwrBTbTI7IJM8fU3Eli7226HEB7IchCxNuh7lCiud48LxeolRdtFF4nzQi
beYOl5S_PJsAXZwSXtDePz9hk-BbtsTBqC2UsPOdwjC9NhNupNNu9uHIVftDyu
cvI6hvALeZ6OGnhNV4v1zx2k7O1D89mAzfw-_kT3tkuorpDU-CpBENfIHX1Q58
-Aad3FzMuo3Fn9buEP2yXakLXYa15BUXQsupM4A1GD4_H4Bd7V3u9h8Gkg8Bpx
KdUV9ScfJQTcYm6eJEBz3aSwIaK4T3-dwWpuBOhROQXBosJzS1asnuHtVMt2pK
IIfux5BC6huIvmY7kzV7W7aIUrpYm_3H4zYvyMeq5pGqFmW2k8zpO878TRlZx7
pZfPYDSXZyS0CfKKkMozT_qiCwZTSz4duYnt8hS4Z9sGthXn9uDqd6wycMagnQ
fOTs_lycTWmY-aqWVDKhjYNRf03NiwRtb5BE-tOdFwCASQj3uuAgPGrO2AWBe3
8UjQb0lvXn1SpyvYZ3WFc7WOJYaTa7A8DRn6MC6T-xDmMuxC0G7S2rscw5lQQU
06MvZTlFOt0UvfuKBa03cxA_nIBIhLMjY2kOTxQMmpDPTr6Cbo8aKaOnx6ASE5
Jx9paBpnNmOOKH35j_QlrQhDWUN6A2Gg8iFayJ69xDEdHAVCGRzN3woEI2ozDR
s
.
-nBoKLH0YkLZPSI9
.
o4k2cnGN8rSSw3IDo1YuySkqeS_t2m1GXklSgqBdpACm6UJuJowOHC5ytjqYgR
L-I-soPlwqMUf4UgRWWeaOGNw6vGW-xyM01lTYxrXfVzIIaRdhYtEMRBvBWbEw
P7ua1DRfvaOjgZv6Ifa3brcAM64d8p5lhhNcizPersuhw5f-pGYzseva-TUaL8
iWnctc-sSwy7SQmRkfhDjwbz0fz6kFovEgj64X1I5s7E6GLp5fnbYGLa1QUiML
7Cc2GxgvI7zqWo0YIEc7aCflLG1-8BboVWFdZKLK9vNoycrYHumwzKluLWEbSV
maPpOslY2n525DxDfWaVFUfKQxMF56vn4B9QMpWAbnypNimbM8zVOw
.
UCGiqJxhBI3IFVdPalHHvA
</pre>
<p class="figure">Figure 70: Compact Serialization</p>
<p id="rfc.section.4.2.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.71"/>
<div id="jwe-rsa_oaep-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "rT99rwrBTbTI7IJM8fU3Eli7226HEB7IchCxNu
h7lCiud48LxeolRdtFF4nzQibeYOl5S_PJsAXZwSXtDePz9hk-Bb
tsTBqC2UsPOdwjC9NhNupNNu9uHIVftDyucvI6hvALeZ6OGnhNV4
v1zx2k7O1D89mAzfw-_kT3tkuorpDU-CpBENfIHX1Q58-Aad3FzM
uo3Fn9buEP2yXakLXYa15BUXQsupM4A1GD4_H4Bd7V3u9h8Gkg8B
pxKdUV9ScfJQTcYm6eJEBz3aSwIaK4T3-dwWpuBOhROQXBosJzS1
asnuHtVMt2pKIIfux5BC6huIvmY7kzV7W7aIUrpYm_3H4zYvyMeq
5pGqFmW2k8zpO878TRlZx7pZfPYDSXZyS0CfKKkMozT_qiCwZTSz
4duYnt8hS4Z9sGthXn9uDqd6wycMagnQfOTs_lycTWmY-aqWVDKh
jYNRf03NiwRtb5BE-tOdFwCASQj3uuAgPGrO2AWBe38UjQb0lvXn
1SpyvYZ3WFc7WOJYaTa7A8DRn6MC6T-xDmMuxC0G7S2rscw5lQQU
06MvZTlFOt0UvfuKBa03cxA_nIBIhLMjY2kOTxQMmpDPTr6Cbo8a
KaOnx6ASE5Jx9paBpnNmOOKH35j_QlrQhDWUN6A2Gg8iFayJ69xD
EdHAVCGRzN3woEI2ozDRs"
}
],
"protected": "eyJhbGciOiJSU0EtT0FFUCIsImtpZCI6InNhbXdpc2UuZ2
FtZ2VlQGhvYmJpdG9uLmV4YW1wbGUiLCJlbmMiOiJBMjU2R0NNIn0",
"iv": "-nBoKLH0YkLZPSI9",
"ciphertext": "o4k2cnGN8rSSw3IDo1YuySkqeS_t2m1GXklSgqBdpACm6
UJuJowOHC5ytjqYgRL-I-soPlwqMUf4UgRWWeaOGNw6vGW-xyM01lTYx
rXfVzIIaRdhYtEMRBvBWbEwP7ua1DRfvaOjgZv6Ifa3brcAM64d8p5lh
hNcizPersuhw5f-pGYzseva-TUaL8iWnctc-sSwy7SQmRkfhDjwbz0fz
6kFovEgj64X1I5s7E6GLp5fnbYGLa1QUiML7Cc2GxgvI7zqWo0YIEc7a
CflLG1-8BboVWFdZKLK9vNoycrYHumwzKluLWEbSVmaPpOslY2n525Dx
DfWaVFUfKQxMF56vn4B9QMpWAbnypNimbM8zVOw",
"tag": "UCGiqJxhBI3IFVdPalHHvA"
}
</pre>
<p class="figure">Figure 71: JSON Serialization</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#jwe-pbes2" id="jwe-pbes2">Key Wrap using PBES2-AES-KeyWrap with AES-CBC-HMAC-SHA2</a></h1>
<p id="rfc.section.4.3.p.1">The example illustrates encrypting content using the &#8220;PBES2-HS512+A256KW&#8221; (PBES2 Password-based Encryption using HMAC-SHA-512 and AES-256-KeyWrap) key encryption algorithm with the &#8220;A128CBC-HS256&#8221; (AES-128-CBC-HMAC-SHA-256) content encryption algorithm.</p>
<h1 id="rfc.section.4.3.1"><a href="#rfc.section.4.3.1">4.3.1.</a> <a href="#jwe-pbes2-input" id="jwe-pbes2-input">Input Factors</a></h1>
<p id="rfc.section.4.3.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the plaintext from <a href="#jwe-pbes2-plaintext">Figure 72</a> (<strong>NOTE</strong> all whitespace added for readability)</li>
<li>Password; this example uses the password from <a href="#jwe-pbes2-pwd">Figure 73</a></li>
<li>&#8220;alg&#8221; parameter of &#8220;PBES2-HS512+A256KW&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128CBC-HS256&#8221;</li>
</ul>
<div id="rfc.figure.72"/>
<div id="jwe-pbes2-plaintext"/>
<pre>
{
"keys": [
{
"kty": "oct",
"kid": "77c7e2b8-6e13-45cf-8672-617b5b45243a",
"use": "enc",
"alg": "A128GCM",
"k": "XctOhJAkA-pD9Lh7ZgW_2A"
},
{
"kty": "oct",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"use": "enc",
"alg": "A128KW",
"k": "GZy6sIZ6wl9NJOKB-jnmVQ"
},
{
"kty": "oct",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"use": "enc",
"alg": "A256GCMKW",
"k": "qC57l_uxcm7Nm3K-ct4GFjx8tM1U8CZ0NLBvdQstiS8"
}
]
}
</pre>
<p class="figure">Figure 72: Plaintext Content</p>
<div id="rfc.figure.73"/>
<div id="jwe-pbes2-pwd"/>
<pre>
entrap_o_peter_long_credit_tun
</pre>
<p class="figure">Figure 73: Password</p>
<h1 id="rfc.section.4.3.2"><a href="#rfc.section.4.3.2">4.3.2.</a> <a href="#jwe-pbes2-gen" id="jwe-pbes2-gen">Generated Factors</a></h1>
<p id="rfc.section.4.3.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-pbes2-cek">Figure 74</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-pbes2-iv">Figure 75</a>.</li>
</ul>
<div id="rfc.figure.74"/>
<div id="jwe-pbes2-cek"/>
<pre>
uwsjJXaBK407Qaf0_zpcpmr1Cs0CC50hIUEyGNEt3m0
</pre>
<p class="figure">Figure 74: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.75"/>
<div id="jwe-pbes2-iv"/>
<pre>
VBiCzVHNoLiR3F4V82uoTQ
</pre>
<p class="figure">Figure 75: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.3.3"><a href="#rfc.section.4.3.3">4.3.3.</a> <a href="#jwe-pbes2-keyenc" id="jwe-pbes2-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.3.3.p.1">The following are generated before encrypting the CEK:</p>
<p/>

<ul>
<li>Salt; this example uses the salt from <a href="#jwe-pbes2-p2s">Figure 76</a>.</li>
<li>Iteration count; this example uses the interaction count 8192.</li>
</ul>
<div id="rfc.figure.76"/>
<div id="jwe-pbes2-p2s"/>
<pre>
8Q1SzinasR3xchYz6ZZcHA
</pre>
<p class="figure">Figure 76: Salt, base64url-encoded</p>
<p id="rfc.section.4.3.3.p.3">Performing the key encryption operation over the CEK (<a href="#jwe-pbes2-cek">Figure 74</a>)) with the following:</p>
<p/>

<ul>
<li>Password (<a href="#jwe-pbes2-pwd">Figure 73</a>;</li>
<li>Salt (<a href="#jwe-pbes2-p2s">Figure 76</a>), encoded as an octet string; and</li>
<li>Iteration count (8192)</li>
</ul>
<p id="rfc.section.4.3.3.p.5">produces the following encrypted key:</p>
<div id="rfc.figure.77"/>
<div id="jwe-pbes2-encdkey"/>
<pre>
YKbKLsEoyw_JoNvhtuHo9aaeRNSEhhAW2OVHcuF_HLqS0n6hA_fgCA
</pre>
<p class="figure">Figure 77: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.3.4"><a href="#rfc.section.4.3.4">4.3.4.</a> <a href="#jwe-pbes2-contentenc" id="jwe-pbes2-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.3.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-pbes2-protected">Figure 78</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jwe-pbes2-protected_b64u">Figure 79</a>.</li>
</ul>
<div id="rfc.figure.78"/>
<div id="jwe-pbes2-protected"/>
<pre>
{
"alg": "PBES2-HS256+A128KW",
"p2s": "8Q1SzinasR3xchYz6ZZcHA",
"p2c": 8192,
"cty": "jwk-set+json",
"enc": "A128CBC-HS256"
}
</pre>
<p class="figure">Figure 78: Protected JWE Header JSON</p>
<div id="rfc.figure.79"/>
<div id="jwe-pbes2-protected_b64u"/>
<pre>
eyJhbGciOiJQQkVTMi1IUzI1NitBMTI4S1ciLCJwMnMiOiI4UTFTemluYXNSM3
hjaFl6NlpaY0hBIiwicDJjIjo4MTkyLCJjdHkiOiJqd2stc2V0K2pzb24iLCJl
bmMiOiJBMTI4Q0JDLUhTMjU2In0
</pre>
<p class="figure">Figure 79: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.3.4.p.3">Performing the content encryption operation over the Plaintext (<a href="#jwe-pbes2-plaintext">Figure 72</a>) with the the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-pbes2-cek">Figure 74</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-pbes2-iv">Figure 75</a>); and</li>
<li>Protected JWE header (<a href="#jwe-pbes2-protected_b64u">Figure 79</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.3.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-pbes2-ciphertext">Figure 80</a>.</li>
<li>Authentication tag from <a href="#jwe-pbes2-tag">Figure 81</a>.</li>
</ul>
<div id="rfc.figure.80"/>
<div id="jwe-pbes2-ciphertext"/>
<pre>
23i-Tb1AV4n0WKVSSgcQrdg6GRqsUKxjruHXYsTHAJLZ2nsnGIX86vMXqIi6IR
sfywCRFzLxEcZBRnTvG3nhzPk0GDD7FMyXhUHpDjEYCNA_XOmzg8yZR9oyjo6l
TF6si4q9FZ2EhzgFQCLO_6h5EVg3vR75_hkBsnuoqoM3dwejXBtIodN84PeqMb
6asmas_dpSsz7H10fC5ni9xIz424givB1YLldF6exVmL93R3fOoOJbmk2GBQZL
_SEGllv2cQsBgeprARsaQ7Bq99tT80coH8ItBjgV08AtzXFFsx9qKvC982KLKd
PQMTlVJKkqtV4Ru5LEVpBZXBnZrtViSOgyg6AiuwaS-rCrcD_ePOGSuxvgtrok
AKYPqmXUeRdjFJwafkYEkiuDCV9vWGAi1DH2xTafhJwcmywIyzi4BqRpmdn_N-
zl5tuJYyuvKhjKv6ihbsV_k1hJGPGAxJ6wUpmwC4PTQ2izEm0TuSE8oMKdTw8V
3kobXZ77ulMwDs4p
</pre>
<p class="figure">Figure 80: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.81"/>
<div id="jwe-pbes2-tag"/>
<pre>
ALTKwxvAefeL-32NY7eTAQ
</pre>
<p class="figure">Figure 81: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.3.5"><a href="#rfc.section.4.3.5">4.3.5.</a> <a href="#jwe-pbes2-output" id="jwe-pbes2-output">Output Results</a></h1>
<p id="rfc.section.4.3.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-pbes2-protected_b64u">Figure 79</a>)</li>
<li>Encrypted key (<a href="#jwe-pbes2-encdkey">Figure 77</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-pbes2-iv">Figure 75</a>)</li>
<li>Ciphertext (<a href="#jwe-pbes2-ciphertext">Figure 80</a>)</li>
<li>Authentication tag (<a href="#jwe-pbes2-tag">Figure 81</a>)</li>
</ul>
<p id="rfc.section.4.3.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.82"/>
<div id="jwe-pbes2-compact"/>
<pre>
eyJhbGciOiJQQkVTMi1IUzI1NitBMTI4S1ciLCJwMnMiOiI4UTFTemluYXNSM3
hjaFl6NlpaY0hBIiwicDJjIjo4MTkyLCJjdHkiOiJqd2stc2V0K2pzb24iLCJl
bmMiOiJBMTI4Q0JDLUhTMjU2In0
.
YKbKLsEoyw_JoNvhtuHo9aaeRNSEhhAW2OVHcuF_HLqS0n6hA_fgCA
.
VBiCzVHNoLiR3F4V82uoTQ
.
23i-Tb1AV4n0WKVSSgcQrdg6GRqsUKxjruHXYsTHAJLZ2nsnGIX86vMXqIi6IR
sfywCRFzLxEcZBRnTvG3nhzPk0GDD7FMyXhUHpDjEYCNA_XOmzg8yZR9oyjo6l
TF6si4q9FZ2EhzgFQCLO_6h5EVg3vR75_hkBsnuoqoM3dwejXBtIodN84PeqMb
6asmas_dpSsz7H10fC5ni9xIz424givB1YLldF6exVmL93R3fOoOJbmk2GBQZL
_SEGllv2cQsBgeprARsaQ7Bq99tT80coH8ItBjgV08AtzXFFsx9qKvC982KLKd
PQMTlVJKkqtV4Ru5LEVpBZXBnZrtViSOgyg6AiuwaS-rCrcD_ePOGSuxvgtrok
AKYPqmXUeRdjFJwafkYEkiuDCV9vWGAi1DH2xTafhJwcmywIyzi4BqRpmdn_N-
zl5tuJYyuvKhjKv6ihbsV_k1hJGPGAxJ6wUpmwC4PTQ2izEm0TuSE8oMKdTw8V
3kobXZ77ulMwDs4p
.
ALTKwxvAefeL-32NY7eTAQ
</pre>
<p class="figure">Figure 82: Compact Serialization</p>
<p id="rfc.section.4.3.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.83"/>
<div id="jwe-pbes2-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "YKbKLsEoyw_JoNvhtuHo9aaeRNSEhhAW2OVHcu
F_HLqS0n6hA_fgCA"
}
],
"protected": "eyJhbGciOiJQQkVTMi1IUzI1NitBMTI4S1ciLCJwMnMiOi
I4UTFTemluYXNSM3hjaFl6NlpaY0hBIiwicDJjIjo4MTkyLCJjdHkiOi
Jqd2stc2V0K2pzb24iLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0",
"iv": "VBiCzVHNoLiR3F4V82uoTQ",
"ciphertext": "23i-Tb1AV4n0WKVSSgcQrdg6GRqsUKxjruHXYsTHAJLZ2
nsnGIX86vMXqIi6IRsfywCRFzLxEcZBRnTvG3nhzPk0GDD7FMyXhUHpD
jEYCNA_XOmzg8yZR9oyjo6lTF6si4q9FZ2EhzgFQCLO_6h5EVg3vR75_
hkBsnuoqoM3dwejXBtIodN84PeqMb6asmas_dpSsz7H10fC5ni9xIz42
4givB1YLldF6exVmL93R3fOoOJbmk2GBQZL_SEGllv2cQsBgeprARsaQ
7Bq99tT80coH8ItBjgV08AtzXFFsx9qKvC982KLKdPQMTlVJKkqtV4Ru
5LEVpBZXBnZrtViSOgyg6AiuwaS-rCrcD_ePOGSuxvgtrokAKYPqmXUe
RdjFJwafkYEkiuDCV9vWGAi1DH2xTafhJwcmywIyzi4BqRpmdn_N-zl5
tuJYyuvKhjKv6ihbsV_k1hJGPGAxJ6wUpmwC4PTQ2izEm0TuSE8oMKdT
w8V3kobXZ77ulMwDs4p",
"tag": "ALTKwxvAefeL-32NY7eTAQ"
}
</pre>
<p class="figure">Figure 83: JSON Serialization</p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#jwe-ecdh_aeskw" id="jwe-ecdh_aeskw">Key Agreement with Key Wrapping using ECDH-ES and AES-KeyWrap with AES-GCM</a></h1>
<p id="rfc.section.4.4.p.1">This example illustrates encrypting content using the &#8220;ECDH-ES+A128KW&#8221; (Elliptic Curve Diffie-Hellman Ephemeral-Static with AES-128-KeyWrap) key encryption algorithm and the &#8220;A128GCM&#8221; (AES-GCM) content encryption algorithm.</p>
<h1 id="rfc.section.4.4.1"><a href="#rfc.section.4.4.1">4.4.1.</a> <a href="#jwe-ecdh_aeskw-input" id="jwe-ecdh_aeskw-input">Input Factors</a></h1>
<p id="rfc.section.4.4.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a></li>
<li>EC public key; this example uses the public key from <a href="#jwe-ecdh_aeskw-key">Figure 84</a></li>
<li>&#8220;alg&#8221; parameter of &#8220;ECDH-ES+A128KW&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128GCM&#8221;</li>
</ul>
<div id="rfc.figure.84"/>
<div id="jwe-ecdh_aeskw-key"/>
<pre>
{
"kty": "EC",
"kid": "peregrin.took@tuckborough.example",
"use": "enc",
"crv": "P-384",
"x": "YU4rRUzdmVqmRtWOs2OpDE_T5fsNIodcG8G5FWPrTPMyxpzsSOGaQL
pe2FpxBmu2",
"y": "A8-yxCHxkfBz3hKZfI1jUYMjUhsEveZ9THuwFjH2sCNdtksRJU7D5-
SkgaFL1ETP",
"d": "iTx2pk7wW-GqJkHcEkFQb2EFyYcO7RugmaW3mRrQVAOUiPommT0Idn
YK2xDlZh-j"
}
</pre>
<p class="figure">Figure 84: Elliptic Curve P-384 Key, in JWK format</p>
<p id="rfc.section.4.4.1.p.3">(<strong>NOTE</strong>: While the key includes the private parameters, only the public parameters &#8220;crv&#8221;, &#8220;x&#8221;, and &#8220;y&#8221; are necessary for the encryption operation.)</p>
<h1 id="rfc.section.4.4.2"><a href="#rfc.section.4.4.2">4.4.2.</a> <a href="#jwe-ecdh_aeskw-gen" id="jwe-ecdh_aeskw-gen">Generated Factors</a></h1>
<p id="rfc.section.4.4.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>Symmetric AES key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-ecdh_aeskw-cek">Figure 85</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-ecdh_aeskw-iv">Figure 86</a></li>
</ul>
<div id="rfc.figure.85"/>
<div id="jwe-ecdh_aeskw-cek"/>
<pre>
Nou2ueKlP70ZXDbq9UrRwg
</pre>
<p class="figure">Figure 85: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.86"/>
<div id="jwe-ecdh_aeskw-iv"/>
<pre>
mH-G2zVqgztUtnW_
</pre>
<p class="figure">Figure 86: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.4.3"><a href="#rfc.section.4.4.3">4.4.3.</a> <a href="#jwe-ecdh_aeskw-keyenc" id="jwe-ecdh_aeskw-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.4.3.p.1">To encrypt the Content Encryption Key, the following are generated:</p>
<p/>

<ul>
<li>Ephemeral EC private key on the same curve as the EC public key; this example uses the private key from <a href="#jwe-ecdh_aeskw-epk">Figure 87</a>.</li>
</ul>
<div id="rfc.figure.87"/>
<div id="jwe-ecdh_aeskw-epk"/>
<pre>
{
"kty": "EC",
"crv": "P-384",
"x": "uBo4kHPw6kbjx5l0xowrd_oYzBmaz-GKFZu4xAFFkbYiWgutEK6iuE
DsQ6wNdNg3",
"y": "sp3p5SGhZVC2faXumI-e9JU2Mo8KpoYrFDr5yPNVtW4PgEwZOyQTA-
JdaY8tb7E0",
"d": "D5H4Y_5PSKZvhfVFbcCYJOtcGZygRgfZkpsBr59Icmmhe9sW6nkZ8W
fwhinUfWJg"
}
</pre>
<p class="figure">Figure 87: Ephemeral Elliptic Curve P-384 Key, in JWK format</p>
<p id="rfc.section.4.4.3.p.3">Performing the key encryption operation over the CEK (<a href="#jwe-ecdh_aeskw-cek">Figure 85</a>) with the following:</p>
<p/>

<ul>
<li>The static Elliptic Curve public key (<a href="#jwe-ecdh_aeskw-key">Figure 84</a>); and</li>
<li>The ephemeral Elliptic Curve private key (<a href="#jwe-ecdh_aeskw-epk">Figure 87</a>);</li>
</ul>
<p id="rfc.section.4.4.3.p.5">produces the following JWE encrypted key:</p>
<div id="rfc.figure.88"/>
<div id="jwe-ecdh_aeskw-encdkey"/>
<pre>
0DJjBXri_kBcC46IkU5_Jk9BqaQeHdv2
</pre>
<p class="figure">Figure 88: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.4.4"><a href="#rfc.section.4.4.4">4.4.4.</a> <a href="#jwe-ecdh_aeskw-contentenc" id="jwe-ecdh_aeskw-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.4.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE header; this example uses the header from <a href="#jwe-ecdh_aeskw-protected">Figure 89</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-ecdh_aeskw-protected_b64u">Figure 90</a>.</li>
</ul>
<div id="rfc.figure.89"/>
<div id="jwe-ecdh_aeskw-protected"/>
<pre>
{
"alg": "ECDH-ES+A128KW",
"kid": "peregrin.took@tuckborough.example",
"epk": {
"kty": "EC",
"crv": "P-384",
"x": "uBo4kHPw6kbjx5l0xowrd_oYzBmaz-GKFZu4xAFFkbYiWgutEK6i
uEDsQ6wNdNg3",
"y": "sp3p5SGhZVC2faXumI-e9JU2Mo8KpoYrFDr5yPNVtW4PgEwZOyQT
A-JdaY8tb7E0"
},
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 89: Protected JWE Header JSON</p>
<div id="rfc.figure.90"/>
<div id="jwe-ecdh_aeskw-protected_b64u"/>
<pre>
eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImtpZCI6InBlcmVncmluLnRvb2tAdH
Vja2Jvcm91Z2guZXhhbXBsZSIsImVwayI6eyJrdHkiOiJFQyIsImNydiI6IlAt
Mzg0IiwieCI6InVCbzRrSFB3Nmtiang1bDB4b3dyZF9vWXpCbWF6LUdLRlp1NH
hBRkZrYllpV2d1dEVLNml1RURzUTZ3TmROZzMiLCJ5Ijoic3AzcDVTR2haVkMy
ZmFYdW1JLWU5SlUyTW84S3BvWXJGRHI1eVBOVnRXNFBnRXdaT3lRVEEtSmRhWT
h0YjdFMCJ9LCJlbmMiOiJBMTI4R0NNIn0
</pre>
<p class="figure">Figure 90: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.4.4.p.3">Performing the content encryption operation on the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) using the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-ecdh_aeskw-cek">Figure 85</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-ecdh_aeskw-iv">Figure 86</a>); and</li>
<li>Protected JWE header (<a href="#jwe-ecdh_aeskw-protected_b64u">Figure 90</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.4.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-ecdh_aeskw-ciphertext">Figure 91</a>.</li>
<li>Authentication tag from <a href="#jwe-ecdh_aeskw-tag">Figure 92</a>.</li>
</ul>
<div id="rfc.figure.91"/>
<div id="jwe-ecdh_aeskw-ciphertext"/>
<pre>
tkZuOO9h95OgHJmkkrfLBisku8rGf6nzVxhRM3sVOhXgz5NJ76oID7lpnAi_cP
WJRCjSpAaUZ5dOR3Spy7QuEkmKx8-3RCMhSYMzsXaEwDdXta9Mn5B7cCBoJKB0
IgEnj_qfo1hIi-uEkUpOZ8aLTZGHfpl05jMwbKkTe2yK3mjF6SBAsgicQDVCkc
Y9BLluzx1RmC3ORXaM0JaHPB93YcdSDGgpgBWMVrNU1ErkjcMqMoT_wtCex3w0
3XdLkjXIuEr2hWgeP-nkUZTPU9EoGSPj6fAS-bSz87RCPrxZdj_iVyC6QWcqAu
07WNhjzJEPc4jVntRJ6K53NgPQ5p99l3Z408OUqj4ioYezbS6vTPlQ
</pre>
<p class="figure">Figure 91: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.92"/>
<div id="jwe-ecdh_aeskw-tag"/>
<pre>
WuGzxmcreYjpHGJoa17EBg
</pre>
<p class="figure">Figure 92: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.4.5"><a href="#rfc.section.4.4.5">4.4.5.</a> <a href="#jwe-ecdh_aeskw-output" id="jwe-ecdh_aeskw-output">Output Results</a></h1>
<p id="rfc.section.4.4.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-ecdh_aeskw-protected_b64u">Figure 90</a>)</li>
<li>Encrypted key (<a href="#jwe-ecdh_aeskw-encdkey">Figure 88</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-ecdh_aeskw-iv">Figure 86</a>)</li>
<li>Ciphertext (<a href="#jwe-ecdh_aeskw-ciphertext">Figure 91</a>)</li>
<li>Authentication tag (<a href="#jwe-ecdh_aeskw-tag">Figure 92</a>)</li>
</ul>
<p id="rfc.section.4.4.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.93"/>
<div id="jwe-ecdh_aeskw-compact"/>
<pre>
eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImtpZCI6InBlcmVncmluLnRvb2tAdH
Vja2Jvcm91Z2guZXhhbXBsZSIsImVwayI6eyJrdHkiOiJFQyIsImNydiI6IlAt
Mzg0IiwieCI6InVCbzRrSFB3Nmtiang1bDB4b3dyZF9vWXpCbWF6LUdLRlp1NH
hBRkZrYllpV2d1dEVLNml1RURzUTZ3TmROZzMiLCJ5Ijoic3AzcDVTR2haVkMy
ZmFYdW1JLWU5SlUyTW84S3BvWXJGRHI1eVBOVnRXNFBnRXdaT3lRVEEtSmRhWT
h0YjdFMCJ9LCJlbmMiOiJBMTI4R0NNIn0
.
0DJjBXri_kBcC46IkU5_Jk9BqaQeHdv2
.
mH-G2zVqgztUtnW_
.
tkZuOO9h95OgHJmkkrfLBisku8rGf6nzVxhRM3sVOhXgz5NJ76oID7lpnAi_cP
WJRCjSpAaUZ5dOR3Spy7QuEkmKx8-3RCMhSYMzsXaEwDdXta9Mn5B7cCBoJKB0
IgEnj_qfo1hIi-uEkUpOZ8aLTZGHfpl05jMwbKkTe2yK3mjF6SBAsgicQDVCkc
Y9BLluzx1RmC3ORXaM0JaHPB93YcdSDGgpgBWMVrNU1ErkjcMqMoT_wtCex3w0
3XdLkjXIuEr2hWgeP-nkUZTPU9EoGSPj6fAS-bSz87RCPrxZdj_iVyC6QWcqAu
07WNhjzJEPc4jVntRJ6K53NgPQ5p99l3Z408OUqj4ioYezbS6vTPlQ
.
WuGzxmcreYjpHGJoa17EBg
</pre>
<p class="figure">Figure 93: Compact Serialization</p>
<p id="rfc.section.4.4.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.94"/>
<div id="jwe-ecdh_aeskw-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "0DJjBXri_kBcC46IkU5_Jk9BqaQeHdv2"
}
],
"protected": "eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImtpZCI6InBlcm
VncmluLnRvb2tAdHVja2Jvcm91Z2guZXhhbXBsZSIsImVwayI6eyJrdH
kiOiJFQyIsImNydiI6IlAtMzg0IiwieCI6InVCbzRrSFB3Nmtiang1bD
B4b3dyZF9vWXpCbWF6LUdLRlp1NHhBRkZrYllpV2d1dEVLNml1RURzUT
Z3TmROZzMiLCJ5Ijoic3AzcDVTR2haVkMyZmFYdW1JLWU5SlUyTW84S3
BvWXJGRHI1eVBOVnRXNFBnRXdaT3lRVEEtSmRhWTh0YjdFMCJ9LCJlbm
MiOiJBMTI4R0NNIn0",
"iv": "mH-G2zVqgztUtnW_",
"ciphertext": "tkZuOO9h95OgHJmkkrfLBisku8rGf6nzVxhRM3sVOhXgz
5NJ76oID7lpnAi_cPWJRCjSpAaUZ5dOR3Spy7QuEkmKx8-3RCMhSYMzs
XaEwDdXta9Mn5B7cCBoJKB0IgEnj_qfo1hIi-uEkUpOZ8aLTZGHfpl05
jMwbKkTe2yK3mjF6SBAsgicQDVCkcY9BLluzx1RmC3ORXaM0JaHPB93Y
cdSDGgpgBWMVrNU1ErkjcMqMoT_wtCex3w03XdLkjXIuEr2hWgeP-nkU
ZTPU9EoGSPj6fAS-bSz87RCPrxZdj_iVyC6QWcqAu07WNhjzJEPc4jVn
tRJ6K53NgPQ5p99l3Z408OUqj4ioYezbS6vTPlQ",
"tag": "WuGzxmcreYjpHGJoa17EBg"
}
</pre>
<p class="figure">Figure 94: JSON Serialization</p>
<h1 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> <a href="#jwe-ecdh" id="jwe-ecdh">Key Agreement using ECDH-ES with AES-CBC-HMAC-SHA2</a></h1>
<p id="rfc.section.4.5.p.1">This example illustrates encrypting content using the &#8220;ECDH-ES&#8221; (Elliptic Curve Diffie-Hellman Ephemeral-Static) key agreement algorithm and the &#8220;A128CBC-HS256&#8221; (AES-128-CBC-HMAC-SHA-256) content encryption algorithm.</p>
<h1 id="rfc.section.4.5.1"><a href="#rfc.section.4.5.1">4.5.1.</a> <a href="#jwe-ecdh-input" id="jwe-ecdh-input">Input Factors</a></h1>
<p id="rfc.section.4.5.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>EC public key; this example uses the public key from <a href="#jwe-ecdh-key">Figure 95</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;ECDH-ES&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128CBC-HS256&#8221;</li>
</ul>
<div id="rfc.figure.95"/>
<div id="jwe-ecdh-key"/>
<pre>
{
"kty": "EC",
"kid": "meriadoc.brandybuck@buckland.example",
"use": "enc",
"crv": "P-256",
"x": "Ze2loSV3wrroKUN_4zhwGhCqo3Xhu1td4QjeQ5wIVR0",
"y": "HlLtdXARY_f55A3fnzQbPcm6hgr34Mp8p-nuzQCE0Zw",
"d": "r_kHyZ-a06rmxM3yESK84r1otSg-aQcVStkRhA-iCM8"
}
</pre>
<p class="figure">Figure 95: Elliptic Curve P-256 Key</p>
<p id="rfc.section.4.5.1.p.3">(<strong>NOTE</strong>: While the key includes the private parameters, only the public parameters &#8220;crv&#8221;, &#8220;x&#8221;, and &#8220;y&#8221; are necessary for the encryption operation.)</p>
<h1 id="rfc.section.4.5.2"><a href="#rfc.section.4.5.2">4.5.2.</a> <a href="#jwe-ecdh-gen" id="jwe-ecdh-gen">Generated Factors</a></h1>
<p id="rfc.section.4.5.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>Initialization vector/nonce; this examples uses the initialization vector/nonce from <a href="#jwe-ecdh-iv">Figure 96</a>.</li>
</ul>
<div id="rfc.figure.96"/>
<div id="jwe-ecdh-iv"/>
<pre>
yc9N8v5sYyv3iGQT926IUg
</pre>
<p class="figure">Figure 96: Initialization Vector, base64url-encoded</p>
<p><strong>NOTE</strong>: The Content Encryption Key (CEK) is not randomly generated; instead it is determined using key agreement.</p>
<h1 id="rfc.section.4.5.3"><a href="#rfc.section.4.5.3">4.5.3.</a> <a href="#jwe-ecdh-enckey" id="jwe-ecdh-enckey">Key Agreement</a></h1>
<p id="rfc.section.4.5.3.p.1">The following are generated to agree on a CEK:</p>
<p/>

<ul>
<li>Ephemeral private key; this example uses the private key from <a href="#jwe-ecdh-epk">Figure 97</a>.</li>
</ul>
<div id="rfc.figure.97"/>
<div id="jwe-ecdh-epk"/>
<pre>
{
"kty": "EC",
"crv": "P-256",
"x": "mPUKT_bAWGHIhg0TpjjqVsP1rXWQu_vwVOHHtNkdYoA",
"y": "8BQAsImGeAS46fyWw5MhYfGTT0IjBpFw2SS34Dv4Irs",
"d": "AtH35vJsQ9SGjYfOsjUxYXQKrPH3FjZHmEtSKoSN8cM"
}
</pre>
<p class="figure">Figure 97: Ephemeral public key, in JWK format</p>
<p id="rfc.section.4.5.3.p.3">Performing the ECDH operation using the static EC public key (<a href="#jwe-ecdh-key">Figure 95</a>) over the ephemeral private key <a href="#jwe-ecdh-epk">Figure 97</a>) produces the following CEK:</p>
<div id="rfc.figure.98"/>
<div id="jwe-ecdh-cek"/>
<pre>
hzHdlfQIAEehb8Hrd_mFRhKsKLEzPfshfXs9l6areCc
</pre>
<p class="figure">Figure 98: Agreed-to Content Encryption Key, base64url-encoded</p>
<h1 id="rfc.section.4.5.4"><a href="#rfc.section.4.5.4">4.5.4.</a> <a href="#jwe-ecdh-contentenc" id="jwe-ecdh-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.5.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-ecdh-protected">Figure 99</a>, encoded to <a href="#RFC4648">[RFC4648]</a> as <a href="#jwe-ecdh-protected_b64u">Figure 100</a>.</li>
</ul>
<div id="rfc.figure.99"/>
<div id="jwe-ecdh-protected"/>
<pre>
{
"alg": "ECDH-ES",
"kid": "meriadoc.brandybuck@buckland.example",
"epk": {
"kty": "EC",
"crv": "P-256",
"x": "mPUKT_bAWGHIhg0TpjjqVsP1rXWQu_vwVOHHtNkdYoA",
"y": "8BQAsImGeAS46fyWw5MhYfGTT0IjBpFw2SS34Dv4Irs"
},
"enc": "A128CBC-HS256"
}
</pre>
<p class="figure">Figure 99: Protected JWE Header JSON</p>
<div id="rfc.figure.100"/>
<div id="jwe-ecdh-protected_b64u"/>
<pre>
eyJhbGciOiJFQ0RILUVTIiwia2lkIjoibWVyaWFkb2MuYnJhbmR5YnVja0BidW
NrbGFuZC5leGFtcGxlIiwiZXBrIjp7Imt0eSI6IkVDIiwiY3J2IjoiUC0yNTYi
LCJ4IjoibVBVS1RfYkFXR0hJaGcwVHBqanFWc1AxclhXUXVfdndWT0hIdE5rZF
lvQSIsInkiOiI4QlFBc0ltR2VBUzQ2ZnlXdzVNaFlmR1RUMElqQnBGdzJTUzM0
RHY0SXJzIn0sImVuYyI6IkExMjhDQkMtSFMyNTYifQ
</pre>
<p class="figure">Figure 100: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.5.4.p.3">Performing the content encryption operation on the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) using the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-ecdh-cek">Figure 98</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-ecdh-iv">Figure 96</a>); and</li>
<li>Protected JWE header (<a href="#jwe-ecdh-protected_b64u">Figure 100</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.5.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-ecdh-ciphertext">Figure 101</a>.</li>
<li>Authentication tag from <a href="#jwe-ecdh-tag">Figure 102</a>.</li>
</ul>
<div id="rfc.figure.101"/>
<div id="jwe-ecdh-ciphertext"/>
<pre>
BoDlwPnTypYq-ivjmQvAYJLb5Q6l-F3LIgQomlz87yW4OPKbWE1zSTEFjDfhU9
IPIOSA9Bml4m7iDFwA-1ZXvHteLDtw4R1XRGMEsDIqAYtskTTmzmzNa-_q4F_e
vAPUmwlO-ZG45Mnq4uhM1fm_D9rBtWolqZSF3xGNNkpOMQKF1Cl8i8wjzRli7-
IXgyirlKQsbhhqRzkv8IcY6aHl24j03C-AR2le1r7URUhArM79BY8soZU0lzwI
-sD5PZ3l4NDCCei9XkoIAfsXJWmySPoeRb2Ni5UZL4mYpvKDiwmyzGd65KqVw7
MsFfI_K767G9C9Azp73gKZD0DyUn1mn0WW5LmyX_yJ-3AROq8p1WZBfG-ZyJ61
95_JGG2m9Csg
</pre>
<p class="figure">Figure 101: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.102"/>
<div id="jwe-ecdh-tag"/>
<pre>
WCCkNa-x4BeB9hIDIfFuhg
</pre>
<p class="figure">Figure 102: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.5.5"><a href="#rfc.section.4.5.5">4.5.5.</a> <a href="#jwe-ecdh-output" id="jwe-ecdh-output">Output Results</a></h1>
<p id="rfc.section.4.5.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-ecdh_aeskw-protected_b64u">Figure 90</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-ecdh_aeskw-iv">Figure 86</a>)</li>
<li>Ciphertext (<a href="#jwe-ecdh_aeskw-ciphertext">Figure 91</a>)</li>
<li>Authentication tag (<a href="#jwe-ecdh_aeskw-tag">Figure 92</a>)</li>
</ul>
<p id="rfc.section.4.5.5.p.3">the resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.103"/>
<div id="jwe-ecdh-compact"/>
<pre>
eyJhbGciOiJFQ0RILUVTIiwia2lkIjoibWVyaWFkb2MuYnJhbmR5YnVja0BidW
NrbGFuZC5leGFtcGxlIiwiZXBrIjp7Imt0eSI6IkVDIiwiY3J2IjoiUC0yNTYi
LCJ4IjoibVBVS1RfYkFXR0hJaGcwVHBqanFWc1AxclhXUXVfdndWT0hIdE5rZF
lvQSIsInkiOiI4QlFBc0ltR2VBUzQ2ZnlXdzVNaFlmR1RUMElqQnBGdzJTUzM0
RHY0SXJzIn0sImVuYyI6IkExMjhDQkMtSFMyNTYifQ
.
.
yc9N8v5sYyv3iGQT926IUg
.
BoDlwPnTypYq-ivjmQvAYJLb5Q6l-F3LIgQomlz87yW4OPKbWE1zSTEFjDfhU9
IPIOSA9Bml4m7iDFwA-1ZXvHteLDtw4R1XRGMEsDIqAYtskTTmzmzNa-_q4F_e
vAPUmwlO-ZG45Mnq4uhM1fm_D9rBtWolqZSF3xGNNkpOMQKF1Cl8i8wjzRli7-
IXgyirlKQsbhhqRzkv8IcY6aHl24j03C-AR2le1r7URUhArM79BY8soZU0lzwI
-sD5PZ3l4NDCCei9XkoIAfsXJWmySPoeRb2Ni5UZL4mYpvKDiwmyzGd65KqVw7
MsFfI_K767G9C9Azp73gKZD0DyUn1mn0WW5LmyX_yJ-3AROq8p1WZBfG-ZyJ61
95_JGG2m9Csg
.
WCCkNa-x4BeB9hIDIfFuhg
</pre>
<p class="figure">Figure 103: Compact Serialization</p>
<p id="rfc.section.4.5.5.p.4">the resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.104"/>
<div id="jwe-ecdh-json"/>
<pre>
{
"protected": "eyJhbGciOiJFQ0RILUVTIiwia2lkIjoibWVyaWFkb2MuYn
JhbmR5YnVja0BidWNrbGFuZC5leGFtcGxlIiwiZXBrIjp7Imt0eSI6Ik
VDIiwiY3J2IjoiUC0yNTYiLCJ4IjoibVBVS1RfYkFXR0hJaGcwVHBqan
FWc1AxclhXUXVfdndWT0hIdE5rZFlvQSIsInkiOiI4QlFBc0ltR2VBUz
Q2ZnlXdzVNaFlmR1RUMElqQnBGdzJTUzM0RHY0SXJzIn0sImVuYyI6Ik
ExMjhDQkMtSFMyNTYifQ",
"iv": "yc9N8v5sYyv3iGQT926IUg",
"ciphertext": "BoDlwPnTypYq-ivjmQvAYJLb5Q6l-F3LIgQomlz87yW4O
PKbWE1zSTEFjDfhU9IPIOSA9Bml4m7iDFwA-1ZXvHteLDtw4R1XRGMEs
DIqAYtskTTmzmzNa-_q4F_evAPUmwlO-ZG45Mnq4uhM1fm_D9rBtWolq
ZSF3xGNNkpOMQKF1Cl8i8wjzRli7-IXgyirlKQsbhhqRzkv8IcY6aHl2
4j03C-AR2le1r7URUhArM79BY8soZU0lzwI-sD5PZ3l4NDCCei9XkoIA
fsXJWmySPoeRb2Ni5UZL4mYpvKDiwmyzGd65KqVw7MsFfI_K767G9C9A
zp73gKZD0DyUn1mn0WW5LmyX_yJ-3AROq8p1WZBfG-ZyJ6195_JGG2m9
Csg",
"tag": "WCCkNa-x4BeB9hIDIfFuhg"
}
</pre>
<p class="figure">Figure 104: JSON Serialization</p>
<h1 id="rfc.section.4.6"><a href="#rfc.section.4.6">4.6.</a> <a href="#jwe-dir_gcm" id="jwe-dir_gcm">Direct Encryption using AES-GCM</a></h1>
<p id="rfc.section.4.6.p.1">This example illustrates encrypting content using a previously exchanged key directly and the &#8220;A128GCM&#8221; (AES-GCM) content encryption algorithm.</p>
<h1 id="rfc.section.4.6.1"><a href="#rfc.section.4.6.1">4.6.1.</a> <a href="#jwe-dir_gcm-input" id="jwe-dir_gcm-input">Input Factors</a></h1>
<p id="rfc.section.4.6.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-dir_gcm-key">Figure 105</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;dir&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128GCM&#8221;</li>
</ul>
<div id="rfc.figure.105"/>
<div id="jwe-dir_gcm-key"/>
<pre>
{
"kty": "oct",
"kid": "77c7e2b8-6e13-45cf-8672-617b5b45243a",
"use": "enc",
"alg": "A128GCM",
"k": "XctOhJAkA-pD9Lh7ZgW_2A"
}
</pre>
<p class="figure">Figure 105: AES 128-bit key, in JWK format</p>
<h1 id="rfc.section.4.6.2"><a href="#rfc.section.4.6.2">4.6.2.</a> <a href="#jwe-dir_gcm-gen" id="jwe-dir_gcm-gen">Generated Factors</a></h1>
<p id="rfc.section.4.6.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-dir_gcm-iv">Figure 106</a>.</li>
</ul>
<div id="rfc.figure.106"/>
<div id="jwe-dir_gcm-iv"/>
<pre>
refa467QzzKx6QAB
</pre>
<p class="figure">Figure 106: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.6.3"><a href="#rfc.section.4.6.3">4.6.3.</a> <a href="#jwe-dir_gcm-contentenc" id="jwe-dir_gcm-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.6.3.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-dir_gcm-protected">Figure 107</a>, encoded as <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jwe-dir_gcm-protected_b64u">Figure 108</a>.</li>
</ul>
<div id="rfc.figure.107"/>
<div id="jwe-dir_gcm-protected"/>
<pre>
{
"alg": "dir",
"kid": "77c7e2b8-6e13-45cf-8672-617b5b45243a",
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 107: Protected JWE Header JSON</p>
<p id="rfc.section.4.6.3.p.3">Encoded as <a href="#RFC4648">[RFC4648]</a> base64url:</p>
<div id="rfc.figure.108"/>
<div id="jwe-dir_gcm-protected_b64u"/>
<pre>
eyJhbGciOiJkaXIiLCJraWQiOiI3N2M3ZTJiOC02ZTEzLTQ1Y2YtODY3Mi02MT
diNWI0NTI0M2EiLCJlbmMiOiJBMTI4R0NNIn0
</pre>
<p class="figure">Figure 108: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.6.3.p.4">Performing the encryption operation on the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) using the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-dir_gcm-key">Figure 105</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-dir_gcm-iv">Figure 106</a>); and</li>
<li>Protected JWE header (<a href="#jwe-dir_gcm-protected_b64u">Figure 108</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.6.3.p.6">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-dir_gcm-ciphertext">Figure 109</a>.</li>
<li>Authentication tag from <a href="#jwe-dir_gcm-tag">Figure 110</a>.</li>
</ul>
<div id="rfc.figure.109"/>
<div id="jwe-dir_gcm-ciphertext"/>
<pre>
JW_i_f52hww_ELQPGaYyeAB6HYGcR559l9TYnSovc23XJoBcW29rHP8yZOZG7Y
hLpT1bjFuvZPjQS-m0IFtVcXkZXdH_lr_FrdYt9HRUYkshtrMmIUAyGmUnd9zM
DB2n0cRDIHAzFVeJUDxkUwVAE7_YGRPdcqMyiBoCO-FBdE-Nceb4h3-FtBP-c_
BIwCPTjb9o0SbdcdREEMJMyZBH8ySWMVi1gPD9yxi-aQpGbSv_F9N4IZAxscj5
g-NJsUPbjk29-s7LJAGb15wEBtXphVCgyy53CoIKLHHeJHXex45Uz9aKZSRSIn
ZI-wjsY0yu3cT4_aQ3i1o-tiE-F8Ios61EKgyIQ4CWao8PFMj8TTnp
</pre>
<p class="figure">Figure 109: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.110"/>
<div id="jwe-dir_gcm-tag"/>
<pre>
vbb32Xvllea2OtmHAdccRQ
</pre>
<p class="figure">Figure 110: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.6.4"><a href="#rfc.section.4.6.4">4.6.4.</a> <a href="#jwe-dir_gcm-output" id="jwe-dir_gcm-output">Output Results</a></h1>
<p id="rfc.section.4.6.4.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-dir_gcm-protected_b64u">Figure 108</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-dir_gcm-iv">Figure 106</a>)</li>
<li>Ciphertext (<a href="#jwe-dir_gcm-ciphertext">Figure 109</a>)</li>
<li>Authentication tag (<a href="#jwe-dir_gcm-tag">Figure 110</a>)</li>
</ul>
<p id="rfc.section.4.6.4.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.111"/>
<div id="jwe-dir_gcm-compact"/>
<pre>
eyJhbGciOiJkaXIiLCJraWQiOiI3N2M3ZTJiOC02ZTEzLTQ1Y2YtODY3Mi02MT
diNWI0NTI0M2EiLCJlbmMiOiJBMTI4R0NNIn0
.
.
refa467QzzKx6QAB
.
JW_i_f52hww_ELQPGaYyeAB6HYGcR559l9TYnSovc23XJoBcW29rHP8yZOZG7Y
hLpT1bjFuvZPjQS-m0IFtVcXkZXdH_lr_FrdYt9HRUYkshtrMmIUAyGmUnd9zM
DB2n0cRDIHAzFVeJUDxkUwVAE7_YGRPdcqMyiBoCO-FBdE-Nceb4h3-FtBP-c_
BIwCPTjb9o0SbdcdREEMJMyZBH8ySWMVi1gPD9yxi-aQpGbSv_F9N4IZAxscj5
g-NJsUPbjk29-s7LJAGb15wEBtXphVCgyy53CoIKLHHeJHXex45Uz9aKZSRSIn
ZI-wjsY0yu3cT4_aQ3i1o-tiE-F8Ios61EKgyIQ4CWao8PFMj8TTnp
.
vbb32Xvllea2OtmHAdccRQ
</pre>
<p class="figure">Figure 111: Compact Serialization</p>
<p id="rfc.section.4.6.4.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.112"/>
<div id="jwe-dir_gcm-json"/>
<pre>
{
"protected": "eyJhbGciOiJkaXIiLCJraWQiOiI3N2M3ZTJiOC02ZTEzLT
Q1Y2YtODY3Mi02MTdiNWI0NTI0M2EiLCJlbmMiOiJBMTI4R0NNIn0",
"iv": "refa467QzzKx6QAB",
"ciphertext": "JW_i_f52hww_ELQPGaYyeAB6HYGcR559l9TYnSovc23XJ
oBcW29rHP8yZOZG7YhLpT1bjFuvZPjQS-m0IFtVcXkZXdH_lr_FrdYt9
HRUYkshtrMmIUAyGmUnd9zMDB2n0cRDIHAzFVeJUDxkUwVAE7_YGRPdc
qMyiBoCO-FBdE-Nceb4h3-FtBP-c_BIwCPTjb9o0SbdcdREEMJMyZBH8
ySWMVi1gPD9yxi-aQpGbSv_F9N4IZAxscj5g-NJsUPbjk29-s7LJAGb1
5wEBtXphVCgyy53CoIKLHHeJHXex45Uz9aKZSRSInZI-wjsY0yu3cT4_
aQ3i1o-tiE-F8Ios61EKgyIQ4CWao8PFMj8TTnp",
"tag": "vbb32Xvllea2OtmHAdccRQ"
}
</pre>
<p class="figure">Figure 112: JSON Serialization</p>
<h1 id="rfc.section.4.7"><a href="#rfc.section.4.7">4.7.</a> <a href="#jwe-aesgcmkw" id="jwe-aesgcmkw">Key Wrap using AES-GCM KeyWrap with AES-CBC-HMAC-SHA2</a></h1>
<p id="rfc.section.4.7.p.1">This example illustrates encrypting content using the &#8220;A256GCMKW&#8221; (AES-256-GCM-KeyWrap) key encryption algorithm with the &#8220;A128CBC-HS256&#8221; (AES-128-CBC-HMAC-SHA-256) content encryption algorithm.</p>
<h1 id="rfc.section.4.7.1"><a href="#rfc.section.4.7.1">4.7.1.</a> <a href="#jwe-aesgcmkw-input" id="jwe-aesgcmkw-input">Input Factors</a></h1>
<p id="rfc.section.4.7.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>AES symmetric key; this example uses the key from <a href="#jwe-aesgcmkw-key">Figure 113</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;A256GCMKW&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128CBC-HS256&#8221;</li>
</ul>
<div id="rfc.figure.113"/>
<div id="jwe-aesgcmkw-key"/>
<pre>
{
"kty": "oct",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"use": "enc",
"alg": "A256GCMKW",
"k": "qC57l_uxcm7Nm3K-ct4GFjx8tM1U8CZ0NLBvdQstiS8"
}
</pre>
<p class="figure">Figure 113: AES 256-bit Key</p>
<h1 id="rfc.section.4.7.2"><a href="#rfc.section.4.7.2">4.7.2.</a> <a href="#jwe-aesgcmkw-gen" id="jwe-aesgcmkw-gen">Generated Factors</a></h1>
<p id="rfc.section.4.7.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-aesgcmkw-cek">Figure 114</a>.</li>
<li>Initialization vector/nonce for content encryption; this example uses the initialization vector/nonce from <a href="#jwe-aesgcmkw-iv">Figure 115</a>.</li>
</ul>
<div id="rfc.figure.114"/>
<div id="jwe-aesgcmkw-cek"/>
<pre>
UWxARpat23nL9ReIj4WG3D1ee9I4r-Mv5QLuFXdy_rE
</pre>
<p class="figure">Figure 114: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.115"/>
<div id="jwe-aesgcmkw-iv"/>
<pre>
gz6NjyEFNm_vm8Gj6FwoFQ
</pre>
<p class="figure">Figure 115: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.7.3"><a href="#rfc.section.4.7.3">4.7.3.</a> <a href="#jwe-aesgcmkw-keyenc" id="jwe-aesgcmkw-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.7.3.p.1">The following are generated before encrypting the CEK:</p>
<p/>

<ul>
<li>Initialization vector/nonce for key wrapping; this example uses the initialization vector/nonce from <a href="#jwe-aesgcmkw-kwiv">Figure 116</a>.</li>
</ul>
<div id="rfc.figure.116"/>
<div id="jwe-aesgcmkw-kwiv"/>
<pre>
KkYT0GX_2jHlfqN_
</pre>
<p class="figure">Figure 116: Key Wrap Initialization Vector, base64url-encoded</p>
<p id="rfc.section.4.7.3.p.3">Performing the key encryption operation over the CEK (<a href="#jwe-aesgcmkw-cek">Figure 114</a>) with the following:</p>
<p/>

<ul>
<li>AES symmetric key (<a href="#jwe-aesgcmkw-key">Figure 113</a>); </li>
<li>Key wrap initialization vector/nonce (<a href="#jwe-aesgcmkw-kwiv">Figure 116</a>); and</li>
<li>The empty string as authenticated data</li>
</ul>
<p id="rfc.section.4.7.3.p.5">produces the following:</p>
<p/>

<ul>
<li>Encrypted Key from <a href="#jwe-aesgcmkw-encdkey">Figure 117</a>.</li>
<li>Key wrap authentication tag from <a href="#jwe-aesgcmkw-kwtag">Figure 118</a>.</li>
</ul>
<div id="rfc.figure.117"/>
<div id="jwe-aesgcmkw-encdkey"/>
<pre>
lJf3HbOApxMEBkCMOoTnnABxs_CvTWUmZQ2ElLvYNok
</pre>
<p class="figure">Figure 117: Encrypted Key, base64url-encoded</p>
<div id="rfc.figure.118"/>
<div id="jwe-aesgcmkw-kwtag"/>
<pre>
kfPduVQ3T3H6vnewt--ksw
</pre>
<p class="figure">Figure 118: Key Wrap Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.7.4"><a href="#rfc.section.4.7.4">4.7.4.</a> <a href="#jwe-aesgcmkw-contentenc" id="jwe-aesgcmkw-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.7.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-aesgcmkw-protected">Figure 119</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-aesgcmkw-protected_b64u">Figure 120</a>.</li>
</ul>
<div id="rfc.figure.119"/>
<div id="jwe-aesgcmkw-protected"/>
<pre>
{
"alg": "A256GCMKW",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"tag": "kfPduVQ3T3H6vnewt--ksw",
"iv": "KkYT0GX_2jHlfqN_",
"enc": "A128CBC-HS256"
}
</pre>
<p class="figure">Figure 119: Protected JWE Header JSON</p>
<div id="rfc.figure.120"/>
<div id="jwe-aesgcmkw-protected_b64u"/>
<pre>
eyJhbGciOiJBMjU2R0NNS1ciLCJraWQiOiIxOGVjMDhlMS1iZmE5LTRkOTUtYj
IwNS0yYjRkZDFkNDMyMWQiLCJ0YWciOiJrZlBkdVZRM1QzSDZ2bmV3dC0ta3N3
IiwiaXYiOiJLa1lUMEdYXzJqSGxmcU5fIiwiZW5jIjoiQTEyOENCQy1IUzI1Ni
J9
</pre>
<p class="figure">Figure 120: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.7.4.p.3">Performing the content encryption operation over the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-aesgcmkw-cek">Figure 114</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-aesgcmkw-iv">Figure 115</a>); and</li>
<li>Protected JWE header (<a href="#jwe-aesgcmkw-protected_b64u">Figure 120</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.7.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-aesgcmkw-ciphertext">Figure 121</a>.</li>
<li>Authentication tag from <a href="#jwe-aesgcmkw-tag">Figure 122</a>.</li>
</ul>
<div id="rfc.figure.121"/>
<div id="jwe-aesgcmkw-ciphertext"/>
<pre>
Jf5p9-ZhJlJy_IQ_byKFmI0Ro7w7G1QiaZpI8OaiVgD8EqoDZHyFKFBupS8iaE
eVIgMqWmsuJKuoVgzR3YfzoMd3GxEm3VxNhzWyWtZKX0gxKdy6HgLvqoGNbZCz
LjqcpDiF8q2_62EVAbr2uSc2oaxFmFuIQHLcqAHxy51449xkjZ7ewzZaGV3eFq
hpco8o4DijXaG5_7kp3h2cajRfDgymuxUbWgLqaeNQaJtvJmSMFuEOSAzw9Hde
b6yhdTynCRmu-kqtO5Dec4lT2OMZKpnxc_F1_4yDJFcqb5CiDSmA-psB2k0Jtj
xAj4UPI61oONK7zzFIu4gBfjJCndsZfdvG7h8wGjV98QhrKEnR7xKZ3KCr0_qR
1B-gxpNk3xWU
</pre>
<p class="figure">Figure 121: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.122"/>
<div id="jwe-aesgcmkw-tag"/>
<pre>
DKW7jrb4WaRSNfbXVPlT5g
</pre>
<p class="figure">Figure 122: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.7.5"><a href="#rfc.section.4.7.5">4.7.5.</a> <a href="#jwe-aesgcmkw-output" id="jwe-aesgcmkw-output">Output Results</a></h1>
<p id="rfc.section.4.7.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-aesgcmkw-protected_b64u">Figure 120</a>)</li>
<li>encrypted key (<a href="#jwe-aesgcmkw-encdkey">Figure 117</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-aesgcmkw-iv">Figure 115</a>)</li>
<li>Ciphertext (<a href="#jwe-aesgcmkw-ciphertext">Figure 121</a>)</li>
<li>Authentication tag (<a href="#jwe-aesgcmkw-tag">Figure 122</a>)</li>
</ul>
<p id="rfc.section.4.7.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.123"/>
<div id="jwe-aesgcmkw-compact"/>
<pre>
eyJhbGciOiJBMjU2R0NNS1ciLCJraWQiOiIxOGVjMDhlMS1iZmE5LTRkOTUtYj
IwNS0yYjRkZDFkNDMyMWQiLCJ0YWciOiJrZlBkdVZRM1QzSDZ2bmV3dC0ta3N3
IiwiaXYiOiJLa1lUMEdYXzJqSGxmcU5fIiwiZW5jIjoiQTEyOENCQy1IUzI1Ni
J9
.
lJf3HbOApxMEBkCMOoTnnABxs_CvTWUmZQ2ElLvYNok
.
gz6NjyEFNm_vm8Gj6FwoFQ
.
Jf5p9-ZhJlJy_IQ_byKFmI0Ro7w7G1QiaZpI8OaiVgD8EqoDZHyFKFBupS8iaE
eVIgMqWmsuJKuoVgzR3YfzoMd3GxEm3VxNhzWyWtZKX0gxKdy6HgLvqoGNbZCz
LjqcpDiF8q2_62EVAbr2uSc2oaxFmFuIQHLcqAHxy51449xkjZ7ewzZaGV3eFq
hpco8o4DijXaG5_7kp3h2cajRfDgymuxUbWgLqaeNQaJtvJmSMFuEOSAzw9Hde
b6yhdTynCRmu-kqtO5Dec4lT2OMZKpnxc_F1_4yDJFcqb5CiDSmA-psB2k0Jtj
xAj4UPI61oONK7zzFIu4gBfjJCndsZfdvG7h8wGjV98QhrKEnR7xKZ3KCr0_qR
1B-gxpNk3xWU
.
DKW7jrb4WaRSNfbXVPlT5g
</pre>
<p class="figure">Figure 123: Compact Serialization</p>
<p id="rfc.section.4.7.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.124"/>
<div id="jwe-aesgcmkw-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "lJf3HbOApxMEBkCMOoTnnABxs_CvTWUmZQ2ElL
vYNok"
}
],
"protected": "eyJhbGciOiJBMjU2R0NNS1ciLCJraWQiOiIxOGVjMDhlMS
1iZmE5LTRkOTUtYjIwNS0yYjRkZDFkNDMyMWQiLCJ0YWciOiJrZlBkdV
ZRM1QzSDZ2bmV3dC0ta3N3IiwiaXYiOiJLa1lUMEdYXzJqSGxmcU5fIi
wiZW5jIjoiQTEyOENCQy1IUzI1NiJ9",
"iv": "gz6NjyEFNm_vm8Gj6FwoFQ",
"ciphertext": "Jf5p9-ZhJlJy_IQ_byKFmI0Ro7w7G1QiaZpI8OaiVgD8E
qoDZHyFKFBupS8iaEeVIgMqWmsuJKuoVgzR3YfzoMd3GxEm3VxNhzWyW
tZKX0gxKdy6HgLvqoGNbZCzLjqcpDiF8q2_62EVAbr2uSc2oaxFmFuIQ
HLcqAHxy51449xkjZ7ewzZaGV3eFqhpco8o4DijXaG5_7kp3h2cajRfD
gymuxUbWgLqaeNQaJtvJmSMFuEOSAzw9Hdeb6yhdTynCRmu-kqtO5Dec
4lT2OMZKpnxc_F1_4yDJFcqb5CiDSmA-psB2k0JtjxAj4UPI61oONK7z
zFIu4gBfjJCndsZfdvG7h8wGjV98QhrKEnR7xKZ3KCr0_qR1B-gxpNk3
xWU",
"tag": "DKW7jrb4WaRSNfbXVPlT5g"
}
</pre>
<p class="figure">Figure 124: JSON Serialization</p>
<h1 id="rfc.section.4.8"><a href="#rfc.section.4.8">4.8.</a> <a href="#jwe-aeskw" id="jwe-aeskw">Key Wrap using AES-KeyWrap with AES-GCM</a></h1>
<p id="rfc.section.4.8.p.1">The following example illustrates content encryption using the &#8220;A128KW&#8221; (AES-128-KeyWrap) key encryption algorithm and the &#8220;A128GCM&#8221; (AES-128-GCM) content encryption algorithm.</p>
<h1 id="rfc.section.4.8.1"><a href="#rfc.section.4.8.1">4.8.1.</a> <a href="#jwe-aeskw-input" id="jwe-aeskw-input">Input Factors</a></h1>
<p id="rfc.section.4.8.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>AES symmetric key; this example uses the key from <a href="#jwe-aeskw-key">Figure 125</a>.</li>
<li>&#8220;alg&#8221; parameter of &#8220;A128KW&#8221;</li>
<li>&#8220;enc&#8221; parameter of &#8220;A128GCM&#8221;</li>
</ul>
<div id="rfc.figure.125"/>
<div id="jwe-aeskw-key"/>
<pre>
{
"kty": "oct",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"use": "enc",
"alg": "A128KW",
"k": "GZy6sIZ6wl9NJOKB-jnmVQ"
}
</pre>
<p class="figure">Figure 125: AES 128-Bit Key</p>
<h1 id="rfc.section.4.8.2"><a href="#rfc.section.4.8.2">4.8.2.</a> <a href="#jwe-aeskw-gen" id="jwe-aeskw-gen">Generated Factors</a></h1>
<p id="rfc.section.4.8.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key; this example uses the key from <a href="#jwe-aeskw-cek">Figure 126</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-aeskw-iv">Figure 127</a>.</li>
</ul>
<div id="rfc.figure.126"/>
<div id="jwe-aeskw-cek"/>
<pre>
aY5_Ghmk9KxWPBLu_glx1w
</pre>
<p class="figure">Figure 126: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.127"/>
<div id="jwe-aeskw-iv"/>
<pre>
Qx0pmsDa8KnJc9Jo
</pre>
<p class="figure">Figure 127: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.8.3"><a href="#rfc.section.4.8.3">4.8.3.</a> <a href="#jwe-aeskw-keyenc" id="jwe-aeskw-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.8.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-aeskw-cek">Figure 126</a>) with the AES key (<a href="#jwe-aeskw-key">Figure 125</a>) produces the following encrypted key:</p>
<div id="rfc.figure.128"/>
<div id="jwe-aeskw-encdkey"/>
<pre>
CBI6oDw8MydIx1IBntf_lQcw2MmJKIQx
</pre>
<p class="figure">Figure 128: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.8.4"><a href="#rfc.section.4.8.4">4.8.4.</a> <a href="#jwe-aeskw-contentenc" id="jwe-aeskw-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.8.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-aeskw-protected">Figure 129</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-aeskw-protected_b64u">Figure 130</a>.</li>
</ul>
<div id="rfc.figure.129"/>
<div id="jwe-aeskw-protected"/>
<pre>
{
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 129: Protected JWE Header JSON</p>
<div id="rfc.figure.130"/>
<div id="jwe-aeskw-protected_b64u"/>
<pre>
eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC
04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn0
</pre>
<p class="figure">Figure 130: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.8.4.p.3">Performing the content encryption over the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-aeskw-cek">Figure 126</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-aeskw-iv">Figure 127</a>); and</li>
<li>Protected JWE header (<a href="#jwe-aeskw-protected_b64u">Figure 130</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.8.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-aeskw-ciphertext">Figure 131</a>.</li>
<li>Authentication tag from <a href="#jwe-aeskw-tag">Figure 132</a>.</li>
</ul>
<div id="rfc.figure.131"/>
<div id="jwe-aeskw-ciphertext"/>
<pre>
AwliP-KmWgsZ37BvzCefNen6VTbRK3QMA4TkvRkH0tP1bTdhtFJgJxeVmJkLD6
1A1hnWGetdg11c9ADsnWgL56NyxwSYjU1ZEHcGkd3EkU0vjHi9gTlb90qSYFfe
F0LwkcTtjbYKCsiNJQkcIp1yeM03OmuiYSoYJVSpf7ej6zaYcMv3WwdxDFl8RE
wOhNImk2Xld2JXq6BR53TSFkyT7PwVLuq-1GwtGHlQeg7gDT6xW0JqHDPn_H-p
uQsmthc9Zg0ojmJfqqFvETUxLAF-KjcBTS5dNy6egwkYtOt8EIHK-oEsKYtZRa
a8Z7MOZ7UGxGIMvEmxrGCPeJa14slv2-gaqK0kEThkaSqdYw0FkQZF
</pre>
<p class="figure">Figure 131: Ciphertext, base64url-encoded</p>
<p id="rfc.section.4.8.4.p.7">And authentication tag:</p>
<div id="rfc.figure.132"/>
<div id="jwe-aeskw-tag"/>
<pre>
ER7MWJZ1FBI_NKvn7Zb1Lw
</pre>
<p class="figure">Figure 132: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.8.5"><a href="#rfc.section.4.8.5">4.8.5.</a> <a href="#jwe-aeskw-output" id="jwe-aeskw-output">Output Results</a></h1>
<p id="rfc.section.4.8.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-aeskw-protected_b64u">Figure 130</a>)</li>
<li>encrypted key (<a href="#jwe-aeskw-encdkey">Figure 128</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-aeskw-iv">Figure 127</a>)</li>
<li>Ciphertext (<a href="#jwe-aeskw-ciphertext">Figure 131</a>)</li>
<li>Authentication tag (<a href="#jwe-aeskw-tag">Figure 132</a>)</li>
</ul>
<p id="rfc.section.4.8.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.133"/>
<div id="jwe-aeskw-compact"/>
<pre>
eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC
04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn0
.
CBI6oDw8MydIx1IBntf_lQcw2MmJKIQx
.
Qx0pmsDa8KnJc9Jo
.
AwliP-KmWgsZ37BvzCefNen6VTbRK3QMA4TkvRkH0tP1bTdhtFJgJxeVmJkLD6
1A1hnWGetdg11c9ADsnWgL56NyxwSYjU1ZEHcGkd3EkU0vjHi9gTlb90qSYFfe
F0LwkcTtjbYKCsiNJQkcIp1yeM03OmuiYSoYJVSpf7ej6zaYcMv3WwdxDFl8RE
wOhNImk2Xld2JXq6BR53TSFkyT7PwVLuq-1GwtGHlQeg7gDT6xW0JqHDPn_H-p
uQsmthc9Zg0ojmJfqqFvETUxLAF-KjcBTS5dNy6egwkYtOt8EIHK-oEsKYtZRa
a8Z7MOZ7UGxGIMvEmxrGCPeJa14slv2-gaqK0kEThkaSqdYw0FkQZF
.
ER7MWJZ1FBI_NKvn7Zb1Lw
</pre>
<p class="figure">Figure 133: Compact Serialization</p>
<p id="rfc.section.4.8.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.134"/>
<div id="jwe-aeskw-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "CBI6oDw8MydIx1IBntf_lQcw2MmJKIQx"
}
],
"protected": "eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04Mz
MyLTQzZDktYTQ2OC04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn
0",
"iv": "Qx0pmsDa8KnJc9Jo",
"ciphertext": "AwliP-KmWgsZ37BvzCefNen6VTbRK3QMA4TkvRkH0tP1b
TdhtFJgJxeVmJkLD61A1hnWGetdg11c9ADsnWgL56NyxwSYjU1ZEHcGk
d3EkU0vjHi9gTlb90qSYFfeF0LwkcTtjbYKCsiNJQkcIp1yeM03OmuiY
SoYJVSpf7ej6zaYcMv3WwdxDFl8REwOhNImk2Xld2JXq6BR53TSFkyT7
PwVLuq-1GwtGHlQeg7gDT6xW0JqHDPn_H-puQsmthc9Zg0ojmJfqqFvE
TUxLAF-KjcBTS5dNy6egwkYtOt8EIHK-oEsKYtZRaa8Z7MOZ7UGxGIMv
EmxrGCPeJa14slv2-gaqK0kEThkaSqdYw0FkQZF",
"tag": "ER7MWJZ1FBI_NKvn7Zb1Lw"
}
</pre>
<p class="figure">Figure 134: JSON Serialization</p>
<h1 id="rfc.section.4.9"><a href="#rfc.section.4.9">4.9.</a> <a href="#jwe-compressed" id="jwe-compressed">Compressed Content</a></h1>
<p id="rfc.section.4.9.p.1">This example illustrates encrypting content that is first compressed.  It reuses the AES key, key encryption algorithm, and content encryption algorithm from <a href="#jwe-aeskw">Section 4.8</a>.</p>
<h1 id="rfc.section.4.9.1"><a href="#rfc.section.4.9.1">4.9.1.</a> <a href="#jwe-compressed-input" id="jwe-compressed-input">Input Factors</a></h1>
<p id="rfc.section.4.9.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>Recipient encryption key; this example uses the key from <a href="#jwe-aeskw-key">Figure 125</a>.</li>
<li>Key encryption algorithm; this example uses &#8220;A128KW&#8221;.</li>
<li>Content encryption algorithm; this example uses &#8220;A128GCM&#8221;.</li>
<li>&#8220;zip&#8221; parameter as &#8220;DEF&#8221;.</li>
</ul>
<h1 id="rfc.section.4.9.2"><a href="#rfc.section.4.9.2">4.9.2.</a> <a href="#jwe-compressed-gen" id="jwe-compressed-gen">Generated Factors</a></h1>
<p id="rfc.section.4.9.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>Compressed plaintext from the original plaintext content; compressing <a href="#jwe-plaintext">Figure 51</a> using the DEFLATE <a href="#RFC1951">[RFC1951]</a> algorithm produces the compressed plaintext from <a href="#jwe-compressed-plaintext_c">Figure 135</a>.</li>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-compressed-cek">Figure 136</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-compressed-iv">Figure 137</a>.</li>
</ul>
<div id="rfc.figure.135"/>
<div id="jwe-compressed-plaintext_c"/>
<pre>
bY_BDcIwDEVX-QNU3QEOrIA4pqlDokYxchxVvbEDGzIJbioOSJwc-f___HPjBu
8KVFpVtAplVE1-wZo0YjNZo3C7R5v72pV5f5X382VWjYQpqZKAyjziZOr2B7kQ
PSy6oZIXUnDYbVKN4jNXi2u0yB7t1qSHTjmMODf9QgvrDzfTIQXnyQRuUya4zI
WG3vTOdir0v7BRHFYWq3k1k1A_gSDJqtcBF-GZxw8
</pre>
<p class="figure">Figure 135: Compressed Plaintext, base64url-encoded</p>
<div id="rfc.figure.136"/>
<div id="jwe-compressed-cek"/>
<pre>
hC-MpLZSuwWv8sexS6ydfw
</pre>
<p class="figure">Figure 136: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.137"/>
<div id="jwe-compressed-iv"/>
<pre>
p9pUq6XHY0jfEZIl
</pre>
<p class="figure">Figure 137: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.9.3"><a href="#rfc.section.4.9.3">4.9.3.</a> <a href="#jwe-compressed-keyenc" id="jwe-compressed-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.9.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-compressed-cek">Figure 136</a>) with the AES key (<a href="#jwe-aeskw-key">Figure 125</a>) produces the following encrypted key:</p>
<div id="rfc.figure.138"/>
<div id="jwe-compressed-encdkey"/>
<pre>
5vUT2WOtQxKWcekM_IzVQwkGgzlFDwPi
</pre>
<p class="figure">Figure 138: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.9.4"><a href="#rfc.section.4.9.4">4.9.4.</a> <a href="#jwe-compressed-contentenc" id="jwe-compressed-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.9.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-compressed-protected">Figure 139</a>, encoded as <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-compressed-protected_b64u">Figure 140</a>.</li>
</ul>
<div id="rfc.figure.139"/>
<div id="jwe-compressed-protected"/>
<pre>
{
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"enc": "A128GCM",
"zip": "DEF"
}
</pre>
<p class="figure">Figure 139: Protected JWE Header JSON</p>
<div id="rfc.figure.140"/>
<div id="jwe-compressed-protected_b64u"/>
<pre>
eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC
04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIiwiemlwIjoiREVGIn0
</pre>
<p class="figure">Figure 140: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.9.4.p.3">Performing the content encryption operation over the compressed Plaintext (<a href="#jwe-compressed-plaintext_c">Figure 135</a>, encoded as an octet string) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-compressed-cek">Figure 136</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-compressed-iv">Figure 137</a>); and</li>
<li>Protected JWE header (<a href="#jwe-compressed-protected_b64u">Figure 140</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.9.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-compressed-ciphertext">Figure 141</a>.</li>
<li>Authentication tag from <a href="#jwe-compressed-tag">Figure 142</a>.</li>
</ul>
<div id="rfc.figure.141"/>
<div id="jwe-compressed-ciphertext"/>
<pre>
HbDtOsdai1oYziSx25KEeTxmwnh8L8jKMFNc1k3zmMI6VB8hry57tDZ61jXyez
SPt0fdLVfe6Jf5y5-JaCap_JQBcb5opbmT60uWGml8blyiMQmOn9J--XhhlYg0
m-BHaqfDO5iTOWxPxFMUedx7WCy8mxgDHj0aBMG6152PsM-w5E_o2B3jDbrYBK
hpYA7qi3AyijnCJ7BP9rr3U8kxExCpG3mK420TjOw
</pre>
<p class="figure">Figure 141: Ciphertext, base64url-encoded</p>
<p id="rfc.section.4.9.4.p.7">And authentication tag:</p>
<div id="rfc.figure.142"/>
<div id="jwe-compressed-tag"/>
<pre>
VILuUwuIxaLVmh5X-T7kmA
</pre>
<p class="figure">Figure 142: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.9.5"><a href="#rfc.section.4.9.5">4.9.5.</a> <a href="#jwe-compressed-output" id="jwe-compressed-output">Output Results</a></h1>
<p id="rfc.section.4.9.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-compressed-protected_b64u">Figure 140</a>)</li>
<li>encrypted key (<a href="#jwe-compressed-encdkey">Figure 138</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-compressed-iv">Figure 137</a>)</li>
<li>Ciphertext (<a href="#jwe-compressed-ciphertext">Figure 141</a>)</li>
<li>Authentication tag (<a href="#jwe-compressed-tag">Figure 142</a>)</li>
</ul>
<p id="rfc.section.4.9.5.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.143"/>
<div id="jwe-compressed-compact"/>
<pre>
eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC
04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIiwiemlwIjoiREVGIn0
.
5vUT2WOtQxKWcekM_IzVQwkGgzlFDwPi
.
p9pUq6XHY0jfEZIl
.
HbDtOsdai1oYziSx25KEeTxmwnh8L8jKMFNc1k3zmMI6VB8hry57tDZ61jXyez
SPt0fdLVfe6Jf5y5-JaCap_JQBcb5opbmT60uWGml8blyiMQmOn9J--XhhlYg0
m-BHaqfDO5iTOWxPxFMUedx7WCy8mxgDHj0aBMG6152PsM-w5E_o2B3jDbrYBK
hpYA7qi3AyijnCJ7BP9rr3U8kxExCpG3mK420TjOw
.
VILuUwuIxaLVmh5X-T7kmA
</pre>
<p class="figure">Figure 143: Compact Serialization</p>
<p id="rfc.section.4.9.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.144"/>
<div id="jwe-compressed-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "5vUT2WOtQxKWcekM_IzVQwkGgzlFDwPi"
}
],
"protected": "eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04Mz
MyLTQzZDktYTQ2OC04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIi
wiemlwIjoiREVGIn0",
"iv": "p9pUq6XHY0jfEZIl",
"ciphertext": "HbDtOsdai1oYziSx25KEeTxmwnh8L8jKMFNc1k3zmMI6V
B8hry57tDZ61jXyezSPt0fdLVfe6Jf5y5-JaCap_JQBcb5opbmT60uWG
ml8blyiMQmOn9J--XhhlYg0m-BHaqfDO5iTOWxPxFMUedx7WCy8mxgDH
j0aBMG6152PsM-w5E_o2B3jDbrYBKhpYA7qi3AyijnCJ7BP9rr3U8kxE
xCpG3mK420TjOw",
"tag": "VILuUwuIxaLVmh5X-T7kmA"
}
</pre>
<p class="figure">Figure 144: JSON Serialization</p>
<h1 id="rfc.section.4.10"><a href="#rfc.section.4.10">4.10.</a> <a href="#jwe-aad" id="jwe-aad">Including Additional Authenticated Data</a></h1>
<p id="rfc.section.4.10.p.1">This example illustrates encrypting content that includes additional authenticated data. As this example includes an additional top-level property not present in the Compact serialization, only the JSON serialization is possible.</p>
<h1 id="rfc.section.4.10.1"><a href="#rfc.section.4.10.1">4.10.1.</a> <a href="#jwe-aad-input" id="jwe-aad-input">Input Factors</a></h1>
<p id="rfc.section.4.10.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>Recipient encryption key; this example uses the key from <a href="#jwe-aeskw-key">Figure 125</a>.</li>
<li>Key encryption algorithm; this example uses &#8220;A128KW&#8221;.</li>
<li>Content encryption algorithm; this example uses &#8220;A128GCM&#8221;.</li>
<li>Additional authenticated data; this example uses a <a href="#RFC7095">[RFC7095]</a> vCard from <a href="#jwe-aad-data">Figure 145</a>, serialized to UTF-8.</li>
</ul>
<div id="rfc.figure.145"/>
<div id="jwe-aad-data"/>
<pre>
[
"vcard",
[
[ "version", {}, "text", "4.0" ],
[ "fn", {}, "text", "Meriadoc Brandybuck" ],
[ "n", {},
"text", [
"Brandybuck", "Meriadoc", "Mr.", ""
]
],
[ "bday", {}, "text", "TA 2982" ],
[ "gender", {}, "text", "M" ]
]
]
</pre>
<p class="figure">Figure 145: Additional Authenticated Data, in JSON format</p>
<p><strong>NOTE</strong> whitespace between JSON values added for readability.</p>
<h1 id="rfc.section.4.10.2"><a href="#rfc.section.4.10.2">4.10.2.</a> <a href="#jwe-aad-gen" id="jwe-aad-gen">Generated Factors</a></h1>
<p id="rfc.section.4.10.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-aad-cek">Figure 146</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-aad-iv">Figure 147</a>.</li>
<li>Encoded additional authenticated data (AAD); this example uses the additional authenticated data from <a href="#jwe-aad-data">Figure 145</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-aad-data_b64u">Figure 148</a>.</li>
</ul>
<div id="rfc.figure.146"/>
<div id="jwe-aad-cek"/>
<pre>
75m1ALsYv10pZTKPWrsqdg
</pre>
<p class="figure">Figure 146: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.147"/>
<div id="jwe-aad-iv"/>
<pre>
veCx9ece2orS7c_N
</pre>
<p class="figure">Figure 147: Initialization Vector, base64url-encoded</p>
<div id="rfc.figure.148"/>
<div id="jwe-aad-data_b64u"/>
<pre>
WyJ2Y2FyZCIsW1sidmVyc2lvbiIse30sInRleHQiLCI0LjAiXSxbImZuIix7fS
widGV4dCIsIk1lcmlhZG9jIEJyYW5keWJ1Y2siXSxbIm4iLHt9LCJ0ZXh0Iixb
IkJyYW5keWJ1Y2siLCJNZXJpYWRvYyIsIk1yLiIsIiJdXSxbImJkYXkiLHt9LC
J0ZXh0IiwiVEEgMjk4MiJdLFsiZ2VuZGVyIix7fSwidGV4dCIsIk0iXV1d
</pre>
<p class="figure">Figure 148: Additional Authenticated Data, base64url-encoded</p>
<h1 id="rfc.section.4.10.3"><a href="#rfc.section.4.10.3">4.10.3.</a> <a href="#jwe-aad-keyenc" id="jwe-aad-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.10.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-aad-cek">Figure 146</a>) with the AES key (<a href="#jwe-aeskw-key">Figure 125</a>) produces the following encrypted key:</p>
<div id="rfc.figure.149"/>
<div id="jwe-aad-encdkey"/>
<pre>
4YiiQ_ZzH76TaIkJmYfRFgOV9MIpnx4X
</pre>
<p class="figure">Figure 149: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.10.4"><a href="#rfc.section.4.10.4">4.10.4.</a> <a href="#jwe-aad-contentenc" id="jwe-aad-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.10.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-aad-protected">Figure 150</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-aad-protected_b64u">Figure 151</a>.</li>
</ul>
<div id="rfc.figure.150"/>
<div id="jwe-aad-protected"/>
<pre>
{
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 150: Protected JWE Header JSON</p>
<div id="rfc.figure.151"/>
<div id="jwe-aad-protected_b64u"/>
<pre>
eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC
04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn0
</pre>
<p class="figure">Figure 151: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.10.4.p.3">Performing the content encryption operation over the Plaintext with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-aad-cek">Figure 146</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-aad-iv">Figure 147</a>); and</li>
<li>Concatenation of the protected JWE header (<a href="#jwe-aad-protected_b64u">Figure 151</a>), &#8220;.&#8221;, and the <a href="#RFC4648">[RFC4648]</a> base64url encoding of <a href="#jwe-aad-data">Figure 145</a> as authenticated data</li>
</ul>
<p id="rfc.section.4.10.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-aad-ciphertext">Figure 152</a>.</li>
<li>Authentication tag from <a href="#jwe-aad-tag">Figure 153</a>.</li>
</ul>
<div id="rfc.figure.152"/>
<div id="jwe-aad-ciphertext"/>
<pre>
Z_3cbr0k3bVM6N3oSNmHz7Lyf3iPppGf3Pj17wNZqteJ0Ui8p74SchQP8xygM1
oFRWCNzeIa6s6BcEtp8qEFiqTUEyiNkOWDNoF14T_4NFqF-p2Mx8zkbKxI7oPK
8KNarFbyxIDvICNqBLba-v3uzXBdB89fzOI-Lv4PjOFAQGHrgv1rjXAmKbgkft
9cB4WeyZw8MldbBhc-V_KWZslrsLNygon_JJWd_ek6LQn5NRehvApqf9ZrxB4a
q3FXBxOxCys35PhCdaggy2kfUfl2OkwKnWUbgXVD1C6HxLIlqHhCwXDG59weHr
RDQeHyMRoBljoV3X_bUTJDnKBFOod7nLz-cj48JMx3SnCZTpbQAkFV
</pre>
<p class="figure">Figure 152: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.153"/>
<div id="jwe-aad-tag"/>
<pre>
vOaH_Rajnpy_3hOtqvZHRA
</pre>
<p class="figure">Figure 153: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.10.5"><a href="#rfc.section.4.10.5">4.10.5.</a> <a href="#jwe-aad-output" id="jwe-aad-output">Output Results</a></h1>
<p id="rfc.section.4.10.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE header (<a href="#jwe-aad-protected_b64u">Figure 151</a>)</li>
<li>encrypted key (<a href="#jwe-aad-encdkey">Figure 149</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-aad-iv">Figure 147</a>)</li>
<li>Additional authenticated data (<a href="#jwe-aad-data_b64u">Figure 148</a>)</li>
<li>Ciphertext (<a href="#jwe-aad-ciphertext">Figure 152</a>)</li>
<li>Authentication tag (<a href="#jwe-aad-tag">Figure 153</a>)</li>
</ul>
<p id="rfc.section.4.10.5.p.3">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.154"/>
<div id="jwe-aad-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "4YiiQ_ZzH76TaIkJmYfRFgOV9MIpnx4X"
}
],
"protected": "eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04Mz
MyLTQzZDktYTQ2OC04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn
0",
"iv": "veCx9ece2orS7c_N",
"aad": "WyJ2Y2FyZCIsW1sidmVyc2lvbiIse30sInRleHQiLCI0LjAiXSxb
ImZuIix7fSwidGV4dCIsIk1lcmlhZG9jIEJyYW5keWJ1Y2siXSxbIm4i
LHt9LCJ0ZXh0IixbIkJyYW5keWJ1Y2siLCJNZXJpYWRvYyIsIk1yLiIs
IiJdXSxbImJkYXkiLHt9LCJ0ZXh0IiwiVEEgMjk4MiJdLFsiZ2VuZGVy
Iix7fSwidGV4dCIsIk0iXV1d",
"ciphertext": "Z_3cbr0k3bVM6N3oSNmHz7Lyf3iPppGf3Pj17wNZqteJ0
Ui8p74SchQP8xygM1oFRWCNzeIa6s6BcEtp8qEFiqTUEyiNkOWDNoF14
T_4NFqF-p2Mx8zkbKxI7oPK8KNarFbyxIDvICNqBLba-v3uzXBdB89fz
OI-Lv4PjOFAQGHrgv1rjXAmKbgkft9cB4WeyZw8MldbBhc-V_KWZslrs
LNygon_JJWd_ek6LQn5NRehvApqf9ZrxB4aq3FXBxOxCys35PhCdaggy
2kfUfl2OkwKnWUbgXVD1C6HxLIlqHhCwXDG59weHrRDQeHyMRoBljoV3
X_bUTJDnKBFOod7nLz-cj48JMx3SnCZTpbQAkFV",
"tag": "vOaH_Rajnpy_3hOtqvZHRA"
}
</pre>
<p class="figure">Figure 154: JSON Serialization</p>
<h1 id="rfc.section.4.11"><a href="#rfc.section.4.11">4.11.</a> <a href="#jwe-somefields" id="jwe-somefields">Protecting Specific Header Fields</a></h1>
<p id="rfc.section.4.11.p.1">This example illustrates encrypting content where only certain JWE header parameters are protected.  As this example includes unprotected JWE header parameters, only the JSON serialization is possible.</p>
<h1 id="rfc.section.4.11.1"><a href="#rfc.section.4.11.1">4.11.1.</a> <a href="#jwe-somefields-input" id="jwe-somefields-input">Input Factors</a></h1>
<p id="rfc.section.4.11.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>Recipient encryption key; this example uses the key from <a href="#jwe-aeskw-key">Figure 125</a>.</li>
<li>Key encryption algorithm; this example uses &#8220;A128KW&#8221;.</li>
<li>Content encryption algorithm; this example uses &#8220;A128GCM&#8221;.</li>
</ul>
<h1 id="rfc.section.4.11.2"><a href="#rfc.section.4.11.2">4.11.2.</a> <a href="#jwe-somefields-gen" id="jwe-somefields-gen">Generated Factors</a></h1>
<p id="rfc.section.4.11.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-somefields-cek">Figure 155</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-somefields-iv">Figure 156</a>.</li>
</ul>
<div id="rfc.figure.155"/>
<div id="jwe-somefields-cek"/>
<pre>
WDgEptBmQs9ouUvArz6x6g
</pre>
<p class="figure">Figure 155: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.156"/>
<div id="jwe-somefields-iv"/>
<pre>
WgEJsDS9bkoXQ3nR
</pre>
<p class="figure">Figure 156: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.11.3"><a href="#rfc.section.4.11.3">4.11.3.</a> <a href="#jwe-somefields-keyenc" id="jwe-somefields-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.11.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-somefields-cek">Figure 155</a>) with the AES key (<a href="#jwe-aeskw-key">Figure 125</a>) produces the following encrypted key:</p>
<div id="rfc.figure.157"/>
<div id="jwe-somefields-encdkey"/>
<pre>
jJIcM9J-hbx3wnqhf5FlkEYos0sHsF0H
</pre>
<p class="figure">Figure 157: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.11.4"><a href="#rfc.section.4.11.4">4.11.4.</a> <a href="#jwe-somefields-contentenc" id="jwe-somefields-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.11.4.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-somefields-protected">Figure 158</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-somefields-protected_b64u">Figure 159</a>.</li>
</ul>
<div id="rfc.figure.158"/>
<div id="jwe-somefields-protected"/>
<pre>
{
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 158: Protected JWE Header JSON</p>
<div id="rfc.figure.159"/>
<div id="jwe-somefields-protected_b64u"/>
<pre>
eyJlbmMiOiJBMTI4R0NNIn0
</pre>
<p class="figure">Figure 159: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.11.4.p.3">Performing the content encryption operation over the Plaintext with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-somefields-cek">Figure 155</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-somefields-iv">Figure 156</a>); and</li>
<li>Protected JWE header (<a href="#jwe-somefields-protected_b64u">Figure 159</a>) as authenticated data</li>
</ul>
<p id="rfc.section.4.11.4.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-somefields-ciphertext">Figure 160</a>.</li>
<li>Authentication tag from <a href="#jwe-somefields-tag">Figure 161</a>.</li>
</ul>
<div id="rfc.figure.160"/>
<div id="jwe-somefields-ciphertext"/>
<pre>
lIbCyRmRJxnB2yLQOTqjCDKV3H30ossOw3uD9DPsqLL2DM3swKkjOwQyZtWsFL
YMj5YeLht_StAn21tHmQJuuNt64T8D4t6C7kC9OCCJ1IHAolUv4MyOt80MoPb8
fZYbNKqplzYJgIL58g8N2v46OgyG637d6uuKPwhAnTGm_zWhqc_srOvgiLkzyF
XPq1hBAURbc3-8BqeRb48iR1-_5g5UjWVD3lgiLCN_P7AW8mIiFvUNXBPJK3nO
WL4teUPS8yHLbWeL83olU4UAgL48x-8dDkH23JykibVSQju-f7e-1xreHWXzWL
Hs1NqBbre0dEwK3HX_xM0LjUz77Krppgegoutpf5qaKg3l-_xMINmf
</pre>
<p class="figure">Figure 160: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.161"/>
<div id="jwe-somefields-tag"/>
<pre>
fNYLqpUe84KD45lvDiaBAQ
</pre>
<p class="figure">Figure 161: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.11.5"><a href="#rfc.section.4.11.5">4.11.5.</a> <a href="#jwe-somefields-output" id="jwe-somefields-output">Output Results</a></h1>
<p id="rfc.section.4.11.5.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Unprotected JWE header (<a href="#jwe-somefields-unprotected">Figure 162</a>)</li>
<li>Protected JWE header (<a href="#jwe-somefields-protected_b64u">Figure 159</a>)</li>
<li>encrypted key (<a href="#jwe-somefields-encdkey">Figure 157</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-somefields-iv">Figure 156</a>)</li>
<li>Ciphertext (<a href="#jwe-somefields-ciphertext">Figure 160</a>)</li>
<li>Authentication tag (<a href="#jwe-somefields-tag">Figure 161</a>)</li>
</ul>
<p id="rfc.section.4.11.5.p.3">The following unprotected JWE header is generated before assembling the output results:</p>
<div id="rfc.figure.162"/>
<div id="jwe-somefields-unprotected"/>
<pre>
{
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8"
}
</pre>
<p class="figure">Figure 162: Unprotected JWE Header JSON</p>
<p id="rfc.section.4.11.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.163"/>
<div id="jwe-somefields-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "jJIcM9J-hbx3wnqhf5FlkEYos0sHsF0H"
}
],
"unprotected": {
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8"
},
"protected": "eyJlbmMiOiJBMTI4R0NNIn0",
"iv": "WgEJsDS9bkoXQ3nR",
"ciphertext": "lIbCyRmRJxnB2yLQOTqjCDKV3H30ossOw3uD9DPsqLL2D
M3swKkjOwQyZtWsFLYMj5YeLht_StAn21tHmQJuuNt64T8D4t6C7kC9O
CCJ1IHAolUv4MyOt80MoPb8fZYbNKqplzYJgIL58g8N2v46OgyG637d6
uuKPwhAnTGm_zWhqc_srOvgiLkzyFXPq1hBAURbc3-8BqeRb48iR1-_5
g5UjWVD3lgiLCN_P7AW8mIiFvUNXBPJK3nOWL4teUPS8yHLbWeL83olU
4UAgL48x-8dDkH23JykibVSQju-f7e-1xreHWXzWLHs1NqBbre0dEwK3
HX_xM0LjUz77Krppgegoutpf5qaKg3l-_xMINmf",
"tag": "fNYLqpUe84KD45lvDiaBAQ"
}
</pre>
<p class="figure">Figure 163: JSON Serialization</p>
<h1 id="rfc.section.4.12"><a href="#rfc.section.4.12">4.12.</a> <a href="#jwe-nofields" id="jwe-nofields">Protecting Content Only</a></h1>
<p id="rfc.section.4.12.p.1">This example illustrates encrypting content where none of the JWE header parameters are protected.  As this example includes only unprotected JWE header parameters, only the JSON serialization is possible.</p>
<h1 id="rfc.section.4.12.1"><a href="#rfc.section.4.12.1">4.12.1.</a> <a href="#jwe-nofields-input" id="jwe-nofields-input">Input Factors</a></h1>
<p id="rfc.section.4.12.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>Recipient encryption key; this example uses the key from <a href="#jwe-aeskw-key">Figure 125</a>.</li>
<li>Key encryption algorithm; this example uses &#8220;A128KW&#8221;.</li>
<li>Content encryption algorithm; this example uses &#8220;A128GCM&#8221;.</li>
</ul>
<h1 id="rfc.section.4.12.2"><a href="#rfc.section.4.12.2">4.12.2.</a> <a href="#jwe-nofields-gen" id="jwe-nofields-gen">Generated Factors</a></h1>
<p id="rfc.section.4.12.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key; this example the key from <a href="#jwe-nofields-cek">Figure 164</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-nofields-iv">Figure 165</a>.</li>
</ul>
<div id="rfc.figure.164"/>
<div id="jwe-nofields-cek"/>
<pre>
KBooAFl30QPV3vkcZlXnzQ
</pre>
<p class="figure">Figure 164: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.165"/>
<div id="jwe-nofields-iv"/>
<pre>
YihBoVOGsR1l7jCD
</pre>
<p class="figure">Figure 165: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.12.3"><a href="#rfc.section.4.12.3">4.12.3.</a> <a href="#jwe-nofields-keyenc" id="jwe-nofields-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.4.12.3.p.1">Performing the key encryption operation over the CEK (<a href="#jwe-nofields-cek">Figure 164</a> with the AES key (<a href="#jwe-aeskw-key">Figure 125</a> produces the following encrypted key:</p>
<div id="rfc.figure.166"/>
<div id="jwe-nofields-encdkey"/>
<pre>
244YHfO_W7RMpQW81UjQrZcq5LSyqiPv
</pre>
<p class="figure">Figure 166: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.4.12.4"><a href="#rfc.section.4.12.4">4.12.4.</a> <a href="#jwe-nofields-contentenc" id="jwe-nofields-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.12.4.p.1">Performing the content encryption operation over the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) using the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-nofields-cek">Figure 164</a>);</li>
<li>Initialization vector/nonce (<a href="#jwe-nofields-iv">Figure 165</a>); and</li>
<li>Empty string as authenticated data</li>
</ul>
<p id="rfc.section.4.12.4.p.3">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-nofields-ciphertext">Figure 167</a>.</li>
<li>Authenticated data from <a href="#jwe-nofields-tag">Figure 168</a>.</li>
</ul>
<div id="rfc.figure.167"/>
<div id="jwe-nofields-ciphertext"/>
<pre>
qtPIMMaOBRgASL10dNQhOa7Gqrk7Eal1vwht7R4TT1uq-arsVCPaIeFwQfzrSS
6oEUWbBtxEasE0vC6r7sphyVziMCVJEuRJyoAHFSP3eqQPb4Ic1SDSqyXjw_L3
svybhHYUGyQuTmUQEDjgjJfBOifwHIsDsRPeBz1NomqeifVPq5GTCWFo5k_MNI
QURR2Wj0AHC2k7JZfu2iWjUHLF8ExFZLZ4nlmsvJu_mvifMYiikfNfsZAudISO
a6O73yPZtL04k_1FI7WDfrb2w7OqKLWDXzlpcxohPVOLQwpA3mFNRKdY-bQz4Z
4KX9lfz1cne31N4-8BKmojpw-OdQjKdLOGkC445Fb_K1tlDQXw2sBF
</pre>
<p class="figure">Figure 167: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.168"/>
<div id="jwe-nofields-tag"/>
<pre>
e2m0Vm7JvjK2VpCKXS-kyg
</pre>
<p class="figure">Figure 168: Authentication Tag, base64url-encoded</p>
<h1 id="rfc.section.4.12.5"><a href="#rfc.section.4.12.5">4.12.5.</a> <a href="#jwe-nofields-output" id="jwe-nofields-output">Output Results</a></h1>
<p id="rfc.section.4.12.5.p.1">The following unprotected JWE header is generated before assembling the output results:</p>
<div id="rfc.figure.169"/>
<div id="jwe-nofields-unprotected"/>
<pre>
{
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 169: Unprotected JWE Header JSON</p>
<p id="rfc.section.4.12.5.p.2">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Unprotected JWE header (<a href="#jwe-nofields-unprotected">Figure 169</a>)</li>
<li>encrypted key (<a href="#jwe-nofields-encdkey">Figure 166</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-nofields-iv">Figure 165</a>)</li>
<li>Ciphertext (<a href="#jwe-nofields-ciphertext">Figure 167</a>)</li>
<li>Authentication tag (<a href="#jwe-nofields-tag">Figure 168</a>)</li>
</ul>
<p id="rfc.section.4.12.5.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.170"/>
<div id="jwe-nofields-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "244YHfO_W7RMpQW81UjQrZcq5LSyqiPv"
}
],
"unprotected": {
"alg": "A128KW",
"kid": "81b20965-8332-43d9-a468-82160ad91ac8",
"enc": "A128GCM"
},
"iv": "YihBoVOGsR1l7jCD",
"ciphertext": "qtPIMMaOBRgASL10dNQhOa7Gqrk7Eal1vwht7R4TT1uq-
arsVCPaIeFwQfzrSS6oEUWbBtxEasE0vC6r7sphyVziMCVJEuRJyoAHF
SP3eqQPb4Ic1SDSqyXjw_L3svybhHYUGyQuTmUQEDjgjJfBOifwHIsDs
RPeBz1NomqeifVPq5GTCWFo5k_MNIQURR2Wj0AHC2k7JZfu2iWjUHLF8
ExFZLZ4nlmsvJu_mvifMYiikfNfsZAudISOa6O73yPZtL04k_1FI7WDf
rb2w7OqKLWDXzlpcxohPVOLQwpA3mFNRKdY-bQz4Z4KX9lfz1cne31N4
-8BKmojpw-OdQjKdLOGkC445Fb_K1tlDQXw2sBF",
"tag": "e2m0Vm7JvjK2VpCKXS-kyg"
}
</pre>
<p class="figure">Figure 170: JSON Serialization</p>
<h1 id="rfc.section.4.13"><a href="#rfc.section.4.13">4.13.</a> <a href="#jwe-multi" id="jwe-multi">Encrypting to Multiple Recipients</a></h1>
<p id="rfc.section.4.13.p.1">This example illustrates encryption content for multiple recipients. As this example has multiple recipients, only the JSON serialization is possible.</p>
<h1 id="rfc.section.4.13.1"><a href="#rfc.section.4.13.1">4.13.1.</a> <a href="#jwe-multi-input" id="jwe-multi-input">Input Factors</a></h1>
<p id="rfc.section.4.13.1.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the plaintext from <a href="#jwe-plaintext">Figure 51</a>.</li>
<li>Recipient keys; this example uses the following:  <ul><li>The RSA public key from <a href="#jwe-rsa15-key">Figure 52</a> for the first recipient.</li><li>The EC public key from <a href="#jwe-ecdh_aeskw-key">Figure 84</a> for the second recipient.</li><li>The AES symmetric key from <a href="#jwe-aesgcmkw-key">Figure 113</a> for the third recipient.</li></ul></li>
<li>Key encryption algorithms; this example uses the following:  <ul><li>&#8220;RSA1_5&#8221; for the first recipient.</li><li>&#8220;ECDH-ES+A256KW&#8221; for the second recipient.</li><li>&#8220;A256GCMKW&#8221; for the third recipient.</li></ul></li>
<li>Content encryption algorithm; this example uses &#8220;A128CBC-HS256&#8221;</li>
</ul>
<h1 id="rfc.section.4.13.2"><a href="#rfc.section.4.13.2">4.13.2.</a> <a href="#jwe-multi-gen" id="jwe-multi-gen">Generated Factors</a></h1>
<p id="rfc.section.4.13.2.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption Key (CEK); this example uses the key from <a href="#jwe-multi-cek">Figure 171</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jwe-multi-iv">Figure 172</a>.</li>
</ul>
<div id="rfc.figure.171"/>
<div id="jwe-multi-cek"/>
<pre>
zXayeJ4gvm8NJr3IUInyokTUO-LbQNKEhe_zWlYbdpQ
</pre>
<p class="figure">Figure 171: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.172"/>
<div id="jwe-multi-iv"/>
<pre>
VgEIHY20EnzUtZFl2RpB1g
</pre>
<p class="figure">Figure 172: Initialization Vector, base64url-encoded</p>
<h1 id="rfc.section.4.13.3"><a href="#rfc.section.4.13.3">4.13.3.</a> <a href="#jwe-multi-keyenc_1" id="jwe-multi-keyenc_1">Encrypting the Key to the First Recipient</a></h1>
<p id="rfc.section.4.13.3.p.1">Performing the &#8220;RSA1_5&#8221; key encryption operation over the CEK (<a href="#jwe-multi-cek">Figure 171</a> with the first recipient&#8217;s RSA key (<a href="#jwe-rsa15-key">Figure 52</a> produces the following encrypted key:</p>
<div id="rfc.figure.173"/>
<div id="jwe-multi-encdkey_1"/>
<pre>
dYOD28kab0Vvf4ODgxVAJXgHcSZICSOp8M51zjwj4w6Y5G4XJQsNNIBiqyvUUA
OcpL7S7-cFe7Pio7gV_Q06WmCSa-vhW6me4bWrBf7cHwEQJdXihidAYWVajJIa
KMXMvFRMV6iDlRr076DFthg2_AV0_tSiV6xSEIFqt1xnYPpmP91tc5WJDOGb-w
qjw0-b-S1laS11QVbuP78dQ7Fa0zAVzzjHX-xvyM2wxj_otxr9clN1LnZMbeYS
rRicJK5xodvWgkpIdkMHo4LvdhRRvzoKzlic89jFWPlnBq_V4n5trGuExtp_-d
bHcGlihqc_wGgho9fLMK8JOArYLcMDNQ
</pre>
<p class="figure">Figure 173: Recipient #1 Encrypted Key, base64url-encoded</p>
<p id="rfc.section.4.13.3.p.2">The following are generated after encrypting the CEK for the first recipient:</p>
<p/>

<ul>
<li>Recipient JWE header from <a href="#jwe-multi-rcpt_header_1">Figure 174</a></li>
</ul>
<div id="rfc.figure.174"/>
<div id="jwe-multi-rcpt_header_1"/>
<pre>
{
"alg": "RSA1_5",
"kid": "frodo.baggins@hobbiton.example"
}
</pre>
<p class="figure">Figure 174: Recipient #1 JWE Header JSON</p>
<p id="rfc.section.4.13.3.p.4">The following is the assembled first recipient JSON:</p>
<div id="rfc.figure.175"/>
<div id="jwe-multi-rcpt_1"/>
<pre>
{
"encrypted_key": "dYOD28kab0Vvf4ODgxVAJXgHcSZICSOp8M51zjwj4w
6Y5G4XJQsNNIBiqyvUUAOcpL7S7-cFe7Pio7gV_Q06WmCSa-vhW6me4b
WrBf7cHwEQJdXihidAYWVajJIaKMXMvFRMV6iDlRr076DFthg2_AV0_t
SiV6xSEIFqt1xnYPpmP91tc5WJDOGb-wqjw0-b-S1laS11QVbuP78dQ7
Fa0zAVzzjHX-xvyM2wxj_otxr9clN1LnZMbeYSrRicJK5xodvWgkpIdk
MHo4LvdhRRvzoKzlic89jFWPlnBq_V4n5trGuExtp_-dbHcGlihqc_wG
gho9fLMK8JOArYLcMDNQ",
"header": {
"alg": "RSA1_5",
"kid": "frodo.baggins@hobbiton.example"
}
}
</pre>
<p class="figure">Figure 175: Recipient #1 JSON</p>
<h1 id="rfc.section.4.13.4"><a href="#rfc.section.4.13.4">4.13.4.</a> <a href="#jwe-multi-keyenc_2" id="jwe-multi-keyenc_2">Encrypting the Key to the Second Recipient</a></h1>
<p id="rfc.section.4.13.4.p.1">The following are generated before encrypting the CEK for the second recipient:</p>
<p/>

<ul>
<li>Ephemeral EC private key on the same curve as the EC public key; this example uses the private key from <a href="#jwe-multi-epk_2">Figure 176</a>.</li>
</ul>
<div id="rfc.figure.176"/>
<div id="jwe-multi-epk_2"/>
<pre>
{
"kty": "EC",
"crv": "P-384",
"x": "Uzdvk3pi5wKCRc1izp5_r0OjeqT-I68i8g2b8mva8diRhsE2xAn2Dt
MRb25Ma2CX",
"y": "VDrRyFJh-Kwd1EjAgmj5Eo-CTHAZ53MC7PjjpLioy3ylEjI1pOMbw9
1fzZ84pbfm",
"d": "1DKHfTv-PiifVw2VBHM_ZiVcwOMxkOyANS_lQHJcrDxVY3jhVCvZPw
MxJKIE793C"
}
</pre>
<p class="figure">Figure 176: Ephemeral public key for Recipient #2, in JWK format</p>
<p id="rfc.section.4.13.4.p.3">Performing the &#8220;ECDH-ES+A256KW&#8221; key encryption operation over the CEK (<a href="#jwe-multi-cek">Figure 171</a> with the following:</p>
<p/>

<ul>
<li>Static Elliptic Curve public key (<a href="#jwe-ecdh_aeskw-key">Figure 84</a>).</li>
<li>Ephemeral Elliptic Curve private key (<a href="#jwe-multi-epk_2">Figure 176</a>.</li>
</ul>
<p id="rfc.section.4.13.4.p.5">produces the following encrypted key:</p>
<div id="rfc.figure.177"/>
<div id="jwe-multi-encdkey_2"/>
<pre>
ExInT0io9BqBMYF6-maw5tZlgoZXThD1zWKsHixJuw_elY4gSSId_w
</pre>
<p class="figure">Figure 177: Recipient #2 Encrypted Key, base64url-encoded</p>
<p id="rfc.section.4.13.4.p.6">The following are generated after encrypting the CEK for the second recipient:</p>
<p/>

<ul>
<li>Recipient JWE Header from <a href="#jwe-multi-rcpt_header_2">Figure 178</a>.</li>
</ul>
<div id="rfc.figure.178"/>
<div id="jwe-multi-rcpt_header_2"/>
<pre>
{
"alg": "ECDH-ES+A256KW",
"kid": "peregrin.took@tuckborough.example",
"epk": {
"kty": "EC",
"crv": "P-384",
"x": "Uzdvk3pi5wKCRc1izp5_r0OjeqT-I68i8g2b8mva8diRhsE2xAn2
DtMRb25Ma2CX",
"y": "VDrRyFJh-Kwd1EjAgmj5Eo-CTHAZ53MC7PjjpLioy3ylEjI1pOMb
w91fzZ84pbfm"
}
}
</pre>
<p class="figure">Figure 178: Recipient #2 JWE Header JSON</p>
<p id="rfc.section.4.13.4.p.8">The following is the assembled second recipient JSON:</p>
<div id="rfc.figure.179"/>
<div id="jwe-multi-rcpt_2"/>
<pre>
{
"encrypted_key": "ExInT0io9BqBMYF6-maw5tZlgoZXThD1zWKsHixJuw
_elY4gSSId_w",
"header": {
"alg": "ECDH-ES+A256KW",
"kid": "peregrin.took@tuckborough.example",
"epk": {
"kty": "EC",
"crv": "P-384",
"x": "Uzdvk3pi5wKCRc1izp5_r0OjeqT-I68i8g2b8mva8diRhsE2xA
n2DtMRb25Ma2CX",
"y": "VDrRyFJh-Kwd1EjAgmj5Eo-CTHAZ53MC7PjjpLioy3ylEjI1pO
Mbw91fzZ84pbfm"
}
}
}
</pre>
<p class="figure">Figure 179: Recipient #2 JSON</p>
<h1 id="rfc.section.4.13.5"><a href="#rfc.section.4.13.5">4.13.5.</a> <a href="#jwe-multi-keyenc_3" id="jwe-multi-keyenc_3">Encrypting the Key to the Third Recipient</a></h1>
<p id="rfc.section.4.13.5.p.1">The following are generated before encrypting the CEK for the third recipient:</p>
<p/>

<ul>
<li>Initialization vector/nonce for key wrapping; this example uses the initialization vector/nonce from <a href="#jwe-multi-kwiv_3">Figure 180</a></li>
</ul>
<div id="rfc.figure.180"/>
<div id="jwe-multi-kwiv_3"/>
<pre>
AvpeoPZ9Ncn9mkBn
</pre>
<p class="figure">Figure 180</p>
<p id="rfc.section.4.13.5.p.3">Performing the &#8220;A256GCMKW&#8221; key encryption operation over the CEK (<a href="#jwe-multi-cek">Figure 171</a>) with the following:</p>
<p/>

<ul>
<li>AES symmetric key (<a href="#jwe-aesgcmkw-key">Figure 113</a>; and</li>
<li>Initialization vector/nonce ((<a href="#jwe-multi-kwiv_3">Figure 180</a></li>
</ul>
<p id="rfc.section.4.13.5.p.5">produces the following:</p>
<p/>

<ul>
<li>Encrypted key from <a href="#jwe-multi-encdkey_3">Figure 181</a>.</li>
<li>Key wrap authentication tag from <a href="#jwe-multi-kwtag_3">Figure 182</a></li>
</ul>
<div id="rfc.figure.181"/>
<div id="jwe-multi-encdkey_3"/>
<pre>
a7CclAejo_7JSuPB8zeagxXRam8dwCfmkt9-WyTpS1E
</pre>
<p class="figure">Figure 181: Recipient #3 Encrypted Key, base64url-encoded</p>
<div id="rfc.figure.182"/>
<div id="jwe-multi-kwtag_3"/>
<pre>
59Nqh1LlYtVIhfD3pgRGvw
</pre>
<p class="figure">Figure 182: Recipient #3 Authentication Tag, base64url-encoded</p>
<p id="rfc.section.4.13.5.p.7">The following are generated after encrypting the CEK for the third recipient:</p>
<p/>

<ul>
<li>Recipient JWE header; this example uses the header from <a href="#jwe-multi-rcpt_header_3">Figure 183</a>.</li>
</ul>
<div id="rfc.figure.183"/>
<div id="jwe-multi-rcpt_header_3"/>
<pre>
{
"alg": "A256GCMKW",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"tag": "59Nqh1LlYtVIhfD3pgRGvw",
"iv": "AvpeoPZ9Ncn9mkBn"
}
</pre>
<p class="figure">Figure 183: Recipient #3 JWE Header JSON</p>
<p id="rfc.section.4.13.5.p.9">The following is the assembled third recipient JSON:</p>
<div id="rfc.figure.184"/>
<div id="jwe-multi-rcpt_3"/>
<pre>
{
"encrypted_key": "a7CclAejo_7JSuPB8zeagxXRam8dwCfmkt9-WyTpS1
E",
"header": {
"alg": "A256GCMKW",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"tag": "59Nqh1LlYtVIhfD3pgRGvw",
"iv": "AvpeoPZ9Ncn9mkBn"
}
}
</pre>
<p class="figure">Figure 184: Recipient #3 JSON</p>
<h1 id="rfc.section.4.13.6"><a href="#rfc.section.4.13.6">4.13.6.</a> <a href="#jwe-multi-contentenc" id="jwe-multi-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.4.13.6.p.1">The following are generated before encrypting the content:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the header from <a href="#jwe-multi-protected">Figure 185</a>, encoded to <a href="#RFC4648">[RFC4648]</a> base64url as <a href="#jwe-multi-protected_b64u">Figure 186</a>.</li>
</ul>
<div id="rfc.figure.185"/>
<div id="jwe-multi-protected"/>
<pre>
{
"enc": "A128CBC-HS256"
}
</pre>
<p class="figure">Figure 185: Protected JWE Header JSON</p>
<div id="rfc.figure.186"/>
<div id="jwe-multi-protected_b64u"/>
<pre>
eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0
</pre>
<p class="figure">Figure 186: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.4.13.6.p.3">Performing the content encryption operation over the Plaintext (<a href="#jwe-plaintext">Figure 51</a>) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jwe-multi-cek">Figure 171</a>),</li>
<li>Initialization vector/nonce (<a href="#jwe-multi-iv">Figure 172</a>), and</li>
<li>Protected JWE header (<a href="#jwe-multi-protected_b64u">Figure 186</a>) as the authenticated data</li>
</ul>
<p id="rfc.section.4.13.6.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jwe-multi-ciphertext">Figure 187</a></li>
<li>Authentication tag from <a href="#jwe-multi-tag">Figure 188</a></li>
</ul>
<div id="rfc.figure.187"/>
<div id="jwe-multi-ciphertext"/>
<pre>
ajm2Q-OpPXCr7-MHXicknb1lsxLdXxK_yLds0KuhJzfWK04SjdxQeSw2L9mu3a
_k1C55kCQ_3xlkcVKC5yr__Is48VOoK0k63_QRM9tBURMFqLByJ8vOYQX0oJW4
VUHJLmGhF-tVQWB7Kz8mr8zeE7txF0MSaP6ga7-siYxStR7_G07Thd1jh-zGT0
wxM5g-VRORtq0K6AXpLlwEqRp7pkt2zRM0ZAXqSpe1O6FJ7FHLDyEFnD-zDIZu
kLpCbzhzMDLLw2-8I14FQrgi-iEuzHgIJFIJn2wh9Tj0cg_kOZy9BqMRZbmYXM
Y9YQjorZ_P_JYG3ARAIF3OjDNqpdYe-K_5Q5crGJSDNyij_ygEiItR5jssQVH2
ofDQdLChtazE
</pre>
<p class="figure">Figure 187: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.188"/>
<div id="jwe-multi-tag"/>
<pre>
BESYyFN7T09KY7i8zKs5_g
</pre>
<p class="figure">Figure 188: Authentication Tag, base64url-encoded</p>
<p id="rfc.section.4.13.6.p.7">The following is generated after encrypting the plaintext:</p>
<p/>

<ul>
<li>Unprotected JWE header parameters; this example uses the header from <a href="#jwe-multi-unprotected">Figure 189</a>.</li>
</ul>
<div id="rfc.figure.189"/>
<div id="jwe-multi-unprotected"/>
<pre>
{
"cty": "text/plain"
}
</pre>
<p class="figure">Figure 189: Unprotected JWE Header JSON</p>
<h1 id="rfc.section.4.13.7"><a href="#rfc.section.4.13.7">4.13.7.</a> <a href="#jwe-multi-output" id="jwe-multi-output">Output Results</a></h1>
<p id="rfc.section.4.13.7.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Recipient #1 JSON (<a href="#jwe-multi-rcpt_1">Figure 175</a>)</li>
<li>Recipient #2 JSON (<a href="#jwe-multi-rcpt_2">Figure 179</a>)</li>
<li>Recipient #3 JSON (<a href="#jwe-multi-rcpt_3">Figure 184</a>)</li>
<li>Initialization vector/nonce (<a href="#jwe-multi-iv">Figure 172</a>)</li>
<li>Ciphertext (<a href="#jwe-multi-ciphertext">Figure 187</a>)</li>
<li>Authentication tag (<a href="#jwe-multi-tag">Figure 188</a>)</li>
</ul>
<p id="rfc.section.4.13.7.p.3">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.190"/>
<div id="jwe-multi-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "dYOD28kab0Vvf4ODgxVAJXgHcSZICSOp8M51zj
wj4w6Y5G4XJQsNNIBiqyvUUAOcpL7S7-cFe7Pio7gV_Q06WmCSa-
vhW6me4bWrBf7cHwEQJdXihidAYWVajJIaKMXMvFRMV6iDlRr076
DFthg2_AV0_tSiV6xSEIFqt1xnYPpmP91tc5WJDOGb-wqjw0-b-S
1laS11QVbuP78dQ7Fa0zAVzzjHX-xvyM2wxj_otxr9clN1LnZMbe
YSrRicJK5xodvWgkpIdkMHo4LvdhRRvzoKzlic89jFWPlnBq_V4n
5trGuExtp_-dbHcGlihqc_wGgho9fLMK8JOArYLcMDNQ",
"header": {
"alg": "RSA1_5",
"kid": "frodo.baggins@hobbiton.example"
}
},
{
"encrypted_key": "ExInT0io9BqBMYF6-maw5tZlgoZXThD1zWKsHi
xJuw_elY4gSSId_w",
"header": {
"alg": "ECDH-ES+A256KW",
"kid": "peregrin.took@tuckborough.example",
"epk": {
"kty": "EC",
"crv": "P-384",
"x": "Uzdvk3pi5wKCRc1izp5_r0OjeqT-I68i8g2b8mva8diRhs
E2xAn2DtMRb25Ma2CX",
"y": "VDrRyFJh-Kwd1EjAgmj5Eo-CTHAZ53MC7PjjpLioy3ylEj
I1pOMbw91fzZ84pbfm"
}
}
},
{
"encrypted_key": "a7CclAejo_7JSuPB8zeagxXRam8dwCfmkt9-Wy
TpS1E",
"header": {
"alg": "A256GCMKW",
"kid": "18ec08e1-bfa9-4d95-b205-2b4dd1d4321d",
"tag": "59Nqh1LlYtVIhfD3pgRGvw",
"iv": "AvpeoPZ9Ncn9mkBn"
}
}
],
"unprotected": {
"cty": "text/plain"
},
"protected": "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0",
"iv": "VgEIHY20EnzUtZFl2RpB1g",
"ciphertext": "ajm2Q-OpPXCr7-MHXicknb1lsxLdXxK_yLds0KuhJzfWK
04SjdxQeSw2L9mu3a_k1C55kCQ_3xlkcVKC5yr__Is48VOoK0k63_QRM
9tBURMFqLByJ8vOYQX0oJW4VUHJLmGhF-tVQWB7Kz8mr8zeE7txF0MSa
P6ga7-siYxStR7_G07Thd1jh-zGT0wxM5g-VRORtq0K6AXpLlwEqRp7p
kt2zRM0ZAXqSpe1O6FJ7FHLDyEFnD-zDIZukLpCbzhzMDLLw2-8I14FQ
rgi-iEuzHgIJFIJn2wh9Tj0cg_kOZy9BqMRZbmYXMY9YQjorZ_P_JYG3
ARAIF3OjDNqpdYe-K_5Q5crGJSDNyij_ygEiItR5jssQVH2ofDQdLCht
azE",
"tag": "BESYyFN7T09KY7i8zKs5_g"
}
</pre>
<p class="figure">Figure 190: JSON Serialization</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#jw-nested" id="jw-nested">Nesting Signatures and Encryption</a></h1>
<p id="rfc.section.5.p.1">This example illustrates nesting a JSON Web Signature (JWS) structure within a JSON Web Encryption (JWE) structure.  The signature uses the &#8220;PS256&#8221; (RSASSA-PSS) algorithm; the encryption uses the &#8220;RSA-OAEP&#8221; (RSAES-OAEP) key encryption algorithm and the &#8220;A128GCM&#8221; (AES-GCM) content encryption algorithm.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#jw-nested-sig-input" id="jw-nested-sig-input">Signing Input Factors</a></h1>
<p id="rfc.section.5.1.p.1">The following are supplied before beginning the signing operation:</p>
<p/>

<ul>
<li>Payload content; this example uses the JSON Web Token (JWT) <a href="#I-D.ietf-oauth-json-web-token">[I-D.ietf-oauth-json-web-token]</a> content from <a href="#jw-nested-sig-payload">Figure 191</a>, encoded as <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jw-nested-sig-payload_b64u">Figure 192</a>.</li>
<li>RSA private key; this example uses the key from <a href="#jw-nested-sig-rsa">Figure 193</a></li>
</ul>
<div id="rfc.figure.191"/>
<div id="jw-nested-sig-payload"/>
<pre>
{
"iss": "hobbiton.example",
"exp": 1300819380,
"http://example.com/is_root": true
}
</pre>
<p class="figure">Figure 191: Payload content, in JSON format</p>
<div id="rfc.figure.192"/>
<div id="jw-nested-sig-payload_b64u"/>
<pre>
eyJpc3MiOiJob2JiaXRvbi5leGFtcGxlIiwiZXhwIjoxMzAwODE5MzgwLCJodH
RwOi8vZXhhbXBsZS5jb20vaXNfcm9vdCI6dHJ1ZX0
</pre>
<p class="figure">Figure 192: Payload content, base64url-encoded</p>
<div id="rfc.figure.193"/>
<div id="jw-nested-sig-rsa"/>
<pre>
{
"kty": "RSA",
"kid": "hobbiton.example",
"use": "sig",
"n": "kNrPIBDXMU6fcyv5i-QHQAQ-K8gsC3HJb7FYhYaw8hXbNJa-t8q0lD
KwLZgQXYV-ffWxXJv5GGrlZE4GU52lfMEegTDzYTrRQ3tepgKFjMGg6I
y6fkl1ZNsx2gEonsnlShfzA9GJwRTmtKPbk1s-hwx1IU5AT-AIelNqBg
cF2vE5W25_SGGBoaROVdUYxqETDggM1z5cKV4ZjDZ8-lh4oVB07bkac6
LQdHpJUUySH_Er20DXx30Kyi97PciXKTS-QKXnmm8ivyRCmux22ZoPUi
nd2BKC5OiG4MwALhaL2Z2k8CsRdfy-7dg7z41Rp6D0ZeEvtaUp4bX4aK
raL4rTfw",
"e": "AQAB",
"d": "ZLe_TIxpE9-W_n2VBa-HWvuYPtjvxwVXClJFOpJsdea8g9RMx34qEO
EtnoYc2un3CZ3LtJi-mju5RAT8YSc76YJds3ZVw0UiO8mMBeG6-iOnvg
obobNx7K57-xjTJZU72EjOr9kB7z6ZKwDDq7HFyCDhUEcYcHFVc7iL_6
TibVhAhOFONWlqlJgEgwVYd0rybNGKifdnpEbwyHoMwY6HM1qvnEFgP7
iZ0YzHUT535x6jj4VKcdA7ZduFkhUauysySEW7mxZM6fj1vdjJIy9LD1
fIz30Xv4ckoqhKF5GONU6tNmMmNgAD6gIViyEle1PrIxl1tBhCI14bRW
-zrpHgAQ",
"p": "yKWYoNIAqwMRQlgIBOdT1NIcbDNUUs2Rh-pBaxD_mIkweMt4Mg-0-B
2iSYvMrs8horhonV7vxCQagcBAATGW-hAafUehWjxWSH-3KccRM8toL4
e0q7M-idRDOBXSoe7Z2-CV2x_ZCY3RP8qp642R13WgXqGDIM4MbUkZSj
cY9-c",
"q": "uND4o15V30KDzf8vFJw589p1vlQVQ3NEilrinRUPHkkxaAzDzccGgr
WMWpGxGFFnNL3w5CqPLeU76-5IVYQq0HwYVl0hVXQHr7sgaGu-483Ad3
ENcL23FrOnF45m7_2ooAstJDe49MeLTTQKrSIBl_SKvqpYvfSPTczPcZ
kh9Kk",
"dp": "jmTnEoq2qqa8ouaymjhJSCnsveUXnMQC2gAneQJRQkFqQu-zV2PKP
KNbPvKVyiF5b2-L3tM3OW2d2iNDyRUWXlT7V5l0KwPTABSTOnTqAmYCh
Gi8kXXdlhcrtSvXldBakC6saxwI_TzGGY2MVXzc2ZnCvCXHV4qjSxOrf
P3pHFU",
"dq": "R9FUvU88OVzEkTkXl3-5-WusE4DjHmndeZIlu3rifBdfLpq_P-iWP
BbGaq9wzQ1c-J7SzCdJqkEJDv5yd2C7rnZ6kpzwBh_nmL8zscAk1qsun
nt9CJGAYz7-sGWy1JGShFazfP52ThB4rlCJ0YuEaQMrIzpY77_oLAhpm
DA0hLk",
"qi": "S8tC7ZknW6hPITkjcwttQOPLVmRfwirRlFAViuDb8NW9CrV_7F2Oq
UZCqmzHTYAumwGFHI1WVRep7anleWaJjxC_1b3fq_al4qH3Pe-EKiHg6
IMazuRtZLUROcThrExDbF5dYbsciDnfRUWLErZ4N1Be0bnxYuPqxwKd9
QZwMo0"
}
</pre>
<p class="figure">Figure 193: RSA 2048-bit Private Key, in JWK format</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#jw-nested-sig-op" id="jw-nested-sig-op">Signing Operation</a></h1>
<p id="rfc.section.5.2.p.1">The following are generated to complete the signing operation:</p>
<p/>

<ul>
<li>Protected JWS Header; this example uses header from <a href="#jw-nested-sig-protected">Figure 194</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jw-nested-sig-protected_b64u">Figure 195</a>.</li>
</ul>
<div id="rfc.figure.194"/>
<div id="jw-nested-sig-protected"/>
<pre>
{
"alg": "PS256",
"typ": "JWT"
}
</pre>
<p class="figure">Figure 194: Protected JWS Header JSON</p>
<div id="rfc.figure.195"/>
<div id="jw-nested-sig-protected_b64u"/>
<pre>
eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9
</pre>
<p class="figure">Figure 195: Protected JWS Header, base64url-encoded</p>
<p id="rfc.section.5.2.p.3">Performing the signature operation over the combined protected JWS header (<a href="#jw-nested-sig-protected_b64u">Figure 195</a>) and Payload content (<a href="#jw-nested-sig-payload">Figure 191</a>) produces the following signature:</p>
<div id="rfc.figure.196"/>
<div id="jw-nested-sig-sig"/>
<pre>
dPpMqwRZxFYi1UfcDAaf8M99o7kwUWtiXZ-ByvVuJih4MhJ_aZqciprz0OWaIA
kIvn1qskChirjKvY9ESZNUCP4JjvfyPS-nqjJxYoA5ztWOyFk2cZNIPXjcJXSQ
wXPO9tEe-v4VSqgD0aKHqPxYog4N6Cz1lKph1U1sYDSI67_bLL7elg_vkjfMp5
_W5l5LuUYGMeh6hxQIaIUXf9EwV2JmvTMuZ-vBOWy0Sniy1EFo72CRTvmtrIf5
AROo5MNliY3KtUxeP-SOmD-LEYwW9SlkohYzMVAZDDOrVbv7KVRHpeYNaK75KE
QqdCEEkS_rskZS-Qtt_nlegTWh1mEYaA
</pre>
<p class="figure">Figure 196: Signature, base64url-encoded</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#jw-nested-sig-output" id="jw-nested-sig-output">Signing Output</a></h1>
<p id="rfc.section.5.3.p.1">The following compose the resulting JWS object:</p>
<p/>

<ul>
<li>Protected JWS header (<a href="#jw-nested-sig-protected_b64u">Figure 195</a>))</li>
<li>Payload content (<a href="#jw-nested-sig-payload_b64u">Figure 192</a>)</li>
<li>Signature (<a href="#jw-nested-sig-sig">Figure 196</a>)</li>
</ul>
<p id="rfc.section.5.3.p.3">The resulting JWS object using the Compact Serialization (which is the plaintext input to the proceeding encryption operation):</p>
<div id="rfc.figure.197"/>
<div id="jw-nested-sig-compact"/>
<pre>
eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9
.
eyJpc3MiOiJob2JiaXRvbi5leGFtcGxlIiwiZXhwIjoxMzAwODE5MzgwLCJodH
RwOi8vZXhhbXBsZS5jb20vaXNfcm9vdCI6dHJ1ZX0
.
dPpMqwRZxFYi1UfcDAaf8M99o7kwUWtiXZ-ByvVuJih4MhJ_aZqciprz0OWaIA
kIvn1qskChirjKvY9ESZNUCP4JjvfyPS-nqjJxYoA5ztWOyFk2cZNIPXjcJXSQ
wXPO9tEe-v4VSqgD0aKHqPxYog4N6Cz1lKph1U1sYDSI67_bLL7elg_vkjfMp5
_W5l5LuUYGMeh6hxQIaIUXf9EwV2JmvTMuZ-vBOWy0Sniy1EFo72CRTvmtrIf5
AROo5MNliY3KtUxeP-SOmD-LEYwW9SlkohYzMVAZDDOrVbv7KVRHpeYNaK75KE
QqdCEEkS_rskZS-Qtt_nlegTWh1mEYaA
</pre>
<p class="figure">Figure 197: Compact Serialization</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#jw-nested-enc-input" id="jw-nested-enc-input">Encryption Input Factors</a></h1>
<p id="rfc.section.5.4.p.1">The following are supplied before beginning the encryption process:</p>
<p/>

<ul>
<li>Plaintext content; this example uses the content from <a href="#jw-nested-sig-compact">Figure 197</a>.</li>
<li>RSA public key; this example use the key from <a href="#jwe-rsa_oaep-key">Figure 62</a>.</li>
</ul>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#jw-nested-enc-gen" id="jw-nested-enc-gen">Encryption Generated Factors</a></h1>
<p id="rfc.section.5.5.p.1">The following are generated before encrypting:</p>
<p/>

<ul>
<li>AES symmetric key as the Content Encryption CEK (CEK); this example uses the key from <a href="#jw-nested-enc-cek">Figure 198</a>.</li>
<li>Initialization vector/nonce; this example uses the initialization vector/nonce from <a href="#jw-nested-enc-iv">Figure 199</a>.</li>
</ul>
<div id="rfc.figure.198"/>
<div id="jw-nested-enc-cek"/>
<pre>
0RHSNYwN-6-2QBGsYTZLSQ
</pre>
<p class="figure">Figure 198: Content Encryption Key, base64url-encoded</p>
<div id="rfc.figure.199"/>
<div id="jw-nested-enc-iv"/>
<pre>
GbX1i9kXz0sxXPmA
</pre>
<p class="figure">Figure 199: Initialization vector, base64url-encoded</p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#jw-nested-keyenc" id="jw-nested-keyenc">Encrypting the Key</a></h1>
<p id="rfc.section.5.6.p.1">Performing the key encryption operation over the CEK (<a href="#jw-nested-enc-cek">Figure 198</a>) with the RSA key (<a href="#jwe-rsa_oaep-key">Figure 62</a>) produces the following encrypted key:</p>
<div id="rfc.figure.200"/>
<div id="jw-nested-enc-encdkey"/>
<pre>
a0JHRoITfpX4qRewImjlStn8m3CPxBV1ueYlVhjurCyrBg3I7YhCRYjphDOOS4
E7rXbr2Fn6NyQq-A-gqT0FXqNjVOGrG-bi13mwy7RoYhjTkBEC6P7sMYMXXx4g
zMedpiJHQVeyI-zkZV7A9matpgevAJWrXzOUysYGTtwoSN6gtUVtlLaivjvb21
O0ul4YxSHV-ByK1kyeetRp_fuYJxHoKLQL9P424sKx2WGYb4zsBIPF4ssl_e5I
R7nany-25_UmC2urosNkoFz9cQ82MypZP8gqbQJyPN-Fpp4Z-5o6yV64x6yzDU
F_5JCIdl-Qv6H5dMVIY7q1eKpXcV1lWO_2FefEBqXxXvIjLeZivjNkzogCq3-I
apSjVFnMjBxjpYLT8muaawo1yy1XXMuinIpNcOY3n4KKrXLrCcteX85m4IIHMZ
a38s1Hpr56fPPseMA-Jltmt-a9iEDtOzhtxz8AXy9tsCAZV2XBWNG8c3kJusAa
mBKOYwfk7JhLRDgOnJjlJLhn7TI4UxDp9dCmUXEN6z0v23W15qJIEXNJtqnblp
ymooeWAHCT4e_Owbim1g0AEpTHUdA2iiLNs9WTX_H_TXuPC8yDDhi1smxS_X_x
pkIHkiIHWDOLx03BpqDTivpKkBYwqP2UZkcxqX2Fo_GnVrNwlK7Lgxw6FSQvDO
0
</pre>
<p class="figure">Figure 200: Encrypted Key, base64url-encoded</p>
<h1 id="rfc.section.5.7"><a href="#rfc.section.5.7">5.7.</a> <a href="#jw-nested-contentenc" id="jw-nested-contentenc">Encrypting the Content</a></h1>
<p id="rfc.section.5.7.p.1">The following are generated before encrypting the plaintext:</p>
<p/>

<ul>
<li>Protected JWE Header; this example uses the the header from <a href="#jw-nested-enc-protected">Figure 201</a>, encoded using <a href="#RFC4648">[RFC4648]</a> base64url to produce <a href="#jw-nested-enc-protected_b64u">Figure 202</a>.</li>
</ul>
<div id="rfc.figure.201"/>
<div id="jw-nested-enc-protected"/>
<pre>
{
"alg": "RSA-OAEP",
"cty": "JWT",
"enc": "A128GCM"
}
</pre>
<p class="figure">Figure 201: Protected JWE Header JSON</p>
<div id="rfc.figure.202"/>
<div id="jw-nested-enc-protected_b64u"/>
<pre>
eyJhbGciOiJSU0EtT0FFUCIsImN0eSI6IkpXVCIsImVuYyI6IkExMjhHQ00ifQ
</pre>
<p class="figure">Figure 202: Protected JWE Header, base64url-encoded</p>
<p id="rfc.section.5.7.p.3">Performing the content encryption operation over the Plaintext (<a href="#jw-nested-sig-compact">Figure 197</a>) with the following:</p>
<p/>

<ul>
<li>CEK (<a href="#jw-nested-enc-cek">Figure 198</a>);</li>
<li>Initialization vector/nonce (<a href="#jw-nested-enc-iv">Figure 199</a>); and</li>
<li>Protected JWE Header (<a href="#jw-nested-enc-protected_b64u">Figure 202</a>) as authenticated data.</li>
</ul>
<p id="rfc.section.5.7.p.5">produces the following:</p>
<p/>

<ul>
<li>Ciphertext from <a href="#jw-nested-enc-ciphertext">Figure 203</a>.</li>
<li>Authentication tag from <a href="#jw-nested-enc-tag">Figure 204</a>.</li>
</ul>
<div id="rfc.figure.203"/>
<div id="jw-nested-enc-ciphertext"/>
<pre>
SZI4IvKHmwpazl_pJQXX3mHv1ANnOU4Wf9-utWYUcKrBNgCe2OFMf66cSJ8k2Q
kxaQD3_R60MGE9ofomwtky3GFxMeGRjtpMt9OAvVLsAXB0_UTCBGyBg3C2bWLX
qZlfJAAoJRUPRk-BimYZY81zVBuIhc7HsQePCpu33SzMsFHjn4lP_idrJz_glZ
TNgKDt8zdnUPauKTKDNOH1DD4fuzvDYfDIAfqGPyL5sVRwbiXpXdGokEszM-9C
hMPqW1QNhzuX_Zul3bvrJwr7nuGZs4cUScY3n8yE3AHCLurgls-A9mz1X38xEa
ulV18l4Fg9tLejdkAuQZjPbqeHQBJe4IwGD5Ee0dQ-Mtz4NnhkIWx-YKBb_Xo2
zI3Q_1sYjKUuis7yWW-HTr_vqvFt0bj7WJf2vzB0TZ3dvsoGaTvPH2dyWwumUr
lx4gmPUzBdwTO6ubfYSDUEEz5py0d_OtWeUSYcCYBKD-aM7tXg26qJo21gYjLf
hn9zy-W19sOCZGuzgFjPhawXHpvnj_t-0_ES96kogjJLxS1IMU9Y5XmnwZMyNc
9EIwnogsCg-hVuvzyP0sIruktmI94_SL1xgMl7o03phcTMxtlMizR88NKU1WkB
siXMCjy1Noue7MD-ShDp5dmM
</pre>
<p class="figure">Figure 203: Ciphertext, base64url-encoded</p>
<div id="rfc.figure.204"/>
<div id="jw-nested-enc-tag"/>
<pre>
KnIKEhN8U-3C9s4gtSpjSw
</pre>
<p class="figure">Figure 204: Authentication tag, base64url-encoded</p>
<h1 id="rfc.section.5.8"><a href="#rfc.section.5.8">5.8.</a> <a href="#jw-nested-enc-output" id="jw-nested-enc-output">Encryption Output</a></h1>
<p id="rfc.section.5.8.p.1">The following compose the resulting JWE object:</p>
<p/>

<ul>
<li>Protected JWE Header (<a href="#jw-nested-enc-protected_b64u">Figure 202</a>)</li>
<li>Encrypted key (<a href="#jw-nested-enc-encdkey">Figure 200</a>)</li>
<li>Initialization vector/nonce (<a href="#jw-nested-enc-iv">Figure 199</a>)</li>
<li>Ciphertext (<a href="#jw-nested-enc-ciphertext">Figure 203</a>)</li>
<li>Authentication Tag (<a href="#jw-nested-enc-tag">Figure 204</a>)</li>
</ul>
<p id="rfc.section.5.8.p.3">The resulting JWE object using the Compact serialization:</p>
<div id="rfc.figure.205"/>
<div id="jw-nested-enc-compact"/>
<pre>
eyJhbGciOiJSU0EtT0FFUCIsImN0eSI6IkpXVCIsImVuYyI6IkExMjhHQ00ifQ
.
a0JHRoITfpX4qRewImjlStn8m3CPxBV1ueYlVhjurCyrBg3I7YhCRYjphDOOS4
E7rXbr2Fn6NyQq-A-gqT0FXqNjVOGrG-bi13mwy7RoYhjTkBEC6P7sMYMXXx4g
zMedpiJHQVeyI-zkZV7A9matpgevAJWrXzOUysYGTtwoSN6gtUVtlLaivjvb21
O0ul4YxSHV-ByK1kyeetRp_fuYJxHoKLQL9P424sKx2WGYb4zsBIPF4ssl_e5I
R7nany-25_UmC2urosNkoFz9cQ82MypZP8gqbQJyPN-Fpp4Z-5o6yV64x6yzDU
F_5JCIdl-Qv6H5dMVIY7q1eKpXcV1lWO_2FefEBqXxXvIjLeZivjNkzogCq3-I
apSjVFnMjBxjpYLT8muaawo1yy1XXMuinIpNcOY3n4KKrXLrCcteX85m4IIHMZ
a38s1Hpr56fPPseMA-Jltmt-a9iEDtOzhtxz8AXy9tsCAZV2XBWNG8c3kJusAa
mBKOYwfk7JhLRDgOnJjlJLhn7TI4UxDp9dCmUXEN6z0v23W15qJIEXNJtqnblp
ymooeWAHCT4e_Owbim1g0AEpTHUdA2iiLNs9WTX_H_TXuPC8yDDhi1smxS_X_x
pkIHkiIHWDOLx03BpqDTivpKkBYwqP2UZkcxqX2Fo_GnVrNwlK7Lgxw6FSQvDO
0
.
GbX1i9kXz0sxXPmA
.
SZI4IvKHmwpazl_pJQXX3mHv1ANnOU4Wf9-utWYUcKrBNgCe2OFMf66cSJ8k2Q
kxaQD3_R60MGE9ofomwtky3GFxMeGRjtpMt9OAvVLsAXB0_UTCBGyBg3C2bWLX
qZlfJAAoJRUPRk-BimYZY81zVBuIhc7HsQePCpu33SzMsFHjn4lP_idrJz_glZ
TNgKDt8zdnUPauKTKDNOH1DD4fuzvDYfDIAfqGPyL5sVRwbiXpXdGokEszM-9C
hMPqW1QNhzuX_Zul3bvrJwr7nuGZs4cUScY3n8yE3AHCLurgls-A9mz1X38xEa
ulV18l4Fg9tLejdkAuQZjPbqeHQBJe4IwGD5Ee0dQ-Mtz4NnhkIWx-YKBb_Xo2
zI3Q_1sYjKUuis7yWW-HTr_vqvFt0bj7WJf2vzB0TZ3dvsoGaTvPH2dyWwumUr
lx4gmPUzBdwTO6ubfYSDUEEz5py0d_OtWeUSYcCYBKD-aM7tXg26qJo21gYjLf
hn9zy-W19sOCZGuzgFjPhawXHpvnj_t-0_ES96kogjJLxS1IMU9Y5XmnwZMyNc
9EIwnogsCg-hVuvzyP0sIruktmI94_SL1xgMl7o03phcTMxtlMizR88NKU1WkB
siXMCjy1Noue7MD-ShDp5dmM
.
KnIKEhN8U-3C9s4gtSpjSw
</pre>
<p class="figure">Figure 205: Compact Serialization</p>
<p id="rfc.section.5.8.p.4">The resulting JWE object using the JSON serialization:</p>
<div id="rfc.figure.206"/>
<div id="jw-nested-enc-json"/>
<pre>
{
"recipients": [
{
"encrypted_key": "a0JHRoITfpX4qRewImjlStn8m3CPxBV1ueYlVh
jurCyrBg3I7YhCRYjphDOOS4E7rXbr2Fn6NyQq-A-gqT0FXqNjVO
GrG-bi13mwy7RoYhjTkBEC6P7sMYMXXx4gzMedpiJHQVeyI-zkZV
7A9matpgevAJWrXzOUysYGTtwoSN6gtUVtlLaivjvb21O0ul4YxS
HV-ByK1kyeetRp_fuYJxHoKLQL9P424sKx2WGYb4zsBIPF4ssl_e
5IR7nany-25_UmC2urosNkoFz9cQ82MypZP8gqbQJyPN-Fpp4Z-5
o6yV64x6yzDUF_5JCIdl-Qv6H5dMVIY7q1eKpXcV1lWO_2FefEBq
XxXvIjLeZivjNkzogCq3-IapSjVFnMjBxjpYLT8muaawo1yy1XXM
uinIpNcOY3n4KKrXLrCcteX85m4IIHMZa38s1Hpr56fPPseMA-Jl
tmt-a9iEDtOzhtxz8AXy9tsCAZV2XBWNG8c3kJusAamBKOYwfk7J
hLRDgOnJjlJLhn7TI4UxDp9dCmUXEN6z0v23W15qJIEXNJtqnblp
ymooeWAHCT4e_Owbim1g0AEpTHUdA2iiLNs9WTX_H_TXuPC8yDDh
i1smxS_X_xpkIHkiIHWDOLx03BpqDTivpKkBYwqP2UZkcxqX2Fo_
GnVrNwlK7Lgxw6FSQvDO0"
}
],
"protected": "eyJhbGciOiJSU0EtT0FFUCIsImN0eSI6IkpXVCIsImVuYy
I6IkExMjhHQ00ifQ",
"iv": "GbX1i9kXz0sxXPmA",
"ciphertext": "SZI4IvKHmwpazl_pJQXX3mHv1ANnOU4Wf9-utWYUcKrBN
gCe2OFMf66cSJ8k2QkxaQD3_R60MGE9ofomwtky3GFxMeGRjtpMt9OAv
VLsAXB0_UTCBGyBg3C2bWLXqZlfJAAoJRUPRk-BimYZY81zVBuIhc7Hs
QePCpu33SzMsFHjn4lP_idrJz_glZTNgKDt8zdnUPauKTKDNOH1DD4fu
zvDYfDIAfqGPyL5sVRwbiXpXdGokEszM-9ChMPqW1QNhzuX_Zul3bvrJ
wr7nuGZs4cUScY3n8yE3AHCLurgls-A9mz1X38xEaulV18l4Fg9tLejd
kAuQZjPbqeHQBJe4IwGD5Ee0dQ-Mtz4NnhkIWx-YKBb_Xo2zI3Q_1sYj
KUuis7yWW-HTr_vqvFt0bj7WJf2vzB0TZ3dvsoGaTvPH2dyWwumUrlx4
gmPUzBdwTO6ubfYSDUEEz5py0d_OtWeUSYcCYBKD-aM7tXg26qJo21gY
jLfhn9zy-W19sOCZGuzgFjPhawXHpvnj_t-0_ES96kogjJLxS1IMU9Y5
XmnwZMyNc9EIwnogsCg-hVuvzyP0sIruktmI94_SL1xgMl7o03phcTMx
tlMizR88NKU1WkBsiXMCjy1Noue7MD-ShDp5dmM",
"tag": "KnIKEhN8U-3C9s4gtSpjSw"
}
</pre>
<p class="figure">Figure 206: JSON Serialiation</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.6.p.1">This document introduces no new security considerations over those stated in <a href="#I-D.ietf-jose-json-web-algorithms">[I-D.ietf-jose-json-web-algorithms]</a>, <a href="#I-D.ietf-jose-json-web-encryption">[I-D.ietf-jose-json-web-encryption]</a>,  <a href="#I-D.ietf-jose-json-web-key">[I-D.ietf-jose-json-web-key]</a>, and <a href="#I-D.ietf-jose-json-web-signature">[I-D.ietf-jose-json-web-signature]</a>.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.7.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> Informative References</h1>
<table>
<tbody>
<tr>
<td class="reference">
<b id="I-D.ietf-jose-json-web-algorithms">[I-D.ietf-jose-json-web-algorithms]</b>
</td>
<td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms-25">JSON Web Algorithms (JWA)</a>", Internet-Draft draft-ietf-jose-json-web-algorithms-25, March 2014.</td>
</tr>
<tr>
<td class="reference">
<b id="I-D.ietf-jose-json-web-encryption">[I-D.ietf-jose-json-web-encryption]</b>
</td>
<td class="top"><a>Jones, M.</a> and <a>J. Hildebrand</a>, "<a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-25">JSON Web Encryption (JWE)</a>", Internet-Draft draft-ietf-jose-json-web-encryption-25, March 2014.</td>
</tr>
<tr>
<td class="reference">
<b id="I-D.ietf-jose-json-web-key">[I-D.ietf-jose-json-web-key]</b>
</td>
<td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-key-25">JSON Web Key (JWK)</a>", Internet-Draft draft-ietf-jose-json-web-key-25, March 2014.</td>
</tr>
<tr>
<td class="reference">
<b id="I-D.ietf-jose-json-web-signature">[I-D.ietf-jose-json-web-signature]</b>
</td>
<td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-signature-25">JSON Web Signature (JWS)</a>", Internet-Draft draft-ietf-jose-json-web-signature-25, March 2014.</td>
</tr>
<tr>
<td class="reference">
<b id="I-D.ietf-oauth-json-web-token">[I-D.ietf-oauth-json-web-token]</b>
</td>
<td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-json-web-token-19">JSON Web Token (JWT)</a>", Internet-Draft draft-ietf-oauth-json-web-token-19, March 2014.</td>
</tr>
<tr>
<td class="reference">
<b id="RFC1951">[RFC1951]</b>
</td>
<td class="top"><a href="mailto:ghost@aladdin.com" title="Aladdin Enterprises">Deutsch, P.</a>, "<a href="http://tools.ietf.org/html/rfc1951">DEFLATE Compressed Data Format Specification version 1.3</a>", RFC 1951, May 1996.</td>
</tr>
<tr>
<td class="reference">
<b id="RFC4648">[RFC4648]</b>
</td>
<td class="top"><a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, October 2006.</td>
</tr>
<tr>
<td class="reference">
<b id="RFC7095">[RFC7095]</b>
</td>
<td class="top"><a>Kewisch, P.</a>, "<a href="http://tools.ietf.org/html/rfc7095">jCard: The JSON Format for vCard</a>", RFC 7095, January 2014.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.A.p.1">All of the examples herein use quotes and character names found in the novels &#8220;The Hobbit&#8221;; &#8220;The Fellowship of the Ring&#8221;; &#8220;The Two Towers&#8221;; and &#8220;Return of the King&#8221;, written by J. R. R. Tolkien.</p>
<p id="rfc.section.A.p.2">Thanks to Richard Barnes and Jim Schaad for providing for their input on the outline for this document.  Thanks to Brian Campbell for reviewing text and verifying most of the examples.</p>
<h1 id="rfc.authors">
<a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
<address class="vcard">
<span class="vcardline">
<span class="fn">Matthew Miller</span>
<span class="n hidden">
<span class="family-name">Miller</span>
</span>
</span>
<span class="org vcardline">Cisco Systems, Inc.</span>
<span class="adr">

<span class="vcardline">
<span class="locality"></span>
<span class="region"></span>
<span class="code"></span>
</span>
<span class="country-name vcardline"></span>
</span>
<span class="vcardline">EMail: <a href="mailto:mamille2@cisco.com">mamille2@cisco.com</a></span>

</address>
</div>

<script>
/* jslint utility2:true */
// https://tools.ietf.org/html/rfc7516#appendix-A.3
(async function () {
    "use strict";
    let aad;
    let aal;
    let assertJsonEqual;
    let base64urlFromBuffer;
    let base64urlToBuffer;
    let cek;
    let ciphertext;
    let crypto;
    let enc_key;
    let ii;
    let iv;
    let jj;
    let jwe;
    let jwk;
    let mac_key;
    let plaintext;
    let protectedHeader;
    let tag;
    globalThis.debugInline = function (...argList) {
    /*
     * this function will both print <argList> to stderr
     * and return <argList>[0]
     */
        console.error("\n\ndebugInline");
        console.error(...argList);
        console.error("\n");
        return argList[0];
    };
    assertJsonEqual = function (aa, bb) {
    /*
     * this function will assert JSON.stringify(<aa>) === JSON.stringify(<bb>)
     */
        let objectKeysSort;
        objectKeysSort = function (obj) {
        /*
         * this function will recursively sort keys in <obj>
         */
            let sorted;
            if (!(typeof obj === "object" && obj)) {
                return obj;
            }
            if (Array.isArray(obj)) {
                return obj.map(objectKeysSort);
            }
            sorted = {};
            // recursively sort keys in obj
            Object.keys(obj).sort().forEach(function (key) {
                sorted[key] = objectKeysSort(obj[key]);
            });
            return sorted;
        };
        aa = JSON.stringify(objectKeysSort(aa));
        bb = JSON.stringify(objectKeysSort(bb));
        if (aa !== bb) {
            throw new Error(JSON.stringify(aa) + " !== " + JSON.stringify(bb));
        }
    };
    base64urlFromBuffer = function (buf) {
        let base64url;
        base64url = "";
        ii = 0;
        while (ii < buf.byteLength) {
            base64url += String.fromCharCode(buf[ii]);
            ii += 1;
        }
        return globalThis.btoa(base64url).replace((
            /\+/g
        ), "-").replace((
            /\//g
        ), "_").replace((
            /\=*?$/
        ), "");
    };
    base64urlToBuffer = function (base64url) {
        return Uint8Array.from(globalThis.atob(base64url.replace((
            /-/g
        ), "+").replace((
            /_/g
        ), "/").replace((
            /\=*?$/
        ), "")), function (chr) {
            return chr.charCodeAt(0);
        });
    };
    crypto = globalThis.crypto;
    // 4.8. Key Wrap using AES-KeyWrap with AES-GCM
    // 4.8.1. Input Factors
    plaintext = (
        "You can trust us to stick with you through thick and "
        + "thin\u2013to the bitter end. And you can trust us to "
        + "keep any secret of yours\u2013closer than you keep it "
        + "yourself. But you cannot trust us to let you face trouble "
        + "alone, and go off without a word. We are your friends, Frodo."
    );
    // 4.8.2. Generated Factors
    iv = base64urlToBuffer("Qx0pmsDa8KnJc9Jo");
    // 4.8.3. Encrypting the Key
    jwk = await crypto.subtle.importKey("jwk", {
        "kty": "oct",
        "kid": "81b20965-8332-43d9-a468-82160ad91ac8",
        "use": "enc",
        "alg": "A128KW",
        "k": "GZy6sIZ6wl9NJOKB-jnmVQ"
    }, {
        name: "AES-KW"
    }, false, [
        "unwrapKey", "wrapKey"
    ]);
    cek = await crypto.subtle.importKey("raw", base64urlToBuffer(
        "aY5_Ghmk9KxWPBLu_glx1w"
    ), {
        name: "AES-GCM"
    }, true, [
        "encrypt"
    ]);
    enc_key = cek;
    cek = await crypto.subtle.wrapKey("raw", cek, jwk, "AES-KW");
    cek = base64urlFromBuffer(new Uint8Array(cek));
    assertJsonEqual(
        cek,
        "CBI6oDw8MydIx1IBntf_lQcw2MmJKIQx"
    );
    // 4.8.4. Encrypting the Content
    protectedHeader = base64urlFromBuffer(new TextEncoder().encode(
        JSON.stringify({
            "alg": "A128KW",
            "kid": "81b20965-8332-43d9-a468-82160ad91ac8",
            "enc": "A128GCM"
        })
    ));
    assertJsonEqual(protectedHeader, (
        "eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC"
        + "04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn0"
    ));
    ciphertext = new Uint8Array(await crypto.subtle.encrypt({
        additionalData: base64urlToBuffer(
            "eyJhbGciOiJBMTI4S1ciLCJraWQiOiI4MWIyMDk2NS04MzMyLTQzZDktYTQ2OC"
            + "04MjE2MGFkOTFhYzgiLCJlbmMiOiJBMTI4R0NNIn0"
        ),
        iv,
        name: "AES-GCM",
        tagLength: 128
    }, enc_key, new TextEncoder().encode(plaintext)));
    ciphertext = base64urlFromBuffer(ciphertext);
    console.log(ciphertext.slice(0, -16));
    console.log(
        "AwliP-KmWgsZ37BvzCefNen6VTbRK3QMA4TkvRkH0tP1bTdhtFJgJxeVmJkLD6"
        + "1A1hnWGetdg11c9ADsnWgL56NyxwSYjU1ZEHcGkd3EkU0vjHi9gTlb90qSYFfe"
        + "F0LwkcTtjbYKCsiNJQkcIp1yeM03OmuiYSoYJVSpf7ej6zaYcMv3WwdxDFl8RE"
        + "wOhNImk2Xld2JXq6BR53TSFkyT7PwVLuq-1GwtGHlQeg7gDT6xW0JqHDPn_H-p"
        + "uQsmthc9Zg0ojmJfqqFvETUxLAF-KjcBTS5dNy6egwkYtOt8EIHK-oEsKYtZRa"
        + "a8Z7MOZ7UGxGIMvEmxrGCPeJa14slv2-gaqK0kEThkaSqdYw0FkQZF"
    );

    //!! ciphertext = base64urlToBuffer(
        //!! "JW_i_f52hww_ELQPGaYyeAB6HYGcR559l9TYnSovc23XJoBcW29rHP8yZOZG7Y"
        //!! + "hLpT1bjFuvZPjQS-m0IFtVcXkZXdH_lr_FrdYt9HRUYkshtrMmIUAyGmUnd9zM"
        //!! + "DB2n0cRDIHAzFVeJUDxkUwVAE7_YGRPdcqMyiBoCO-FBdE-Nceb4h3-FtBP-c_"
        //!! + "BIwCPTjb9o0SbdcdREEMJMyZBH8ySWMVi1gPD9yxi-aQpGbSv_F9N4IZAxscj5"
        //!! + "g-NJsUPbjk29-s7LJAGb15wEBtXphVCgyy53CoIKLHHeJHXex45Uz9aKZSRSIn"
        //!! + "ZI-wjsY0yu3cT4_aQ3i1o-tiE-F8Ios61EKgyIQ4CWao8PFMj8TTnp"
    //!! );
    //!! cek = await crypto.subtle.importKey("jwk", {
        //!! "kty": "oct",
        //!! "kid": "77c7e2b8-6e13-45cf-8672-617b5b45243a",
        //!! "use": "enc",
        //!! "alg": "A128GCM",
        //!! "k": "XctOhJAkA-pD9Lh7ZgW_2A"
    //!! }, {
        //!! name: "AES-GCM"
    //!! }, true, [
        //!! "encrypt"
    //!! ]);
    //!! plaintext = new Uint8Array(await crypto.subtle.encrypt({
        //!! additionalData: base64urlToBuffer(
            //!! + "eyJhbGciOiJkaXIiLCJraWQiOiI3N2M3ZTJiOC02ZTEzLTQ1Y2YtODY3Mi02MT"
            //!! + "diNWI0NTI0M2EiLCJlbmMiOiJBMTI4R0NNIn0"
        //!! ),
        //!! iv: base64urlToBuffer("refa467QzzKx6QAB"),
        //!! name: "AES-GCM"
    //!! }, cek, ciphertext));
    //!! debugInline(JSON.stringify(Array.from(plaintext)));
    //!! debugInline(JSON.stringify(Array.from(plaintext).slice(-16)));
    //!! debugInline(JSON.stringify(Array.from(
        //!! base64urlToBuffer("vbb32Xvllea2OtmHAdccRQ")
    //!! )));
    //!! debugInline(JSON.stringify(new TextDecoder().decode(plaintext)));
    //!! plaintext = new Uint8Array(await crypto.subtle.decrypt({
        //!! //!! additionalData: aad,
        //!! iv,
        //!! name: "AES-GCM"
    //!! }, cek, ciphertext));
    //!! plaintext = new TextDecoder().decode(plaintext);
    //!! debugInline(plaintext);



    //!! // https://tools.ietf.org/html/rfc7516#appendix-A.3
    //!! // A.3.  Example JWE Using AES Key Wrap and AES_128_CBC_HMAC_SHA_256
    //!! plaintext = "Live long and prosper.";
    //!! plaintext = await new TextEncoder().encode(plaintext);
    //!! assertJsonEqual(Array.from(plaintext), [
        //!! 76, 105, 118, 101, 32, 108, 111, 110, 103, 32, 97, 110, 100, 32,
        //!! 112, 114, 111, 115, 112, 101, 114, 46
    //!! ]);
    //!! // A.3.1.  JOSE Header
    //!! protectedHeader = "{\"alg\":\"A128KW\",\"enc\":\"A128CBC-HS256\"}";
    //!! protectedHeader = globalThis.btoa(protectedHeader).replace((
        //!! /\+/g
    //!! ), "-").replace((
        //!! /\//g
    //!! ), "_").replace((
        //!! /\=*?$/
    //!! ), "");
    //!! assertJsonEqual(
        //!! protectedHeader,
        //!! "eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0"
    //!! );
    //!! // A.3.2.  Content Encryption Key (CEK)
    //!! cek = Uint8Array.from([
        //!! 4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
        //!! 206, 107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156,
        //!! 44, 207
    //!! ]);
    //!! mac_key = cek.slice(0, 16);
    //!! enc_key = cek.slice(16);
    //!! cek = base64urlFromBuffer(cek);
    //!! cek = {
        //!! "k": cek,
        //!! "kty": "oct"
    //!! };
    //!! assertJsonEqual(cek, {
        //!! "k": "BNMfxVSd_P4LZJ36P6pqzmt81C1vawnbyLEA8I-cLM8",
        //!! "kty": "oct"
    //!! });
    //!! // A.3.3.  Key Encryption
    //!! jwk = {
        //!! "alg": "A128KW",
        //!! "k": "GawgguFyGrWKav7AX4VKUg",
        //!! "kty": "oct"
    //!! };
    //!! jwk = await crypto.subtle.importKey("jwk", jwk, {
        //!! name: "AES-KW"
    //!! }, false, [
        //!! "unwrapKey", "wrapKey"
    //!! ]);
    //!! cek = await crypto.subtle.importKey("jwk", cek, {
        //!! name: "AES-CBC"
    //!! }, true, [
        //!! "encrypt"
    //!! ]);
    //!! cek = await crypto.subtle.wrapKey("raw", cek, jwk, "AES-KW");
    //!! cek = base64urlFromBuffer(new Uint8Array(cek));
    //!! assertJsonEqual(
        //!! cek,
        //!! "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ"
    //!! );
    //!! // A.3.4.  Initialization Vector
    //!! iv = base64urlToBuffer("AxY8DCtDaGlsbGljb3RoZQ");
    //!! assertJsonEqual(Array.from(iv), [
        //!! 3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111, 116, 104,
        //!! 101
    //!! ]);
    //!! // A.3.5.  Additional Authenticated Data
    //!! aad = new TextEncoder().encode(protectedHeader);
    //!! assertJsonEqual(Array.from(aad), [
        //!! 101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 66, 77, 84, 73, 52,
        //!! 83, 49, 99, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66,
        //!! 77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73,
        //!! 110, 48
    //!! ]);
    //!! // A.3.6.  Content Encryption
    //!! // Appendix B.  Example AES_128_CBC_HMAC_SHA_256 Computation
    //!! // B.1.  Extract MAC_KEY and ENC_KEY from Key
    //!! assertJsonEqual(Array.from(mac_key), [
        //!! 4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
        //!! 206
    //!! ]);
    //!! assertJsonEqual(Array.from(enc_key), [
        //!! 107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156, 44,
        //!! 207
    //!! ]);
    //!! // B.2.  Encrypt Plaintext to Create Ciphertext
    //!! enc_key = await crypto.subtle.importKey("raw", enc_key, "AES-CBC", true, [
        //!! "encrypt"
    //!! ]);
    //!! ciphertext = new Uint8Array(await crypto.subtle.encrypt({
        //!! iv,
        //!! name: "AES-CBC"
    //!! }, enc_key, plaintext));
    //!! assertJsonEqual(Array.from(ciphertext), [
        //!! 40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152, 230, 6,
        //!! 75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215, 104, 143,
        //!! 112, 56, 102
    //!! ]);
    //!! // B.3.  64-Bit Big-Endian Representation of AAD Length
    //!! aal = Uint8Array.from([
        //!! 0, 0, 0, 0,
        //!! (aad.length >>> 21) & 0xff,
        //!! (aad.length >> 13) & 0xff,
        //!! (aad.length >> 5) & 0xff,
        //!! (8 * aad.length) & 0xff
    //!! ]);
    //!! assertJsonEqual(Array.from(aal), [
        //!! 0, 0, 0, 0, 0, 0, 1, 152
    //!! ]);
    //!! // B.4.  Initialization Vector Value
    //!! assertJsonEqual(Array.from(iv), [
        //!! 3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111, 116, 104,
        //!! 101
    //!! ]);
    //!! // B.5.  Create Input to HMAC Computation
    //!! tag = new Uint8Array(aad.length + iv.length + ciphertext.length + 8);
    //!! ii = 0;
    //!! [
        //!! aad, iv, ciphertext, [
            //!! // 64-bit length of aad
            //!! 0, 0, 0, 0,
            //!! (aad.length >>> 21) & 0xff,
            //!! (aad.length >> 13) & 0xff,
            //!! (aad.length >> 5) & 0xff,
            //!! (8 * aad.length) & 0xff
        //!! ]
    //!! ].forEach(function (elem) {
        //!! jj = 0;
        //!! while (jj < elem.length) {
            //!! tag[ii] = elem[jj];
            //!! ii += 1;
            //!! jj += 1;
        //!! }
    //!! });
    //!! assertJsonEqual(Array.from(tag), [
        //!! 101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 66, 77, 84, 73, 52,
        //!! 83, 49, 99, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66,
        //!! 77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73,
        //!! 110, 48, 3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111,
        //!! 116, 104, 101, 40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24,
        //!! 152, 230, 6, 75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215,
        //!! 104, 143, 112, 56, 102, 0, 0, 0, 0, 0, 0, 1, 152
    //!! ]);
    //!! // B.6.  Compute HMAC Value
    //!! mac_key = await crypto.subtle.importKey("raw", mac_key, {
        //!! hash: "SHA-256",
        //!! name: "HMAC"
    //!! }, false, [
        //!! "sign"
    //!! ]);
    //!! tag = new Uint8Array(await crypto.subtle.sign({
        //!! name: "HMAC"
    //!! }, mac_key, tag));
    //!! assertJsonEqual(Array.from(tag), [
        //!! 83, 73, 191, 98, 104, 205, 211, 128, 201, 189, 199, 133, 32, 38,
        //!! 194, 85, 9, 84, 229, 201, 219, 135, 44, 252, 145, 102, 179, 140, 105,
        //!! 86, 229, 116
    //!! ]);
    //!! // B.7.  Truncate HMAC Value to Create Authentication Tag
    //!! tag = tag.slice(0, 16);
    //!! assertJsonEqual(Array.from(tag), [
        //!! 83, 73, 191, 98, 104, 205, 211, 128, 201, 189, 199, 133, 32, 38,
        //!! 194, 85
    //!! ]);
    //!! tag = base64urlFromBuffer(tag);
    //!! ciphertext = base64urlFromBuffer(ciphertext);
    //!! assertJsonEqual({
        //!! ciphertext,
        //!! tag
    //!! }, {
        //!! ciphertext: "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY",
        //!! tag: "U0m_YmjN04DJvceFICbCVQ"
    //!! });
    //!! // A.3.7.  Complete Representation
    //!! jwe = (
        //!! protectedHeader + "."
        //!! + cek + "."
        //!! + base64urlFromBuffer(iv) + "."
        //!! + ciphertext + "."
        //!! + tag
    //!! );
    //!! assertJsonEqual(jwe, (
        //!! // header
        //!! "eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0."
        //!! // cek
        //!! + "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ."
        //!! // iv
        //!! + "AxY8DCtDaGlsbGljb3RoZQ."
        //!! // ciphertext
        //!! + "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY."
        //!! // tag
        //!! + "U0m_YmjN04DJvceFICbCVQ"
    //!! ));
    //!! console.error("jwe - " + jwe);
    //!! // A.3.8.  Validation
    //!! [
        //!! protectedHeader, cek, iv, ciphertext
    //!! ] = jwe.split(".");
    //!! protectedHeader = new TextEncoder().encode(protectedHeader);
    //!! cek = await crypto.subtle.unwrapKey("raw", base64urlToBuffer(
        //!! cek
    //!! ), jwk, "AES-KW", "AES-CBC", true, [
        //!! "decrypt"
    //!! ]);
    //!! cek = new Uint8Array(await crypto.subtle.exportKey("raw", cek));
    //!! iv = base64urlToBuffer(iv);
    //!! ciphertext = base64urlToBuffer(ciphertext);
    //!! // B.5.  Create Input to HMAC Computation
    //!! tag = new Uint8Array(
        //!! protectedHeader.length + iv.length + ciphertext.length + 8
    //!! );
    //!! ii = 0;
    //!! [
        //!! protectedHeader, iv, ciphertext, [
            //!! // 64-bit length of protectedHeader
            //!! 0, 0, 0, 0,
            //!! (protectedHeader.length >>> 21) & 0xff,
            //!! (protectedHeader.length >> 13) & 0xff,
            //!! (protectedHeader.length >> 5) & 0xff,
            //!! (protectedHeader.length << 3) & 0xff
        //!! ]
    //!! ].forEach(function (elem) {
        //!! jj = 0;
        //!! while (jj < elem.length) {
            //!! tag[ii] = elem[jj];
            //!! ii += 1;
            //!! jj += 1;
        //!! }
    //!! });
    //!! // B.6.  Compute HMAC Value
    //!! jwk = await crypto.subtle.importKey("raw", cek.slice(0, 16), {
        //!! hash: "SHA-256",
        //!! name: "HMAC"
    //!! }, false, [
        //!! "sign"
    //!! ]);
    //!! tag = new Uint8Array(await crypto.subtle.sign({
        //!! name: "HMAC"
    //!! }, jwk, tag));
    //!! // B.7.  Truncate HMAC Value to Create Authentication Tag
    //!! tag = tag.slice(0, 16);
    //!! tag = base64urlFromBuffer(tag);
    //!! assertJsonEqual(tag, "U0m_YmjN04DJvceFICbCVQ");
    //!! // decrypt
    //!! jwk = await crypto.subtle.importKey("raw", cek.slice(16), "AES-CBC", true, [
        //!! "decrypt"
    //!! ]);
    //!! plaintext = await crypto.subtle.decrypt({
        //!! iv,
        //!! name: "AES-CBC"
    //!! }, jwk, ciphertext);
    //!! plaintext = new TextDecoder().decode(plaintext);
    //!! assertJsonEqual(plaintext, "Live long and prosper.");
    //!! console.error("plaintext - " + plaintext);
}());



//!! (async function () {
    //!! "use strict";
    //!! let assertJsonEqual;
    //!! let base64urlFromBuffer;
    //!! let base64urlToBuffer;
    //!! let decrypt;
    //!! let encrypt;
    //!! let jwe;
    //!! let jwk;
    //!! let sign;
    //!! assertJsonEqual = function (aa, bb) {
    //!! /*
     //!! * this function will assert JSON.stringify(<aa>) === JSON.stringify(<bb>)
     //!! */
        //!! aa = JSON.stringify(aa);
        //!! bb = JSON.stringify(bb);
        //!! if (aa !== bb) {
            //!! throw new Error(JSON.stringify(aa) + " !== " + JSON.stringify(bb));
        //!! }
    //!! };
    //!! base64urlFromBuffer = function (buf) {
        //!! let base64url;
        //!! let ii;
        //!! base64url = "";
        //!! ii = 0;
        //!! while (ii < buf.byteLength) {
            //!! base64url += String.fromCharCode(buf[ii]);
            //!! ii += 1;
        //!! }
        //!! return globalThis.btoa(base64url).replace((
            //!! /\+/g
        //!! ), "-").replace((
            //!! /\//g
        //!! ), "_").replace((
            //!! /\=*?$/
        //!! ), "");
    //!! };
    //!! base64urlToBuffer = function (base64url) {
        //!! return Uint8Array.from(globalThis.atob(base64url.replace((
            //!! /-/g
        //!! ), "+").replace((
            //!! /_/g
        //!! ), "/").replace((
            //!! /\=*?$/
        //!! ), "")), function (chr) {
            //!! return chr.charCodeAt(0);
        //!! });
    //!! };
    //!! decrypt = async function (jwk, jwe) {
        //!! let cek;
        //!! let ciphertext;
        //!! let crypto;
        //!! let header;
        //!! let iv;
        //!! let tag;
        //!! crypto = globalThis.crypto;
        //!! // A.3.8.  Validation
        //!! [
            //!! header, cek, iv, ciphertext, tag
        //!! ] = jwe.split(".");
        //!! if (typeof tag !== "string") {
            //!! throw new Error("jwe failed validation - " + jwe);
        //!! }
        //!! cek = await crypto.subtle.unwrapKey("raw", base64urlToBuffer(
            //!! cek
        //!! ), jwk, "AES-KW", "AES-CBC", true, [
            //!! "decrypt"
        //!! ]);
        //!! cek = new Uint8Array(await crypto.subtle.exportKey("raw", cek));
        //!! iv = base64urlToBuffer(iv);
        //!! ciphertext = base64urlToBuffer(ciphertext);
        //!! if (await sign(jwk, jwe) !== tag) {
            //!! throw new Error("jwe failed validation - " + jwe);
        //!! }
        //!! // decrypt
        //!! jwk = await crypto.subtle.importKey("raw", cek.subarray(
            //!! 16
        //!! ), "AES-CBC", true, [
            //!! "decrypt"
        //!! ]);
        //!! return new TextDecoder().decode(await crypto.subtle.decrypt({
            //!! iv,
            //!! name: "AES-CBC"
        //!! }, jwk, ciphertext));
    //!! };
    //!! encrypt = async function (jwk, plaintext, iv) {
        //!! let cek;
        //!! let ciphertext;
        //!! let crypto;
        //!! let tmp;
        //!! crypto = globalThis.crypto;
        //!! ciphertext = "";
        //!! // https://tools.ietf.org/html/rfc7516#appendix-A.3
        //!! // A.3.  Example JWE Using AES Key Wrap and AES_128_CBC_HMAC_SHA_256
        //!! plaintext = new TextEncoder().encode(plaintext);
        //!! // A.3.1.  JOSE Header
        //!! tmp = "{\"alg\":\"A128KW\",\"enc\":\"A128CBC-HS256\"}";
        //!! tmp = globalThis.btoa(tmp).replace((
            //!! /\+/g
        //!! ), "-").replace((
            //!! /\//g
        //!! ), "_").replace((
            //!! /\=*?$/
        //!! ), "");
        //!! // jwe BASE64URL(UTF8(JWE Protected Header) - protected
        //!! ciphertext += tmp;
        //!! // A.3.2.  Content Encryption Key (CEK)
        //!! cek = crypto.getRandomValues(new Uint8Array(32));
        //!! tmp = await crypto.subtle.importKey("raw", cek, {
            //!! name: "AES-CBC"
        //!! }, true, [
            //!! "encrypt"
        //!! ]);
        //!! tmp = await crypto.subtle.wrapKey("raw", tmp, jwk, "AES-KW");
        //!! tmp = base64urlFromBuffer(new Uint8Array(tmp));
        //!! // jwe BASE64URL(JWE Encrypted Key) - cek
        //!! ciphertext += "." + tmp;
        //!! // A.3.4.  Initialization Vector
        //!! iv = iv || crypto.getRandomValues(new Uint8Array(16));
        //!! // jwe BASE64URL(JWE Initialization Vector) - iv
        //!! ciphertext += "." + base64urlFromBuffer(iv);
        //!! // A.3.5.  Additional Authenticated Data
        //!! // A.3.6.  Content Encryption
        //!! // Appendix B.  Example AES_128_CBC_HMAC_SHA_256 Computation
        //!! // B.1.  Extract MAC_KEY and ENC_KEY from Key
        //!! // B.2.  Encrypt Plaintext to Create Ciphertext
        //!! tmp = await crypto.subtle.importKey("raw", cek.subarray(
            //!! 16
        //!! ), "AES-CBC", true, [
            //!! "encrypt"
        //!! ]);
        //!! tmp = base64urlFromBuffer(new Uint8Array(await crypto.subtle.encrypt({
            //!! iv,
            //!! name: "AES-CBC"
        //!! }, tmp, plaintext)));
        //!! // jwe BASE64URL(JWE Ciphertext) - ciphertext
        //!! ciphertext += "." + tmp;
        //!! tmp = await sign(jwk, ciphertext);
        //!! // jwe BASE64URL(JWE Authentication Tag) - tag
        //!! ciphertext += "." + tmp;
        //!! return ciphertext;
    //!! };
    //!! sign = async function (jwk, jwe) {
        //!! let cek;
        //!! let ciphertext;
        //!! let crypto;
        //!! let ii;
        //!! let iv;
        //!! let jj;
        //!! let protectedHeader;
        //!! let tag;
        //!! crypto = globalThis.crypto;
        //!! // A.3.8.  Validation
        //!! [
            //!! protectedHeader, cek, iv, ciphertext
        //!! ] = jwe.split(".");
        //!! if (typeof ciphertext !== "string") {
            //!! throw new Error("jwe failed signing - " + jwe);
        //!! }
        //!! protectedHeader = new TextEncoder().encode(protectedHeader);
        //!! cek = await crypto.subtle.unwrapKey("raw", base64urlToBuffer(
            //!! cek
        //!! ), jwk, "AES-KW", "AES-CBC", true, [
            //!! "decrypt"
        //!! ]);
        //!! cek = new Uint8Array(await crypto.subtle.exportKey("raw", cek));
        //!! iv = base64urlToBuffer(iv);
        //!! ciphertext = base64urlToBuffer(ciphertext);
        //!! // B.5.  Create Input to HMAC Computation
        //!! tag = new Uint8Array(
            //!! protectedHeader.length + iv.length + ciphertext.length + 8
        //!! );
        //!! ii = 0;
        //!! [
            //!! protectedHeader, iv, ciphertext, [
                //!! // 64-bit length of protectedHeader
                //!! 0, 0, 0, 0,
                //!! (protectedHeader.length >>> 21) & 0xff,
                //!! (protectedHeader.length >> 13) & 0xff,
                //!! (protectedHeader.length >> 5) & 0xff,
                //!! (protectedHeader.length << 3) & 0xff
            //!! ]
        //!! ].forEach(function (elem) {
            //!! jj = 0;
            //!! while (jj < elem.length) {
                //!! tag[ii] = elem[jj];
                //!! ii += 1;
                //!! jj += 1;
            //!! }
        //!! });
        //!! // B.6.  Compute HMAC Value
        //!! jwk = await crypto.subtle.importKey("raw", cek.subarray(0, 16), {
            //!! hash: "SHA-256",
            //!! name: "HMAC"
        //!! }, false, [
            //!! "sign"
        //!! ]);
        //!! tag = new Uint8Array(await crypto.subtle.sign({
            //!! name: "HMAC"
        //!! }, jwk, tag));
        //!! // B.7.  Truncate HMAC Value to Create Authentication Tag
        //!! return base64urlFromBuffer(tag.subarray(0, 16));
    //!! };
    //!! jwk = {
        //!! "alg": "A128KW",
        //!! "k": "GawgguFyGrWKav7AX4VKUg",
        //!! "kty": "oct"
    //!! };
    //!! jwk = await globalThis.crypto.subtle.importKey("jwk", jwk, {
        //!! name: "AES-KW"
    //!! }, false, [
        //!! "unwrapKey", "wrapKey"
    //!! ]);
    //!! jwe = (
        //!! // protectedHeader
        //!! "eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0."
        //!! // cek
        //!! + "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ."
        //!! // iv
        //!! + "AxY8DCtDaGlsbGljb3RoZQ."
        //!! // ciphertext
        //!! + "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY."
        //!! // tag
        //!! + "U0m_YmjN04DJvceFICbCVQ"
    //!! );
    //!! assertJsonEqual(await decrypt(jwk, jwe), "Live long and prosper.");
    //!! jwe = await encrypt(jwk, "Live long and prosper.");
    //!! console.error("jwe - " + jwe);
    //!! assertJsonEqual(await decrypt(jwk, jwe), "Live long and prosper.");
//!! }());
</script>

</body>
</html>
